!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).buffer=e()}(function(){return function r(n,a,o){function s(t,e){if(!a[t]){if(!n[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}i=a[t]={exports:{}};n[t][0].call(i.exports,function(e){return s(n[t][1][e]||e)},i,i.exports,r,n,a,o)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,t,i){"use strict";i.byteLength=function(e){var e=c(e),t=e[0],e=e[1];return 3*(t+e)/4-e},i.toByteArray=function(e){for(var t,i=c(e),r=i[0],i=i[1],n=new f(3*(r+i)/4-i),a=0,o=0<i?r-4:r,s=0;s<o;s+=4)t=l[e.charCodeAt(s)]<<18|l[e.charCodeAt(s+1)]<<12|l[e.charCodeAt(s+2)]<<6|l[e.charCodeAt(s+3)],n[a++]=t>>16&255,n[a++]=t>>8&255,n[a++]=255&t;return 2===i&&(t=l[e.charCodeAt(s)]<<2|l[e.charCodeAt(s+1)]>>4,n[a++]=255&t),1===i&&(t=l[e.charCodeAt(s)]<<10|l[e.charCodeAt(s+1)]<<4|l[e.charCodeAt(s+2)]>>2,n[a++]=t>>8&255,n[a++]=255&t),n},i.fromByteArray=function(e){for(var t,i=e.length,r=i%3,n=[],a=0,o=i-r;a<o;a+=16383)n.push(function(e,t,i){for(var r,n=[],a=t;a<i;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),n.push(s[(r=r)>>18&63]+s[r>>12&63]+s[r>>6&63]+s[63&r]);return n.join("")}(e,a,o<a+16383?o:a+16383));return 1==r?(t=e[i-1],n.push(s[t>>2]+s[t<<4&63]+"==")):2==r&&(t=(e[i-2]<<8)+e[i-1],n.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"=")),n.join("")};for(var s=[],l=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,a=r.length;n<a;++n)s[n]=r[n],l[r.charCodeAt(n)]=n;function c(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("=");return[e=-1===e?t:e,e===t?0:4-e%4]}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],2:[function(e,t,I){!function(u){"use strict";var C=e("base64-js"),a=e("ieee754"),t=(Buffer=I.Buffer=u,I.SlowBuffer=function(e){return u.alloc(+(e=+e!=e?0:e))},I.INSPECT_MAX_BYTES=50,2147483647);function c(e){if(t<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return e.__proto__=u.prototype,e}function u(e,t,i){if("number"!=typeof e)return r(e,t,i);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return o(e)}function r(e,t,i){if("string"==typeof e){var r=e,n=t;if(u.isEncoding(n="string"==typeof n&&""!==n?n:"utf8"))return(r=(o=c(a=0|h(r,n))).write(r,n))!==a?o.slice(0,r):o;throw new TypeError("Unknown encoding: "+n)}if(ArrayBuffer.isView(e))return p(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(E(e,ArrayBuffer)||e&&E(e.buffer,ArrayBuffer)){var a=e,r=t,o=i;if(r<0||a.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(a.byteLength<r+(o||0))throw new RangeError('"length" is outside of buffer bounds');return(a=void 0===r&&void 0===o?new Uint8Array(a):void 0===o?new Uint8Array(a,r):new Uint8Array(a,r,o)).__proto__=u.prototype,a}if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return u.from(n,t,i);var s,l,f=u.isBuffer(s=e)?(0!==(l=c(f=0|d(s.length))).length&&s.copy(l,0,0,f),l):void 0!==s.length?"number"!=typeof s.length||P(s.length)?c(0):p(s):"Buffer"===s.type&&Array.isArray(s.data)?p(s.data):void 0;if(f)return f;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function n(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function o(e){return n(e),c(e<0?0:0|d(e))}function p(e){for(var t=e.length<0?0:0|d(e.length),i=c(t),r=0;r<t;r+=1)i[r]=255&e[r];return i}function d(e){if(t<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+t.toString(16)+" bytes");return 0|e}function h(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||E(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var i=e.length,r=2<arguments.length&&!0===arguments[2];if(!r&&0===i)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return x(e).length;default:if(n)return r?-1:S(e).length;t=(""+t).toLowerCase(),n=!0}}function i(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function s(e,t,i,r,n){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),(i=(i=P(i=+i)?n?0:e.length-1:i)<0?e.length+i:i)>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:l(e,t,i,r,n);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(n?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,i):l(e,[t],i,r,n);throw new TypeError("val must be string, number or Buffer")}function l(e,t,i,r,n){var a=1,o=e.length,s=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o/=a=2,s/=2,i/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n)for(var f=-1,c=i;c<o;c++)if(l(e,c)===l(t,-1===f?0:c-f)){if(c-(f=-1===f?c:f)+1===s)return f*a}else-1!==f&&(c-=c-f),f=-1;else for(c=i=o<i+s?o-s:i;0<=c;c--){for(var u=!0,p=0;p<s;p++)if(l(e,c+p)!==l(t,p)){u=!1;break}if(u)return c}return-1}function w(e,t,i,r){return T(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function k(e,t,i){i=Math.min(e.length,i);for(var r=[],n=t;n<i;){var a,o,s,l,f=e[n],c=null,u=239<f?4:223<f?3:191<f?2:1;if(n+u<=i)switch(u){case 1:f<128&&(c=f);break;case 2:128==(192&(a=e[n+1]))&&127<(l=(31&f)<<6|63&a)&&(c=l);break;case 3:a=e[n+1],o=e[n+2],128==(192&a)&&128==(192&o)&&2047<(l=(15&f)<<12|(63&a)<<6|63&o)&&(l<55296||57343<l)&&(c=l);break;case 4:a=e[n+1],o=e[n+2],s=e[n+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&65535<(l=(15&f)<<18|(63&a)<<12|(63&o)<<6|63&s)&&l<1114112&&(c=l)}null===c?(c=65533,u=1):65535<c&&(r.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),r.push(c),n+=u}var p=r,d=p.length;if(d<=g)return String.fromCharCode.apply(String,p);for(var h="",m=0;m<d;)h+=String.fromCharCode.apply(String,p.slice(m,m+=g));return h}I.kMaxLength=t,(u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=r,u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(e,t,i){return t=t,i=i,n(e=e),!(e<=0)&&void 0!==t?"string"==typeof i?c(e).fill(t,i):c(e).fill(t):c(e)},u.allocUnsafe=o,u.allocUnsafeSlow=o,u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(E(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),E(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var i=e.length,r=t.length,n=0,a=Math.min(i,r);n<a;++n)if(e[n]!==t[n]){i=e[n],r=t[n];break}return i<r?-1:r<i?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;for(var i=u.allocUnsafe(t),r=0,n=0;n<e.length;++n){var a=e[n];if(E(a,Uint8Array)&&(a=u.from(a)),!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,r),r+=a.length}return i},u.byteLength=h,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)i(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)i(this,t,t+3),i(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)i(this,t,t+7),i(this,t+1,t+6),i(this,t+2,t+5),i(this,t+3,t+4);return this},u.prototype.toLocaleString=u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?k(this,0,e):function(e,t,i){var r,n=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((i=void 0===i||i>this.length?this.length:i)<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var a=this,o=t,s=i,l=a.length;(!s||s<0||l<s)&&(s=l);for(var f="",c=o=!o||o<0?0:o;c<s;++c)f+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(a[c]);return f;case"utf8":case"utf-8":return k(this,t,i);case"ascii":var u=this,l=t,p=i,d="";p=Math.min(u.length,p);for(var h=l;h<p;++h)d+=String.fromCharCode(127&u[h]);return d;case"latin1":case"binary":var m=this,o=t,g=i,v="";g=Math.min(m.length,g);for(var w=o;w<g;++w)v+=String.fromCharCode(m[w]);return v;case"base64":return y=this,r=i,0===(b=t)&&r===y.length?C.fromByteArray(y):C.fromByteArray(y.slice(b,r));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var y=t,b=i,_=this.slice(y,b),S="",x=0;x<_.length;x+=2)S+=String.fromCharCode(_[x]+256*_[x+1]);return S;default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(u.isBuffer(e))return this===e||0===u.compare(this,e);throw new TypeError("Argument must be a Buffer")},u.prototype.inspect=function(){var e="",t=I.INSPECT_MAX_BYTES,e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim();return this.length>t&&(e+=" ... "),"<Buffer "+e+">"},u.prototype.compare=function(e,t,i,r,n){if(E(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),(t=void 0===t?0:t)<0||i>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(n<=r&&i<=t)return 0;if(n<=r)return-1;if(i<=t)return 1;if(this===e)return 0;for(var a=(n>>>=0)-(r>>>=0),o=(i>>>=0)-(t>>>=0),s=Math.min(a,o),l=this.slice(r,n),f=e.slice(t,i),c=0;c<s;++c)if(l[c]!==f[c]){a=l[c],o=f[c];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},u.prototype.indexOf=function(e,t,i){return s(this,e,t,i,!0)},u.prototype.lastIndexOf=function(e,t,i){return s(this,e,t,i,!1)},u.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(i)?(i>>>=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-t;if((void 0===i||n<i)&&(i=n),0<e.length&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r=r||"utf8";for(var a,o,s,l,f,c=!1;;)switch(r){case"hex":var u=this,p=e,d=t,h=i,m=(d=Number(d)||0,u.length-d);(!h||(h=Number(h))>m)&&(h=m),(m=p.length)/2<h&&(h=m/2);for(var g=0;g<h;++g){var v=parseInt(p.substr(2*g,2),16);if(P(v))return g;u[d+g]=v}return g;case"utf8":case"utf-8":return m=t,f=i,T(S(e,(l=this).length-m),l,m,f);case"ascii":return w(this,e,t,i);case"latin1":case"binary":return w(this,e,t,i);case"base64":return l=this,f=t,s=i,T(x(e),l,f,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s=t,o=i,T(function(e,t){for(var i,r,n=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(i=e.charCodeAt(a))>>8,n.push(i%256),n.push(r);return n}(e,(a=this).length-s),a,s,o);default:if(c)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),c=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var g=4096;function f(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(i<e+t)throw new RangeError("Trying to access beyond buffer length")}function m(e,t,i,r,n,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n<t||t<a)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function v(e,t,i,r){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function y(e,t,i,r,n){return t=+t,i>>>=0,n||v(e,0,i,4),a.write(e,t,i,r,23,4),i+4}function b(e,t,i,r,n){return t=+t,i>>>=0,n||v(e,0,i,8),a.write(e,t,i,r,52,8),i+8}u.prototype.slice=function(e,t){var i=this.length,i=((e=~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),t<e&&(t=e),this.subarray(e,t));return i.__proto__=u.prototype,i},u.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||f(e,t,this.length);for(var r=this[e],n=1,a=0;++a<t&&(n*=256);)r+=this[e+a]*n;return r},u.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||f(e,t,this.length);for(var r=this[e+--t],n=1;0<t&&(n*=256);)r+=this[e+--t]*n;return r},u.prototype.readUInt8=function(e,t){return e>>>=0,t||f(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||f(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||f(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||f(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||f(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||f(e,t,this.length);for(var r=this[e],n=1,a=0;++a<t&&(n*=256);)r+=this[e+a]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||f(e,t,this.length);for(var r=t,n=1,a=this[e+--r];0<r&&(n*=256);)a+=this[e+--r]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return e>>>=0,t||f(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||f(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt16BE=function(e,t){e>>>=0,t||f(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||f(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||f(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||f(e,4,this.length),a.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||f(e,4,this.length),a.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||f(e,8,this.length),a.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||f(e,8,this.length),a.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,i,r){e=+e,t>>>=0,i>>>=0,r||m(this,e,t,i,Math.pow(2,8*i)-1,0);var n=1,a=0;for(this[t]=255&e;++a<i&&(n*=256);)this[t+a]=e/n&255;return t+i},u.prototype.writeUIntBE=function(e,t,i,r){e=+e,t>>>=0,i>>>=0,r||m(this,e,t,i,Math.pow(2,8*i)-1,0);var n=i-1,a=1;for(this[t+n]=255&e;0<=--n&&(a*=256);)this[t+n]=e/a&255;return t+i},u.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||m(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||m(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||m(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||m(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||m(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,i,r){e=+e,t>>>=0,r||m(this,e,t,i,(r=Math.pow(2,8*i-1))-1,-r);var n=0,a=1,o=0;for(this[t]=255&e;++n<i&&(a*=256);)e<0&&0===o&&0!==this[t+n-1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+i},u.prototype.writeIntBE=function(e,t,i,r){e=+e,t>>>=0,r||m(this,e,t,i,(r=Math.pow(2,8*i-1))-1,-r);var n=i-1,a=1,o=0;for(this[t+n]=255&e;0<=--n&&(a*=256);)e<0&&0===o&&0!==this[t+n+1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+i},u.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||m(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},u.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||m(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||m(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||m(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||m(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,i){return y(this,e,t,!0,i)},u.prototype.writeFloatBE=function(e,t,i){return y(this,e,t,!1,i)},u.prototype.writeDoubleLE=function(e,t,i){return b(this,e,t,!0,i)},u.prototype.writeDoubleBE=function(e,t,i){return b(this,e,t,!1,i)},u.prototype.copy=function(e,t,i,r){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i=i||0,r||0===r||(r=this.length),t>=e.length&&(t=e.length),(r=0<r&&r<i?i:r)===i)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length);var n=(r=e.length-t<r-i?e.length-t+i:r)-i;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,i,r);else if(this===e&&i<t&&t<r)for(var a=n-1;0<=a;--a)e[a+t]=this[a+i];else Uint8Array.prototype.set.call(e,this.subarray(i,r),t);return n},u.prototype.fill=function(e,t,i,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var n;1===e.length&&(n=e.charCodeAt(0),"utf8"===r&&n<128||"latin1"===r)&&(e=n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");var a;if(!(i<=t))if(t>>>=0,i=void 0===i?this.length:i>>>0,"number"==typeof(e=e||0))for(a=t;a<i;++a)this[a]=e;else{var o=u.isBuffer(e)?e:u.from(e,r),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<i-t;++a)this[a+t]=o[a%s]}return this};var _=/[^+\/0-9A-Za-z-_]/g;function S(e,t){var i;t=t||1/0;for(var r=e.length,n=null,a=[],o=0;o<r;++o){if(55295<(i=e.charCodeAt(o))&&i<57344){if(!n){if(56319<i){-1<(t-=3)&&a.push(239,191,189);continue}if(o+1===r){-1<(t-=3)&&a.push(239,191,189);continue}n=i;continue}if(i<56320){-1<(t-=3)&&a.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&-1<(t-=3)&&a.push(239,191,189);if(n=null,i<128){if(--t<0)break;a.push(i)}else if(i<2048){if((t-=2)<0)break;a.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;a.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return a}function x(e){return C.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(_,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function T(e,t,i,r){for(var n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}function E(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function P(e){return e!=e}}.call(this,e("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:3}],3:[function(e,t,i){i.read=function(e,t,i,r,n){var a,o,s=8*n-r-1,l=(1<<s)-1,f=l>>1,c=-7,u=i?n-1:0,p=i?-1:1,n=e[t+u];for(u+=p,a=n&(1<<-c)-1,n>>=-c,c+=s;0<c;a=256*a+e[t+u],u+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;0<c;o=256*o+e[t+u],u+=p,c-=8);if(0===a)a=1-f;else{if(a===l)return o?NaN:1/0*(n?-1:1);o+=Math.pow(2,r),a-=f}return(n?-1:1)*o*Math.pow(2,a-r)},i.write=function(e,t,i,r,n,a){var o,s,l=8*a-n-1,f=(1<<l)-1,c=f>>1,u=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,d=r?1:-1,a=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=f):(o=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-o))<1&&(o--,r*=2),2<=(t+=1<=o+c?u/r:u*Math.pow(2,1-c))*r&&(o++,r/=2),f<=o+c?(s=0,o=f):1<=o+c?(s=(t*r-1)*Math.pow(2,n),o+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,n),o=0));8<=n;e[i+p]=255&s,p+=d,s/=256,n-=8);for(o=o<<n|s,l+=n;0<l;e[i+p]=255&o,p+=d,o/=256,l-=8);e[i+p-d]|=128*a}},{}],4:[function(O,e,$){!function(c){"use strict";const g=O("base64-js"),a=O("ieee754"),e="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null,t=($.Buffer=c,$.SlowBuffer=function(e){return c.alloc(+(e=+e!=e?0:e))},$.INSPECT_MAX_BYTES=50,2147483647);function s(e){if(e>t)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return Object.setPrototypeOf(e,c.prototype),e}function c(e,t,i){if("number"!=typeof e)return r(e,t,i);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return o(e)}function r(t,i,e){if("string"==typeof t){var r=t,n=i;if(!c.isEncoding(n="string"==typeof n&&""!==n?n:"utf8"))throw new TypeError("Unknown encoding: "+n);var a=0|p(r,n);let e=s(a);return r=e.write(r,n),e=r!==a?e.slice(0,r):e}if(ArrayBuffer.isView(t))return R(n=t,Uint8Array)?f((a=new Uint8Array(n)).buffer,a.byteOffset,a.byteLength):l(n);if(null!=t){if(R(t,ArrayBuffer)||t&&R(t.buffer,ArrayBuffer))return f(t,i,e);if("undefined"!=typeof SharedArrayBuffer&&(R(t,SharedArrayBuffer)||t&&R(t.buffer,SharedArrayBuffer)))return f(t,i,e);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return c.from(r,i,e);var o=function(e){if(c.isBuffer(e)){const c=0|u(e.length),t=s(c);return 0===t.length||e.copy(t,0,0,c),t}return void 0!==e.length?"number"!=typeof e.length||D(e.length)?s(0):l(e):"Buffer"===e.type&&Array.isArray(e.data)?l(e.data):void 0}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return c.from(t[Symbol.toPrimitive]("string"),i,e)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function n(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function o(e){return n(e),s(e<0?0:0|u(e))}function l(t){var i=t.length<0?0:0|u(t.length),r=s(i);for(let e=0;e<i;e+=1)r[e]=255&t[e];return r}function f(e,t,i){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(i||0))throw new RangeError('"length" is outside of buffer bounds');e=void 0===t&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,t):new Uint8Array(e,t,i);return Object.setPrototypeOf(e,c.prototype),e}function u(e){if(e>=t)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+t.toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||R(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var i=e.length,r=2<arguments.length&&!0===arguments[2];if(!r&&0===i)return 0;let n=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return F(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return M(e).length;default:if(n)return r?-1:F(e).length;t=(""+t).toLowerCase(),n=!0}}function i(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function d(e,t,i,r,n){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),(i=(i=D(i=+i)?n?0:e.length-1:i)<0?e.length+i:i)>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:h(e,t,i,r,n);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(n?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,i):h(e,[t],i,r,n);throw new TypeError("val must be string, number or Buffer")}function h(i,r,t,e,n){let a,o=1,s=i.length,l=r.length;if(void 0!==e&&("ucs2"===(e=String(e).toLowerCase())||"ucs-2"===e||"utf16le"===e||"utf-16le"===e)){if(i.length<2||r.length<2)return-1;o=2,s/=2,l/=2,t/=2}function f(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(n){let e=-1;for(a=t;a<s;a++)if(f(i,a)===f(r,-1===e?0:a-e)){if(-1===e&&(e=a),a-e+1===l)return e*o}else-1!==e&&(a-=a-e),e=-1}else for(t+l>s&&(t=s-l),a=t;0<=a;a--){let t=!0;for(let e=0;e<l;e++)if(f(i,a+e)!==f(r,e)){t=!1;break}if(t)return a}return-1}function v(o,s,e){e=Math.min(o.length,e);var i=[];let l=s;for(;l<e;){const s=o[l];let n=null,a=239<s?4:223<s?3:191<s?2:1;if(l+a<=e){let e,t,i,r;switch(a){case 1:s<128&&(n=s);break;case 2:128==(192&(e=o[l+1]))&&127<(r=(31&s)<<6|63&e)&&(n=r);break;case 3:e=o[l+1],t=o[l+2],128==(192&e)&&128==(192&t)&&2047<(r=(15&s)<<12|(63&e)<<6|63&t)&&(r<55296||57343<r)&&(n=r);break;case 4:e=o[l+1],t=o[l+2],i=o[l+3],128==(192&e)&&128==(192&t)&&128==(192&i)&&65535<(r=(15&s)<<18|(63&e)<<12|(63&t)<<6|63&i)&&r<1114112&&(n=r)}}null===n?(n=65533,a=1):65535<n&&(n-=65536,i.push(n>>>10&1023|55296),n=56320|1023&n),i.push(n),l+=a}{var r=i,n=r.length;if(n<=m)return String.fromCharCode.apply(String,r);let e="",t=0;for(;t<n;)e+=String.fromCharCode.apply(String,r.slice(t,t+=m));return e}}$.kMaxLength=t,c.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=r,Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(e,t,i){return t=t,i=i,n(e=e),!(e<=0)&&void 0!==t?"string"==typeof i?s(e).fill(t,i):s(e).fill(t):s(e)},c.allocUnsafe=o,c.allocUnsafeSlow=o,c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(i,r){if(R(i,Uint8Array)&&(i=c.from(i,i.offset,i.byteLength)),R(r,Uint8Array)&&(r=c.from(r,r.offset,r.byteLength)),!c.isBuffer(i)||!c.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===r)return 0;let n=i.length,a=r.length;for(let e=0,t=Math.min(n,a);e<t;++e)if(i[e]!==r[e]){n=i[e],a=r[e];break}return n<a?-1:a<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);let i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var r=c.allocUnsafe(e);let n=0;for(i=0;i<t.length;++i){let e=t[i];if(R(e,Uint8Array))n+e.length>r.length?(e=c.isBuffer(e)?e:c.from(e)).copy(r,n):Uint8Array.prototype.set.call(r,e,n);else{if(!c.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(r,n)}n+=e.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)i(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)i(this,e,e+3),i(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)i(this,e,e+7),i(this,e+1,e+6),i(this,e+2,e+5),i(this,e+3,e+4);return this},c.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?v(this,0,e):function(e,i,r){let t=!1;if((i=void 0===i||i<0?0:i)>this.length)return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(i>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":{var n=this;var a=i;var o=r;var s=n.length;(!a||a<0)&&(a=0),(!o||o<0||s<o)&&(o=s);let t="";for(let e=a;e<o;++e)t+=z[n[e]];return t;return}case"utf8":case"utf-8":return v(this,i,r);case"ascii":{var l=this;s=i;var f=r;let t="";f=Math.min(l.length,f);for(let e=s;e<f;++e)t+=String.fromCharCode(127&l[e]);return t;return}case"latin1":case"binary":{var c=this;a=i;var u=r;let t="";u=Math.min(c.length,u);for(let e=a;e<u;++e)t+=String.fromCharCode(c[e]);return t;return}case"base64":return d=this,m=r,0===(h=i)&&m===d.length?g.fromByteArray(d):g.fromByteArray(d.slice(h,m));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":{d=this;h=i;m=r;var p=d.slice(h,m);let t="";for(let e=0;e<p.length-1;e+=2)t+=String.fromCharCode(p[e]+256*p[e+1]);return t;return}default:if(t)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),t=!0}var d,h,m}.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(e){if(c.isBuffer(e))return this===e||0===c.compare(this,e);throw new TypeError("Argument must be a Buffer")},c.prototype.inspect=function(){let e="";var t=$.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},e&&(c.prototype[e]=c.prototype.inspect),c.prototype.compare=function(e,t,i,r,n){if(R(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),(t=void 0===t?0:t)<0||i>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(n<=r&&i<=t)return 0;if(n<=r)return-1;if(i<=t)return 1;if(this===e)return 0;let a=(n>>>=0)-(r>>>=0),o=(i>>>=0)-(t>>>=0);var s=Math.min(a,o),l=this.slice(r,n),f=e.slice(t,i);for(let e=0;e<s;++e)if(l[e]!==f[e]){a=l[e],o=f[e];break}return a<o?-1:o<a?1:0},c.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},c.prototype.indexOf=function(e,t,i){return d(this,e,t,i,!0)},c.prototype.lastIndexOf=function(e,t,i){return d(this,e,t,i,!1)},c.prototype.write=function(t,i,r,e){if(void 0===i)e="utf8",r=this.length,i=0;else if(void 0===r&&"string"==typeof i)e=i,r=this.length,i=0;else{if(!isFinite(i))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");i>>>=0,isFinite(r)?(r>>>=0,void 0===e&&(e="utf8")):(e=r,r=void 0)}var n,a,o,s,l,f,c=this.length-i;if((void 0===r||c<r)&&(r=c),0<t.length&&(r<0||i<0)||i>this.length)throw new RangeError("Attempt to write outside buffer bounds");e=e||"utf8";let u=!1;for(;;)switch(e){case"hex":{var p=this;var d=t;var h=i;var m=r;h=Number(h)||0;var g=p.length-h,g=((!m||(m=Number(m))>g)&&(m=g),d.length);let e;for(g/2<m&&(m=g/2),e=0;e<m;++e){const m=parseInt(d.substr(2*e,2),16);if(D(m))return e;p[h+e]=m}return e;return}case"utf8":case"utf-8":return g=i,f=r,B(F(t,(l=this).length-g),l,g,f);case"ascii":case"latin1":case"binary":return l=this,f=i,s=r,B(function(t){var i=[];for(let e=0;e<t.length;++e)i.push(255&t.charCodeAt(e));return i}(t),l,f,s);case"base64":return s=this,a=i,o=r,B(M(t),s,a,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a=i,o=r,B(function(t,i){var r,n,a=[];for(let e=0;e<t.length&&!((i-=2)<0);++e)n=(r=t.charCodeAt(e))>>8,a.push(r%256),a.push(n);return a}(t,(n=this).length-a),n,a,o);default:if(u)throw new TypeError("Unknown encoding: "+e);e=(""+e).toLowerCase(),u=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const m=4096;function w(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(i<e+t)throw new RangeError("Trying to access beyond buffer length")}function y(e,t,i,r,n,a){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n<t||t<a)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function b(e,t,i,r,n){P(t,r,n,e,i,7);r=Number(t&BigInt(4294967295)),e[i++]=r,e[i++]=r>>=8,e[i++]=r>>=8,e[i++]=r>>=8,n=Number(t>>BigInt(32)&BigInt(4294967295));return e[i++]=n,e[i++]=n>>=8,e[i++]=n>>=8,e[i++]=n>>=8,i}function _(e,t,i,r,n){P(t,r,n,e,i,7);r=Number(t&BigInt(4294967295)),e[i+7]=r,e[i+6]=r>>=8,e[i+5]=r>>=8,e[i+4]=r>>=8,n=Number(t>>BigInt(32)&BigInt(4294967295));return e[i+3]=n,e[i+2]=n>>=8,e[i+1]=n>>=8,e[i]=n>>=8,i+8}function S(e,t,i,r){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function x(e,t,i,r,n){return t=+t,i>>>=0,n||S(e,0,i,4),a.write(e,t,i,r,23,4),i+4}function C(e,t,i,r,n){return t=+t,i>>>=0,n||S(e,0,i,8),a.write(e,t,i,r,52,8),i+8}c.prototype.slice=function(e,t){var i=this.length,i=((e=~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),t<e&&(t=e),this.subarray(e,t));return Object.setPrototypeOf(i,c.prototype),i},c.prototype.readUintLE=c.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||w(e,t,this.length);let r=this[e],n=1,a=0;for(;++a<t&&(n*=256);)r+=this[e+a]*n;return r},c.prototype.readUintBE=c.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||w(e,t,this.length);let r=this[e+--t],n=1;for(;0<t&&(n*=256);)r+=this[e+--t]*n;return r},c.prototype.readUint8=c.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readBigUInt64LE=U(function(e){I(e>>>=0,"offset");var t=this[e],i=this[e+7],t=(void 0!==t&&void 0!==i||A(e,this.length-8),t+256*this[++e]+65536*this[++e]+this[++e]*2**24),e=this[++e]+256*this[++e]+65536*this[++e]+i*2**24;return BigInt(t)+(BigInt(e)<<BigInt(32))}),c.prototype.readBigUInt64BE=U(function(e){I(e>>>=0,"offset");var t=this[e],i=this[e+7],t=(void 0!==t&&void 0!==i||A(e,this.length-8),t*2**24+65536*this[++e]+256*this[++e]+this[++e]),e=this[++e]*2**24+65536*this[++e]+256*this[++e]+i;return(BigInt(t)<<BigInt(32))+BigInt(e)}),c.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||w(e,t,this.length);let r=this[e],n=1,a=0;for(;++a<t&&(n*=256);)r+=this[e+a]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||w(e,t,this.length);let r=t,n=1,a=this[e+--r];for(;0<r&&(n*=256);)a+=this[e+--r]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*t)),a},c.prototype.readInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},c.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readBigInt64LE=U(function(e){I(e>>>=0,"offset");var t=this[e],i=this[e+7],i=(void 0!==t&&void 0!==i||A(e,this.length-8),this[e+4]+256*this[e+5]+65536*this[e+6]+(i<<24));return(BigInt(i)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)}),c.prototype.readBigInt64BE=U(function(e){I(e>>>=0,"offset");var t=this[e],i=this[e+7],t=(void 0!==t&&void 0!==i||A(e,this.length-8),(t<<24)+65536*this[++e]+256*this[++e]+this[++e]);return(BigInt(t)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+i)}),c.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),a.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),a.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),a.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),a.read(this,e,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(e,t,i,r){e=+e,t>>>=0,i>>>=0,r||y(this,e,t,i,Math.pow(2,8*i)-1,0);let n=1,a=0;for(this[t]=255&e;++a<i&&(n*=256);)this[t+a]=e/n&255;return t+i},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(e,t,i,r){e=+e,t>>>=0,i>>>=0,r||y(this,e,t,i,Math.pow(2,8*i)-1,0);let n=i-1,a=1;for(this[t+n]=255&e;0<=--n&&(a*=256);)this[t+n]=e/a&255;return t+i},c.prototype.writeUint8=c.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||y(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||y(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||y(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||y(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||y(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigUInt64LE=U(function(e,t=0){return b(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=U(function(e,t=0){return _(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(e,t,i,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*i-1);y(this,e,t,i,r-1,-r)}let n=0,a=1,o=0;for(this[t]=255&e;++n<i&&(a*=256);)e<0&&0===o&&0!==this[t+n-1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+i},c.prototype.writeIntBE=function(e,t,i,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*i-1);y(this,e,t,i,r-1,-r)}let n=i-1,a=1,o=0;for(this[t+n]=255&e;0<=--n&&(a*=256);)e<0&&0===o&&0!==this[t+n+1]&&(o=1),this[t+n]=(e/a>>0)-o&255;return t+i},c.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||y(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},c.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||y(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||y(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||y(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||y(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeBigInt64LE=U(function(e,t=0){return b(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=U(function(e,t=0){return _(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeFloatLE=function(e,t,i){return x(this,e,t,!0,i)},c.prototype.writeFloatBE=function(e,t,i){return x(this,e,t,!1,i)},c.prototype.writeDoubleLE=function(e,t,i){return C(this,e,t,!0,i)},c.prototype.writeDoubleBE=function(e,t,i){return C(this,e,t,!1,i)},c.prototype.copy=function(e,t,i,r){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i=i||0,r||0===r||(r=this.length),t>=e.length&&(t=e.length),(r=0<r&&r<i?i:r)===i)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length);var n=(r=e.length-t<r-i?e.length-t+i:r)-i;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,i,r):Uint8Array.prototype.set.call(e,this.subarray(i,r),t),n},c.prototype.fill=function(t,i,r,n){if("string"==typeof t){if("string"==typeof i?(n=i,i=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){const c=t.charCodeAt(0);("utf8"===n&&c<128||"latin1"===n)&&(t=c)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(i<0||this.length<i||this.length<r)throw new RangeError("Out of range index");if(!(r<=i)){let e;if(i>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(t=t||0))for(e=i;e<r;++e)this[e]=t;else{var a=c.isBuffer(t)?t:c.from(t,n),o=a.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(e=0;e<r-i;++e)this[e+i]=a[e%o]}}return this};const k={};function T(e,t,i){k[e]=class extends i{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=this.name+` [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return this.name+` [${e}]: `+this.message}}}function E(e){let t="",i=e.length;for(var r="-"===e[0]?1:0;i>=4+r;i-=3)t="_"+e.slice(i-3,i)+t;return""+e.slice(0,i)+t}function P(e,t,i,r,n,a){if(i<e||e<t){const r="bigint"==typeof t?"n":"";t=3<a?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** `+8*(a+1)+r:`>= -(2${r} ** ${8*(a+1)-1}${r}) and < 2 ** `+(8*(a+1)-1)+r:`>= ${t}${r} and <= `+i+r;throw new k.ERR_OUT_OF_RANGE("value",t,e)}i=r,t=a,I(e=n,"offset"),void 0!==i[e]&&void 0!==i[e+t]||A(e,i.length-(t+1))}function I(e,t){if("number"!=typeof e)throw new k.ERR_INVALID_ARG_TYPE(t,"number",e)}function A(e,t,i){if(Math.floor(e)!==e)throw I(e,i),new k.ERR_OUT_OF_RANGE(i||"offset","an integer",e);if(t<0)throw new k.ERR_BUFFER_OUT_OF_BOUNDS;throw new k.ERR_OUT_OF_RANGE(i||"offset",`>= ${i?1:0} and <= `+t,e)}T("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?e+" is outside of buffer bounds":"Attempt to access memory outside buffer bounds"},RangeError),T("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type `+typeof t},TypeError),T("ERR_OUT_OF_RANGE",function(e,t,i){let r=`The value of "${e}" is out of range.`,n=i;return Number.isInteger(i)&&Math.abs(i)>2**32?n=E(String(i)):"bigint"==typeof i&&(n=String(i),(i>BigInt(2)**BigInt(32)||i<-(BigInt(2)**BigInt(32)))&&(n=E(n)),n+="n"),r+(` It must be ${t}. Received `+n)},RangeError);const L=/[^+\/0-9A-Za-z-_]/g;function F(t,i){let r;i=i||1/0;var n=t.length;let a=null;var o=[];for(let e=0;e<n;++e){if(55295<(r=t.charCodeAt(e))&&r<57344){if(!a){if(56319<r){-1<(i-=3)&&o.push(239,191,189);continue}if(e+1===n){-1<(i-=3)&&o.push(239,191,189);continue}a=r;continue}if(r<56320){-1<(i-=3)&&o.push(239,191,189),a=r;continue}r=65536+(a-55296<<10|r-56320)}else a&&-1<(i-=3)&&o.push(239,191,189);if(a=null,r<128){if(--i<0)break;o.push(r)}else if(r<2048){if((i-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((i-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((i-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function M(e){return g.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(L,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,i,r){let n;for(n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}function R(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function D(e){return e!=e}const z=function(){var i=new Array(256);for(let t=0;t<16;++t){var r=16*t;for(let e=0;e<16;++e)i[r+e]="0123456789abcdef"[t]+"0123456789abcdef"[e]}return i}();function U(e){return"undefined"==typeof BigInt?j:e}function j(){throw new Error("BigInt not supported")}}.call(this,O("buffer").Buffer)},{"base64-js":5,buffer:2,ieee754:6}],5:[function(e,t,i){"use strict";i.byteLength=function(e){var e=c(e),t=e[0],e=e[1];return 3*(t+e)/4-e},i.toByteArray=function(e){for(var t,i=c(e),r=i[0],i=i[1],n=new f(3*(r+i)/4-i),a=0,o=0<i?r-4:r,s=0;s<o;s+=4)t=l[e.charCodeAt(s)]<<18|l[e.charCodeAt(s+1)]<<12|l[e.charCodeAt(s+2)]<<6|l[e.charCodeAt(s+3)],n[a++]=t>>16&255,n[a++]=t>>8&255,n[a++]=255&t;return 2===i&&(t=l[e.charCodeAt(s)]<<2|l[e.charCodeAt(s+1)]>>4,n[a++]=255&t),1===i&&(t=l[e.charCodeAt(s)]<<10|l[e.charCodeAt(s+1)]<<4|l[e.charCodeAt(s+2)]>>2,n[a++]=t>>8&255,n[a++]=255&t),n},i.fromByteArray=function(e){for(var t,i=e.length,r=i%3,n=[],a=0,o=i-r;a<o;a+=16383)n.push(function(e,t,i){for(var r,n=[],a=t;a<i;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),n.push(s[(r=r)>>18&63]+s[r>>12&63]+s[r>>6&63]+s[63&r]);return n.join("")}(e,a,o<a+16383?o:a+16383));return 1==r?(t=e[i-1],n.push(s[t>>2]+s[t<<4&63]+"==")):2==r&&(t=(e[i-2]<<8)+e[i-1],n.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"=")),n.join("")};for(var s=[],l=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,a=r.length;n<a;++n)s[n]=r[n],l[r.charCodeAt(n)]=n;function c(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("=");return[e=-1===e?t:e,e===t?0:4-e%4]}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],6:[function(e,t,i){i.read=function(e,t,i,r,n){var a,o,s=8*n-r-1,l=(1<<s)-1,f=l>>1,c=-7,u=i?n-1:0,p=i?-1:1,n=e[t+u];for(u+=p,a=n&(1<<-c)-1,n>>=-c,c+=s;0<c;a=256*a+e[t+u],u+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;0<c;o=256*o+e[t+u],u+=p,c-=8);if(0===a)a=1-f;else{if(a===l)return o?NaN:1/0*(n?-1:1);o+=Math.pow(2,r),a-=f}return(n?-1:1)*o*Math.pow(2,a-r)},i.write=function(e,t,i,r,n,a){var o,s,l=8*a-n-1,f=(1<<l)-1,c=f>>1,u=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,d=r?1:-1,a=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=f):(o=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-o))<1&&(o--,r*=2),2<=(t+=1<=o+c?u/r:u*Math.pow(2,1-c))*r&&(o++,r/=2),f<=o+c?(s=0,o=f):1<=o+c?(s=(t*r-1)*Math.pow(2,n),o+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,n),o=0));8<=n;e[i+p]=255&s,p+=d,s/=256,n-=8);for(o=o<<n|s,l+=n;0<l;e[i+p]=255&o,p+=d,o/=256,l-=8);e[i+p-d]|=128*a}},{}]},{},[4])(4)});var Buffer,KrajeeFileTypeConfig={minimumBytes:4100,defaultMessages:"End-Of-Stream",tarHeaderChecksumMatches:function(t,i=0){var e=Number.parseInt(t.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(e))return!1;var r=256;for(let e=i;e<i+148;e++)r+=t[e];for(let e=i+156;e<i+512;e++)r+=t[e];return e===r},uint32SyncSafeToken:{get:function(e,t){return 127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21},len:4},dv:function(e){return new DataView(e.buffer,e.byteOffset)},Token:{UINT8:{len:1,get:function(e,t){return KrajeeFileTypeConfig.dv(e).getUint8(t)},put:function(e,t,i){return KrajeeFileTypeConfig.dv(e).setUint8(t,i),t+1}},UINT16_LE:{len:2,get:function(e,t){return KrajeeFileTypeConfig.dv(e).getUint16(t,!0)},put:function(e,t,i){return KrajeeFileTypeConfig.dv(e).setUint16(t,i,!0),t+2}},UINT16_BE:{len:2,get:function(e,t){return KrajeeFileTypeConfig.dv(e).getUint16(t)},put:function(e,t,i){return KrajeeFileTypeConfig.dv(e).setUint16(t,i),t+2}},INT32_BE:{len:4,get:function(e,t){return KrajeeFileTypeConfig.dv(e).getInt32(t)},put:function(e,t,i){return KrajeeFileTypeConfig.dv(e).setInt32(t,i),t+4}},UINT32_LE:{len:4,get:function(e,t){return KrajeeFileTypeConfig.dv(e).getUint32(t,!0)},put:function(e,t,i){return KrajeeFileTypeConfig.dv(e).setUint32(t,i,!0),t+4}},UINT32_BE:{len:4,get:function(e,t){return KrajeeFileTypeConfig.dv(e).getUint32(t)},put:function(e,t,i){return KrajeeFileTypeConfig.dv(e).setUint32(t,i),t+4}},UINT64_LE:{len:8,get:function(e,t){return KrajeeFileTypeConfig.dv(e).getBigUint64(t,!0)},put:function(e,t,i){return KrajeeFileTypeConfig.dv(e).setBigUint64(t,i,!0),t+8}},UINT64_BE:{len:8,get:function(e,t){return KrajeeFileTypeConfig.dv(e).getBigUint64(t)},put:function(e,t,i){return KrajeeFileTypeConfig.dv(e).setBigUint64(t,i),t+8}}}};class EndOfStreamError extends Error{constructor(){super(KrajeeFileTypeConfig.defaultMessages)}}class StringType{constructor(e,t){this.len=e,this.encoding=t}get(e,t){return Buffer.from(e).toString(this.encoding,t,t+this.len)}}async function fileTypeFromTokenizer(e){try{return(new FileTypeParser).parse(e)}catch(e){if(!(e instanceof EndOfStreamError))throw e}}class BufferTokenizer{constructor(e,t){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=t||{},this.uint8Array=e,this.fileInfo.size=this.fileInfo.size||e.length}async readToken(e,t=this.position){var i=Buffer.alloc(e.len);if(await this.readBuffer(i,{position:t})<e.len)throw new EndOfStreamError;return e.get(i,0)}async peekToken(e,t=this.position){var i=Buffer.alloc(e.len);if(await this.peekBuffer(i,{position:t})<e.len)throw new EndOfStreamError;return e.get(i,0)}async readBuffer(e,t){if(t&&t.position){if(t.position<this.position)throw Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=t.position}e=await this.peekBuffer(e,t);return this.position+=e,e}async peekBuffer(e,t){var t=this.normalizeOptions(e,t),i=Math.min(this.uint8Array.length-t.position,t.length);if(!t.mayBeLess&&i<t.length)throw new EndOfStreamError;return e.set(this.uint8Array.subarray(t.position,t.position+i),t.offset),i}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new EndOfStreamError;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new EndOfStreamError;return e.get(this.numBuffer,0)}async close(){}async ignore(e){if(void 0!==this.fileInfo.size){var t=this.fileInfo.size-this.position;if(t<e)return this.position+=t,t}return this.position+=e,e}normalizeOptions(e,t){if(t&&void 0!==t.position&&t.position<this.position)throw Error("`options.position` must be equal or greater than `tokenizer.position`");return t?{mayBeLess:!0===t.mayBeLess,offset:t.offset||0,length:t.length||e.length-(t.offset||0),position:t.position||this.position}:{mayBeLess:!1,offset:0,length:e.length,position:this.position}}}class FileTypeParser{_check(e,t,i){for(var[r,n]of(i={offset:0,...i},t.entries()))if(i.mask){if(n!==(i.mask[r]&e[r+i.offset]))return!1}else if(n!==e[r+i.offset])return!1;return!0}check(e,t){return this._check(this.buffer,e,t)}stringToBytes(e){return[...e].map(e=>e.charCodeAt(0))}checkString(e,t){return this.check(this.stringToBytes(e),t)}async parse(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof BufferTokenizer))throw TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);let t=e;if(!(t instanceof BufferTokenizer)){e=e instanceof Uint8Array?e:new Uint8Array(e);if(!(e&&1<e.length))return;t=new BufferTokenizer(e)}try{return this.parseTokenizer(t)}catch(e){if(!(e instanceof EndOfStreamError))throw e}}async parseTokenizer(n){let a=KrajeeFileTypeConfig.Token;if(this.buffer=Buffer.alloc(KrajeeFileTypeConfig.minimumBytes),void 0===n.fileInfo.size&&(n.fileInfo.size=Number.MAX_SAFE_INTEGER),await(this.tokenizer=n).peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await n.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3"))return await n.ignore(6),i=await n.readToken(KrajeeFileTypeConfig.uint32SyncSafeToken),n.position+i>n.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await n.ignore(i),console.log("KV SAYS",typeof n,n),fileTypeFromTokenizer(n));if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((67===this.buffer[0]||70===this.buffer[0])&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){try{for(;n.position+30<n.fileInfo.size;){await n.readBuffer(this.buffer,{length:30});var e={compressedSize:this.buffer.readUInt32LE(18),uncompressedSize:this.buffer.readUInt32LE(22),filenameLength:this.buffer.readUInt16LE(26),extraFieldLength:this.buffer.readUInt16LE(28)};if(e.filename=await n.readToken(new StringType(e.filenameLength,"utf-8")),await n.ignore(e.extraFieldLength),"META-INF/mozilla.rsa"===e.filename)return{ext:"xpi",mime:"application/x-xpinstall"};if(e.filename.endsWith(".rels")||e.filename.endsWith(".xml"))switch(e.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}if(e.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(e.filename.startsWith("3D/")&&e.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if("mimetype"===e.filename&&e.compressedSize===e.uncompressedSize)switch((await n.readToken(new StringType(e.compressedSize,"utf-8"))).trim()){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}if(0===e.compressedSize){let e=-1;for(;e<0&&n.position<n.fileInfo.size;)await n.peekBuffer(this.buffer,{mayBeLess:!0}),e=this.buffer.indexOf("504B0304",0,"hex"),await n.ignore(0<=e?e:this.buffer.length)}else await n.ignore(e.compressedSize)}}catch(e){if(!(e instanceof EndOfStreamError))throw e}return{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS"))return await n.ignore(28),i=Buffer.alloc(8),await n.readBuffer(i),this._check(i,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:this._check(i,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:this._check(i,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:this._check(i,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:this._check(i,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:this._check(i,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"};if(this.check([80,75])&&(3===this.buffer[2]||5===this.buffer[2]||7===this.buffer[2])&&(4===this.buffer[3]||6===this.buffer[3]||8===this.buffer[3]))return{ext:"zip",mime:"application/zip"};if(this.checkString("ftyp",{offset:4})&&0!=(96&this.buffer[8])){var t=this.buffer.toString("binary",8,12).replace("\0"," ").trim();switch(t){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return t.startsWith("3g")?t.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF"))return await n.ignore(1350),i=Buffer.alloc(Math.min(10485760,n.fileInfo.size)),await n.readBuffer(i,{mayBeLess:!0}),i.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"};if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){var i=await this.readTiffHeader(!1);if(i)return i}if(this.check([77,77])){i=await this.readTiffHeader(!0);if(i)return i}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function r(){let e=await n.peekNumber(a.UINT8),t=128,i=0;for(;0==(e&t);)++i,t>>=1;var r=Buffer.alloc(i+1);return await n.readBuffer(r),r}async function o(){var e=await r(),t=await r(),i=(t[0]^=128>>t.length-1,Math.min(6,t.length));return{id:e.readUIntBE(0,e.length),len:t.readUIntBE(t.length-i,i)}}switch(await async function(e){for(;0<e;){var t=await o();if(17026===t.id)return(await n.readToken(new StringType(t.len,"utf-8"))).replace(/\00.*$/g,"");await n.ignore(t.len),--e}}((await o()).len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(this.check([82,73,70,70])){if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(0===this.buffer[6]||1===this.buffer[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>"))return await n.ignore(8),"debian-binary"===await n.readToken(new StringType(13,"ascii"))?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(this.check([137,80,78,71,13,10,26,10])){await n.ignore(8);do{var s=await{length:await n.readToken(a.INT32_BE),type:await n.readToken(new StringType(4,"binary"))};if(s.length<0)return;switch(s.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await n.ignore(s.length+4)}}while(n.position+8<n.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([239,187,191])&&this.checkString("<?xml",{offset:3}))return{ext:"xml",mime:"application/xml"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){for(await n.ignore(30);n.position+24<n.fileInfo.size;){l=void 0,l=Buffer.alloc(16),await n.readBuffer(l);let e=await{id:l,size:Number(await n.readToken(a.UINT64_LE))},t=e.size-24;if(this._check(e.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){var l=Buffer.alloc(16);if(t-=await n.readBuffer(l),this._check(l,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(this._check(l,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await n.ignore(t)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await n.ignore(20),await n.readToken(new StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255,0,60,0,63,0,120,0,109,0,108])||this.check([255,254,60,0,63,0,120,0,109,0,108,0]))return{ext:"xml",mime:"application/xml"};if(this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await n.peekBuffer(this.buffer,{length:Math.min(256,n.fileInfo.size),mayBeLess:!0}),this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&16<=this.buffer.length){i=this.buffer.readUInt32LE(12);if(12<i&&this.buffer.length>=i+16)try{var f=this.buffer.slice(16,i+16).toString();if(JSON.parse(f).files)return{ext:"asar",mime:"application/x-asar"}}catch(e){console.log(e)}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188})||this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await n.peekBuffer(this.buffer,{length:Math.min(512,n.fileInfo.size),mayBeLess:!0}),KrajeeFileTypeConfig.tarHeaderChecksumMatches(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(2<=this.buffer.length&&this.check([255,224],{offset:0,mask:[255,224]})){if(this.check([16],{offset:1,mask:[22]}))return this.check([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}return{}}async readTiffTag(e){var t=KrajeeFileTypeConfig.Token,e=await this.tokenizer.readToken(e?t.UINT16_BE:t.UINT16_LE);switch(this.tokenizer.ignore(10),e){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"}}}async readTiffIFD(t){var e=KrajeeFileTypeConfig.Token,i=await this.tokenizer.readToken(t?e.UINT16_BE:e.UINT16_LE);for(let e=0;e<i;++e){var r=await this.readTiffTag(t);if(r)return r}}async readTiffHeader(e){var t=KrajeeFileTypeConfig.Token,i=(e?t.UINT16_BE:t.UINT16_LE).get(this.buffer,2),e=(e?t.UINT32_BE:t.UINT32_LE).get(this.buffer,4);if(42===i){if(6<=e){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(8<=e&&(this.check([28,0,254,0],{offset:8})||this.check([31,0,11,0],{offset:8})))return{ext:"nef",mime:"image/x-nikon-nef"}}return await this.tokenizer.ignore(e),await this.readTiffIFD(!1)||{ext:"tif",mime:"image/tiff"}}if(43===i)return{ext:"tif",mime:"image/tiff"}}}!function(){"use strict";function p(e){return C(">"+m("B",e.length),e)}function d(e){return C(">"+m("H",e.length),e)}function h(e){return C(">"+m("L",e.length),e)}function x(e,t,i){var r,n,a,o,s=Object.keys(e).length,l=C(">H",[s]),f=-1<["0th","1st"].indexOf(t)?2+12*s+4:2+12*s,c="",u="";for(r in e)"string"==typeof r&&(r=parseInt(r)),"0th"==t&&-1<[34665,34853].indexOf(r)||"Exif"==t&&40965==r||"1st"==t&&-1<[513,514].indexOf(r)||(n=e[r],o=C(">H",[r]),a=g[t][r].type,c+=o+C(">H",[E[a]])+(o=function(e,t,i){var r,n,a="",o="";if("Byte"==t)(s=e.length)<=4?o=p(e)+m("\0",4-s):(o=C(">L",[i]),a=p(e));else if("Short"==t)(s=e.length)<=2?o=d(e)+m("\0\0",2-s):(o=C(">L",[i]),a=d(e));else if("Long"==t)(s=e.length)<=1?o=h(e):(o=C(">L",[i]),a=h(e));else if("Ascii"==t)4<(s=(l=e+"\0").length)?(o=C(">L",[i]),a=l):o=l+m("\0",4-s);else if("Rational"==t){if("number"==typeof e[0])r=e[0],n=e[s=1],l=C(">L",[r])+C(">L",[n]);else for(var s=e.length,l="",f=0;f<s;f++)r=e[f][0],n=e[f][1],l+=C(">L",[r])+C(">L",[n]);o=C(">L",[i]),a=l}else if("SRational"==t){if("number"==typeof e[0])r=e[0],n=e[s=1],l=C(">l",[r])+C(">l",[n]);else{s=e.length,l="";for(f=0;f<s;f++)r=e[f][0],n=e[f][1],l+=C(">l",[r])+C(">l",[n])}o=C(">L",[i]),a=l}else"Undefined"==t&&(4<(s=e.length)?(o=C(">L",[i]),a=e):o=e+m("\0",4-s));return[C(">L",[s]),o,a]}(n="number"==typeof n?[n]:n,a,8+f+i+u.length))[0]+o[1],u+=o[2]);return[l+c,u]}function n(e){var t;if("ÿØ"==e.slice(0,2))t=function(e){for(var t,i=0;i<e.length;i++)if("ÿá"==(t=e[i]).slice(0,2)&&"Exif\0\0"==t.slice(4,10))return t;return null}(k(e)),this.tiftag=t?t.slice(10):null;else if(-1<["II","MM"].indexOf(e.slice(0,2)))this.tiftag=e;else{if("Exif"!=e.slice(0,4))throw new Error("Given file is neither JPEG nor TIFF.");this.tiftag=e.slice(6)}}function C(e,t){if(!(t instanceof Array))throw new Error("'pack' error. Got invalid type argument.");if(e.length-1!=t.length)throw new Error("'pack' error. "+(e.length-1)+" marks, "+t.length+" elements.");var i;if("<"==e[0])i=!0;else{if(">"!=e[0])throw new Error("");i=!1}for(var r="",n=1,a=null,o=null,s=null;o=e[n];){if("b"==o.toLowerCase()){if(a=t[n-1],"b"==o&&a<0&&(a+=256),255<a||a<0)throw new Error("'pack' error.");s=String.fromCharCode(a)}else{if("H"==o){if(65535<(a=t[n-1])||a<0)throw new Error("'pack' error.");s=String.fromCharCode(Math.floor(a%65536/256))+String.fromCharCode(a%256)}else{if("l"!=o.toLowerCase())throw new Error("'pack' error.");if(a=t[n-1],"l"==o&&a<0&&(a+=4294967296),4294967295<a||a<0)throw new Error("'pack' error.");s=String.fromCharCode(Math.floor(a/16777216))+String.fromCharCode(Math.floor(a%16777216/65536))+String.fromCharCode(Math.floor(a%65536/256))+String.fromCharCode(a%256)}i&&(s=s.split("").reverse().join(""))}r+=s,n+=1}return r}function f(e,t){if("string"!=typeof t)throw new Error("'unpack' error. Got invalid type argument.");for(var i,r=0,n=1;n<e.length;n++)if("b"==e[n].toLowerCase())r+=1;else if("h"==e[n].toLowerCase())r+=2;else{if("l"!=e[n].toLowerCase())throw new Error("'unpack' error. Got invalid mark.");r+=4}if(r!=t.length)throw new Error("'unpack' error. Mismatch between symbol and string length. "+r+":"+t.length);if("<"==e[0])i=!0;else{if(">"!=e[0])throw new Error("'unpack' error.");i=!1}for(var a=[],o=0,s=1,l=null,f=null,c=null,u="";f=e[s];){if("b"==f.toLowerCase())l=(u=t.slice(o,o+(c=1))).charCodeAt(0),"b"==f&&128<=l&&(l-=256);else if("H"==f)u=t.slice(o,o+(c=2)),l=256*(u=i?u.split("").reverse().join(""):u).charCodeAt(0)+u.charCodeAt(1);else{if("l"!=f.toLowerCase())throw new Error("'unpack' error. "+f);u=t.slice(o,o+(c=4)),l=16777216*(u=i?u.split("").reverse().join(""):u).charCodeAt(0)+65536*u.charCodeAt(1)+256*u.charCodeAt(2)+u.charCodeAt(3),"l"==f&&2147483648<=l&&(l-=4294967296)}a.push(l),o+=c,s+=1}return a}function m(e,t){for(var i="",r=0;r<t;r++)i+=e;return i}function k(e){if("ÿØ"!=e.slice(0,2))throw new Error("Given data isn't JPEG.");for(var t=2,i=["ÿØ"];;){if("ÿÚ"==e.slice(t,t+2)){i.push(e.slice(t));break}var r=t+f(">H",e.slice(t+2,t+4))[0]+2;if(i.push(e.slice(t,r)),(t=r)>=e.length)throw new Error("Wrong JPEG data.")}return i}var s,l,T={version:"1.0.4",remove:function(e){var t=!1;if("ÿØ"!=e.slice(0,2)){if("data:image/jpeg;base64,"!=e.slice(0,23)&&"data:image/jpg;base64,"!=e.slice(0,22))throw new Error("Given data is not jpeg.");e=l(e.split(",")[1]),t=!0}e=k(e).filter(function(e){return!("ÿá"==e.slice(0,2)&&"Exif\0\0"==e.slice(4,10))}).join("");return e=t?"data:image/jpeg;base64,"+s(e):e},insert:function(e,t){var i=!1;if("Exif\0\0"!=e.slice(0,6))throw new Error("Given data is not exif.");if("ÿØ"!=t.slice(0,2)){if("data:image/jpeg;base64,"!=t.slice(0,23)&&"data:image/jpg;base64,"!=t.slice(0,22))throw new Error("Given data is not jpeg.");t=l(t.split(",")[1]),i=!0}var r,n,a,o,e="ÿá"+C(">H",[e.length+2])+e,t=k(t),e=(n=e,a=!1,o=[],(r=t).forEach(function(e,t){"ÿá"==e.slice(0,2)&&"Exif\0\0"==e.slice(4,10)&&(a?o.unshift(t):(r[t]=n,a=!0))}),o.forEach(function(e){r.splice(e,1)}),(r=!a&&n?[r[0],n].concat(r.slice(1)):r).join(""));return e=i?"data:image/jpeg;base64,"+s(e):e},load:function(e){if("string"!=typeof e)throw new Error("'load' gots invalid type argument.");if("ÿØ"==e.slice(0,2))r=e;else if("data:image/jpeg;base64,"==e.slice(0,23)||"data:image/jpg;base64,"==e.slice(0,22))r=l(e.split(",")[1]);else{if("Exif"!=e.slice(0,4))throw new Error("'load' gots invalid file data.");r=e.slice(6)}var t,i,e={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},r=new n(r);return null!==r.tiftag&&("II"==r.tiftag.slice(0,2)?r.endian_mark="<":r.endian_mark=">",i=f(r.endian_mark+"L",r.tiftag.slice(4,8))[0],e["0th"]=r.get_ifd(i,"0th"),t=e["0th"].first_ifd_pointer,delete e["0th"].first_ifd_pointer,34665 in e["0th"]&&(i=e["0th"][34665],e.Exif=r.get_ifd(i,"Exif")),34853 in e["0th"]&&(i=e["0th"][34853],e.GPS=r.get_ifd(i,"GPS")),40965 in e.Exif&&(i=e.Exif[40965],e.Interop=r.get_ifd(i,"Interop")),"\0\0\0\0"!=t&&(i=f(r.endian_mark+"L",t)[0],e["1st"]=r.get_ifd(i,"1st"),513 in e["1st"])&&514 in e["1st"])&&(t=e["1st"][513]+e["1st"][514],i=r.tiftag.slice(e["1st"][513],t),e.thumbnail=i),e}},E=(T.dump=function(e){var e=JSON.parse(JSON.stringify(e)),t=!1,i=!1,r=!1,n=!1,a="0th"in e?e["0th"]:{};"Exif"in e&&Object.keys(e.Exif).length||"Interop"in e&&Object.keys(e.Interop).length?(a[34665]=1,t=!0,y=e.Exif,"Interop"in e&&Object.keys(e.Interop).length?(y[40965]=1,r=!0,_=e.Interop):-1<Object.keys(y).indexOf(T.ExifIFD.InteroperabilityTag.toString())&&delete y[40965]):-1<Object.keys(a).indexOf(T.ImageIFD.ExifTag.toString())&&delete a[34665],"GPS"in e&&Object.keys(e.GPS).length?(a[T.ImageIFD.GPSTag]=1,i=!0,b=e.GPS):-1<Object.keys(a).indexOf(T.ImageIFD.GPSTag.toString())&&delete a[T.ImageIFD.GPSTag],"1st"in e&&"thumbnail"in e&&null!=e.thumbnail&&(n=!0,e["1st"][513]=1,e["1st"][514]=1,S=e["1st"]);var o,a=x(a,"0th",0),s=a[0].length+12*t+12*i+4+a[1].length,l="",f=0,c="",u=0,p="",d=0,h="";if(t&&(f=(o=x(y,"Exif",s))[0].length+12*r+o[1].length),i&&(u=(c=x(b,"GPS",s+f).join("")).length),r&&(d=(p=x(_,"Interop",s+f+u).join("")).length),n){var m,g=x(S,"1st",s+f+u+d);if(64e3<(m=function(e){for(var t=k(e);"ÿà"<=t[1].slice(0,2)&&t[1].slice(0,2)<="ÿï";)t=[t[0]].concat(t.slice(2));return t.join("")}(e.thumbnail)).length)throw new Error("Given thumbnail is too large. max 64kB")}var v,w,y="",b="",_="",S="\0\0\0\0";return t&&(v=C(">L",[w=8+s]),y=C(">H",[34665])+C(">H",[E.Long])+C(">L",[1])+v),i&&(v=C(">L",[w=8+s+f]),b=C(">H",[34853])+C(">H",[E.Long])+C(">L",[1])+v),r&&(v=C(">L",[w=8+s+f+u]),_=C(">H",[40965])+C(">H",[E.Long])+C(">L",[1])+v),n&&(S=C(">L",[w=8+s+f+u+d]),e="\0\0\0\0"+C(">L",[w+g[0].length+24+4+g[1].length]),i="\0\0\0\0"+C(">L",[m.length]),h=g[0]+e+i+"\0\0\0\0"+g[1]+m),"Exif\0\0MM\0*\0\0\0\b"+(a[0]+y+b+S+a[1])+(l=t?o[0]+_+o[1]:l)+c+p+h},n.prototype={get_ifd:function(e,t){for(var i={},r=f(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],n=e+2,a=-1<["0th","1st"].indexOf(t)?"Image":t,o=0;o<r;o++){var s=f(this.endian_mark+"H",this.tiftag.slice(e=n+12*o,e+2))[0],l=[f(this.endian_mark+"H",this.tiftag.slice(e+2,e+4))[0],f(this.endian_mark+"L",this.tiftag.slice(e+4,e+8))[0],this.tiftag.slice(e+8,e+12)];s in g[a]&&(i[s]=this.convert_value(l))}return"0th"==t&&(i.first_ifd_pointer=this.tiftag.slice(e=n+12*r,e+4)),i},convert_value:function(e){var t,i=null,r=e[0],n=e[1],e=e[2];if(1==r)i=4<n?(t=f(this.endian_mark+"L",e)[0],f(this.endian_mark+m("B",n),this.tiftag.slice(t,t+n))):f(this.endian_mark+m("B",n),e.slice(0,n));else if(2==r)i=4<n?(t=f(this.endian_mark+"L",e)[0],this.tiftag.slice(t,t+n-1)):e.slice(0,n-1);else if(3==r)i=2<n?(t=f(this.endian_mark+"L",e)[0],f(this.endian_mark+m("H",n),this.tiftag.slice(t,t+2*n))):f(this.endian_mark+m("H",n),e.slice(0,2*n));else if(4==r)i=1<n?(t=f(this.endian_mark+"L",e)[0],f(this.endian_mark+m("L",n),this.tiftag.slice(t,t+4*n))):f(this.endian_mark+m("L",n),e);else if(5==r)if(t=f(this.endian_mark+"L",e)[0],1<n)for(var i=[],a=0;a<n;a++)i.push([f(this.endian_mark+"L",this.tiftag.slice(t+8*a,t+4+8*a))[0],f(this.endian_mark+"L",this.tiftag.slice(t+4+8*a,t+8+8*a))[0]]);else i=[f(this.endian_mark+"L",this.tiftag.slice(t,t+4))[0],f(this.endian_mark+"L",this.tiftag.slice(t+4,t+8))[0]];else if(7==r)i=4<n?(t=f(this.endian_mark+"L",e)[0],this.tiftag.slice(t,t+n)):e.slice(0,n);else if(9==r)i=1<n?(t=f(this.endian_mark+"L",e)[0],f(this.endian_mark+m("l",n),this.tiftag.slice(t,t+4*n))):f(this.endian_mark+m("l",n),e);else{if(10!=r)throw new Error("Exif might be wrong. Got incorrect value type to decode. type:"+r);if(t=f(this.endian_mark+"L",e)[0],1<n){i=[];for(a=0;a<n;a++)i.push([f(this.endian_mark+"l",this.tiftag.slice(t+8*a,t+4+8*a))[0],f(this.endian_mark+"l",this.tiftag.slice(t+4+8*a,t+8+8*a))[0]])}else i=[f(this.endian_mark+"l",this.tiftag.slice(t,t+4))[0],f(this.endian_mark+"l",this.tiftag.slice(t+4,t+8))[0]]}return i instanceof Array&&1==i.length?i[0]:i}},void 0===(s="undefined"!=typeof window&&"function"==typeof window.btoa?window.btoa:s)&&(s=function(e){for(var t,i,r,n,a,o,s="",l=0,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";l<e.length;)r=(t=e.charCodeAt(l++))>>2,n=(3&t)<<4|(t=e.charCodeAt(l++))>>4,a=(15&t)<<2|(i=e.charCodeAt(l++))>>6,o=63&i,isNaN(t)?a=o=64:isNaN(i)&&(o=64),s=s+f.charAt(r)+f.charAt(n)+f.charAt(a)+f.charAt(o);return s}),void 0===(l="undefined"!=typeof window&&"function"==typeof window.atob?window.atob:l)&&(l=function(e){var t,i,r,n,a,o,s="",l=0,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)r=f.indexOf(e.charAt(l++)),t=(15&(n=f.indexOf(e.charAt(l++))))<<4|(a=f.indexOf(e.charAt(l++)))>>2,i=(3&a)<<6|(o=f.indexOf(e.charAt(l++))),s+=String.fromCharCode(r<<2|n>>4),64!=a&&(s+=String.fromCharCode(t)),64!=o&&(s+=String.fromCharCode(i));return s}),{Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10}),g={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};g["0th"]=g.Image,g["1st"]=g.Image,T.TAGS=g,T.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},T.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},T.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},T.InteropIFD={InteroperabilityIndex:1},T.GPSHelper={degToDmsRational:function(e){var e=Math.abs(e),t=e%1*60,i=t%1*60;return[[Math.floor(e),1],[Math.floor(t),1],[Math.round(100*i),100]]},dmsRationalToDeg:function(e,t){return(e[0][0]/e[0][1]+e[1][0]/e[1][1]/60+e[2][0]/e[2][1]/3600)*("S"===t||"W"===t?-1:1)}},"undefined"!=typeof exports?(exports="undefined"!=typeof module&&module.exports?module.exports=T:exports).piexif=T:window.piexif=T}(),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof module&&"object"==typeof module.exports?require("jquery"):window.jQuery)}(function(N){"use strict";N.fn.fileinputLocales={},N.fn.fileinputThemes={},N.fn.fileinputBsVersion||(N.fn.fileinputBsVersion=window.bootstrap&&window.bootstrap.Alert&&window.bootstrap.Alert.VERSION||window.Alert&&window.Alert.VERSION||"3.x.x"),String.prototype.setTokens=function(e){var t,i,r=this.toString();for(t in e)e.hasOwnProperty(t)&&(i=new RegExp("{"+t+"}","g"),r=r.replace(i,e[t]));return r},Array.prototype.flatMap||(Array.prototype.flatMap=function(e){return[].concat(this.map(e))}),G={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",INIT_FLAG:"init-",SCRIPT_SRC:document&&document.currentScript&&document.currentScript.src||null,OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],logMessages:{ajaxError:"{status}: {error}. Error Details: {text}.",badDroppedFiles:"Error scanning dropped files!",badExifParser:"Error loading the piexif.js library. {details}",badInputType:'The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.',exifWarning:'To avoid this warning, either set "autoOrientImage" to "false" OR ensure you have loaded the "piexif.js" library correctly on your page before the "fileinput.js" script.',invalidChunkSize:'Invalid upload chunk size: "{chunkSize}". Resumable uploads are disabled.',invalidThumb:'Invalid thumb frame with id: "{id}".',noResumableSupport:"The browser does not support resumable or chunk uploads.",noUploadUrl:'The "uploadUrl" is not set. Ajax uploads and resumable uploads have been disabled.',retryStatus:"Retrying upload for chunk # {chunk} for {filename}... retry # {retry}.",chunkQueueError:"Could not push task to ajax pool for chunk index # {index}.",resumableMaxRetriesReached:"Maximum resumable ajax retries ({n}) reached.",resumableRetryError:"Could not retry the resumable request (try # {n})... aborting.",resumableAborting:"Aborting / cancelling the resumable request.",resumableRequestError:"Error processing resumable request. {msg}"},objUrl:window.URL||window.webkitURL,getZoomPlaceholder:function(){var e=G.SCRIPT_SRC,t="?kvTemp__2873389129__=";return e?(e=e.substring(0,e.lastIndexOf("/"))).substring(0,e.lastIndexOf("/")+1)+"img/loading.gif"+t:t},isBs:function(e){var t=N.trim((N.fn.fileinputBsVersion||"")+"");return e=parseInt(e,10),t?e===parseInt(t.charAt(0),10):4===e},defaultButtonCss:function(e){return"btn-default btn-"+(e?"":"outline-")+"secondary"},now:function(){return(new Date).getTime()},round:function(e){return e=parseFloat(e),isNaN(e)?0:Math.floor(Math.round(e))},getArray:function(e){for(var t=[],i=e&&e.length||0,r=0;r<i;r++)t.push(e[r]);return t},getFileRelativePath:function(e){return String(e.newPath||e.relativePath||e.webkitRelativePath||G.getFileName(e)||null)},getFileId:function(e,t){var i=G.getFileRelativePath(e);return"function"==typeof t?t(e):e&&i?e.size+"_"+encodeURIComponent(i).replace(/%/g,"_"):null},getFrameSelector:function(e,t){return'[id="'+e+'"]'+(t=t||"")},getZoomSelector:function(e,t){return G.getFrameSelector("zoom-"+e,t)},getFrameElement:function(e,t,i){return e.find(G.getFrameSelector(t,i))},getZoomElement:function(e,t,i){return e.find(G.getZoomSelector(t,i))},getElapsed:function(e){var t=e,i="",r={},n={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};return G.getObjectKeys(n).forEach(function(e){r[e]=Math.floor(t/n[e]),t-=r[e]*n[e]}),N.each(r,function(e,t){0<t&&(i+=(i?" ":"")+t+e.substring(0,1))}),i},debounce:function(i,r){var n;return function(){var e=arguments,t=this;clearTimeout(n),n=setTimeout(function(){i.apply(t,e)},r)}},stopEvent:function(e){e.stopPropagation(),e.preventDefault()},getFileName:function(e){return e&&(e.fileName||e.name)||""},createObjectURL:function(e){return G.objUrl&&G.objUrl.createObjectURL&&e?G.objUrl.createObjectURL(e):""},revokeObjectURL:function(e){G.objUrl&&G.objUrl.revokeObjectURL&&e&&G.objUrl.revokeObjectURL(e)},compare:function(e,t,i){return void 0!==e&&(i?e===t:e.match(t))},isIE:function(e){var t;return"Microsoft Internet Explorer"===navigator.appName&&(10===e?new RegExp("msie\\s"+e,"i").test(navigator.userAgent):((t=document.createElement("div")).innerHTML="\x3c!--[if IE "+e+"]> <i></i> <![endif]--\x3e",e=t.getElementsByTagName("i").length,document.body.appendChild(t),t.parentNode.removeChild(t),e))},canOrientImage:function(e){var e=N(document.createElement("img")).css({width:"1px",height:"1px"}).insertAfter(e),t=e.css("image-orientation");return e.remove(),!!t},canAssignFilesToInput:function(){var e=document.createElement("input");try{return e.type="file",!(e.files=null)}catch(e){return!1}},getDragDropFolders:function(e){var t,i,r=e?e.length:0,n=0;if(0<r&&e[0].webkitGetAsEntry())for(t=0;t<r;t++)(i=e[t].webkitGetAsEntry())&&i.isDirectory&&n++;return n},initModal:function(e){var t=N("body");t.length&&e.appendTo(t)},isFunction:function(e){return"function"==typeof e},isEmpty:function(e,t){return null==e||""===e||(G.isString(e)&&t?""===N.trim(e):G.isArray(e)?0===e.length:!(!N.isPlainObject(e)||!N.isEmptyObject(e)))},isArray:function(e){return Array.isArray(e)||"[object Array]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},ifSet:function(e,t,i){return i=i||"",t&&"object"==typeof t&&e in t?t[e]:i},cleanArray:function(e){return(e=e instanceof Array?e:[]).filter(function(e){return null!=e})},spliceArray:function(e,t,i){var r,n,a=0,o=[];if(!(e instanceof Array))return[];for(n=N.extend(!0,[],e),i&&n.reverse(),r=0;r<n.length;r++)r!==t&&(o[a]=n[r],a++);return i&&o.reverse(),o},getNum:function(e,t){return t=t||0,"number"!=typeof e&&("string"==typeof e&&(e=parseFloat(e)),isNaN(e))?t:e},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var e=document.createElement("div");return!G.isIE(9)&&(void 0!==e.draggable||void 0!==e.ondragstart&&void 0!==e.ondrop)},hasFileUploadSupport:function(){return G.hasFileAPISupport()&&window.FormData},hasBlobSupport:function(){try{return!!window.Blob&&Boolean(new Blob)}catch(e){return!1}},hasArrayBufferViewSupport:function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}},hasResumableUploadSupport:function(){return G.hasFileUploadSupport()&&G.hasBlobSupport()&&G.hasArrayBufferViewSupport()&&(!!Blob.prototype.webkitSlice||!!Blob.prototype.mozSlice||!!Blob.prototype.slice||!1)},dataURI2Blob:function(e){var t,i,r,n,a=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,o=G.hasBlobSupport();if(!((o||a)&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return null;for(t=(0<=e.split(",")[0].indexOf("base64")?atob:decodeURIComponent)(e.split(",")[1]),i=new ArrayBuffer(t.length),r=new Uint8Array(i),n=0;n<t.length;n+=1)r[n]=t.charCodeAt(n);return e=e.split(",")[0].split(":")[1].split(";")[0],o?new Blob([G.hasArrayBufferViewSupport()?r:i],{type:e}):((o=new a).append(i),o.getBlob(e))},arrayBuffer2String:function(e){if(window.TextDecoder)return new TextDecoder("utf-8").decode(e);for(var t,i,r,n=Array.prototype.slice.apply(new Uint8Array(e)),a="",o=0,s=n.length;o<s;)switch(t=n[o++],t>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(t);break;case 12:case 13:i=n[o++],a+=String.fromCharCode((31&t)<<6|63&i);break;case 14:i=n[o++],r=n[o++],a+=String.fromCharCode((15&t)<<12|(63&i)<<6|(63&r)<<0)}return a},isHtml:function(e){var t=document.createElement("div");t.innerHTML=e;for(var i=t.childNodes,r=i.length;r--;)if(1===i[r].nodeType)return!0;return!1},isPdf:function(e){return!G.isEmpty(e)&&0!==(e=e.toString().trim().replace(/\n/g," ")).length&&void 0},isSvg:function(e){return!G.isEmpty(e)&&0!==(e=e.toString().trim().replace(/\n/g," ")).length&&e.match(/^\s*<\?xml/i)&&(e.match(/<!DOCTYPE svg/i)||e.match(/<svg/i))},getMimeType:function(e,t,i){var r=e||"";switch(r){case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":return"image/jpeg";case"89504e47":return"image/png";case"47494638":return"image/gif";case"49492a00":return"image/tiff";case"52494646":return"image/webp";case"41433130":return"image/vnd.dwg";case"66747970":return"video/3gp";case"4f676753":return"video/ogg";case"1a45dfa3":return"video/mkv";case"000001ba":case"000001b3":return"video/mpeg";case"3026b275":return"video/wmv";case"25504446":return"application/pdf";case"25215053":return"application/ps";case"504b0304":case"504b0506":case"504b0508":return"application/zip";case"377abcaf":return"application/7z";case"75737461":return"application/tar";case"7801730d":return"application/dmg";default:switch(r.substring(0,6)){case"435753":return"application/x-shockwave-flash";case"494433":return"audio/mp3";case"425a68":return"application/bzip";default:switch(r.substring(0,4)){case"424d":return"image/bmp";case"fffb":return"audio/mp3";case"4d5a":return"application/exe";case"1f9d":case"1fa0":return"application/zip";case"1f8b":return"application/gzip";default:return t&&!t.match(/[^\u0000-\u007f]/)?"application/text-plain":i}}}},addCss:function(e,t){e.removeClass(t).addClass(t)},getElement:function(e,t,i){return G.isEmpty(e)||G.isEmpty(e[t])?i:N(e[t])},createElement:function(e,t){return N(N.parseHTML("<"+(t=t||"div")+">"+e+"</"+t+">"))},uniqId:function(){return((new Date).getTime()+Math.floor(Math.random()*Math.pow(10,15))).toString(36)},cspBuffer:{CSP_ATTRIB:"data-csp-01928735",domElementsStyles:{},stash:function(e){var a=this,t=N.parseHTML("<div>"+e+"</div>"),e=N(t);return e.find("[style]").each(function(e,t){var t=N(t),i=t[0].style,r=G.uniqId(),n={};i&&i.length&&(N(i).each(function(){n[this]=i[this]}),a.domElementsStyles[r]=n,t.removeAttr("style").attr(a.CSP_ATTRIB,r))}),e.filter("*").removeAttr("style"),(Object.values?Object.values(t):Object.keys(t).map(function(e){return t[e]})).flatMap(function(e){return e.innerHTML}).join("")},apply:function(e){var r=this;N(e).find("["+r.CSP_ATTRIB+"]").each(function(e,t){var t=N(t),i=t.attr(r.CSP_ATTRIB),i=r.domElementsStyles[i];i&&t.css(i),t.removeAttr(r.CSP_ATTRIB)}),r.domElementsStyles={}}},setHtml:function(e,t){var i=G.cspBuffer;return e.html(i.stash(t)),i.apply(e),e},htmlEncode:function(e,t){return void 0===e?t||null:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(e,t){var i=e;return t&&N.each(t,function(e,t){"function"==typeof t&&(t=t()),i=i.split(e).join(t)}),i},cleanMemory:function(e){e=(e.is("img")?e:e.find("source")).attr("src");G.revokeObjectURL(e)},findFileName:function(e){var t=e.lastIndexOf("/");return-1===t&&(t=e.lastIndexOf("\\")),e.split(e.substring(t,t+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(e){var t=document,i=t.documentElement,r=G.checkFullScreen();i&&e&&!r?i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen&&i.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):r&&(t.exitFullscreen?t.exitFullscreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen())},moveArray:function(e,t,i,r){var n=N.extend(!0,[],e);if(r&&n.reverse(),i>=n.length)for(var a=i-n.length;1+a--;)n.push(void 0);return n.splice(i,0,n.splice(t,1)[0]),r&&n.reverse(),n},closeButton:function(e){return'<button type="button" class="btn btn-light bg-transparent btn-sm '+(e=(G.isBs(5)?"btn-close":"close")+(e?" "+e:""))+'" aria-label="Close">\n'+(G.isBs(5)?"":'  <span aria-hidden="true">&times;</span>\n')+"</button>"},getRotation:function(e){switch(e){case 2:return"rotateY(180deg)";case 3:return"rotate(180deg)";case 4:return"rotate(180deg) rotateY(180deg)";case 5:return"rotate(270deg) rotateY(180deg)";case 6:return"rotate(90deg)";case 7:return"rotate(90deg) rotateY(180deg)";case 8:return"rotate(270deg)";default:return""}},setTransform:function(e,t){e&&(e.style.transform=t,e.style.webkitTransform=t,e.style["-moz-transform"]=t,e.style["-ms-transform"]=t,e.style["-o-transform"]=t)},getObjectKeys:function(e){var t=[];return e&&N.each(e,function(e){t.push(e)}),t},getObjectSize:function(e){return G.getObjectKeys(e).length},whenAll:function(e){for(var t,i,r,n=[].slice,a=1===arguments.length&&G.isArray(e)?e:n.call(arguments),o=N.Deferred(),s=0,l=a.length,f=l,c=i=r=Array(l),u=function(e,t,i){return function(){i!==a&&s++,o.notifyWith(t[e]=this,i[e]=n.call(arguments)),--f||o[(s?"reject":"resolve")+"With"](t,i)}},p=0;p<l;p++)(t=a[p])&&N.isFunction(t.promise)?t.promise().done(u(p,r,a)).fail(u(p,c,i)):(o.notifyWith(this,t),--f);return f||o.resolveWith(r,a),o.promise()}},(c=function(e,t){var i=this;i.$element=N(e),i.$parent=i.$element.parent(),i._validate()&&(i.isPreviewable=G.hasFileAPISupport(),i.isIE9=G.isIE(9),i.isIE10=G.isIE(10),(i.isPreviewable||i.isIE9)&&(i._init(t),i._listen()),i.$element.removeClass("file-loading"))}).prototype={constructor:c,_cleanup:function(){var e=this;e.reader=null,e.clearFileStack(),e.fileBatchCompleted=!0,e.isError=!1,e.isDuplicateError=!1,e.isPersistentError=!1,e.cancelling=!1,e.paused=!1,e.lastProgress=0,e._initAjax()},_isAborted:function(){return this.cancelling||this.paused},_initAjax:function(){var e=this,i=e.taskManager={pool:{},addPool:function(e){return i.pool[e]=new i.TasksPool(e)},getPool:function(e){return i.pool[e]},addTask:function(e,t){return new i.Task(e,t)},TasksPool:function(e){var c=this;c.id=e,c.cancelled=!1,c.cancelledDeferrer=N.Deferred(),c.tasks={},c.addTask=function(e,t){return c.tasks[e]=new i.Task(e,t)},c.size=function(){return G.getObjectSize(c.tasks)},c.run=function(e){var t,i,r,n,a=0,o=!1,s=G.getObjectKeys(c.tasks).map(function(e){return c.tasks[e]}),l=[],f=N.Deferred();if(c.cancelled)return c.cancelledDeferrer.resolve(),f.reject();if(e)for(i=function(e){N.when(e.deferred).fail(function(){o=!0,r.apply(null,arguments)}).always(r)},r=function(){var e=G.getArray(arguments);return f.notify(e),l.push(e),c.cancelled?(f.reject.apply(null,l),void c.cancelledDeferrer.resolve()):(l.length===c.size()&&(o?f.reject:f.resolve).apply(null,l),void(s.length&&(t=s.shift(),i(t),t.run())))};s.length&&a++<e;)t=s.shift(),i(t),t.run();else n=G.getObjectKeys(c.tasks).map(function(e){return c.tasks[e].deferred}),G.whenAll(n).done(function(){var e=G.getArray(arguments);c.cancelled?(f.reject.apply(null,e),c.cancelledDeferrer.resolve()):(f.resolve.apply(null,e),c.cancelledDeferrer.reject())}).fail(function(){var e=G.getArray(arguments);f.reject.apply(null,e),c.cancelled?c.cancelledDeferrer.resolve():c.cancelledDeferrer.reject()}),N.each(c.tasks,function(e){(t=c.tasks[e]).run()});return f},c.cancel=function(){return c.cancelled=!0,c.cancelledDeferrer}},Task:function(e,t){var i=this;i.id=e,i.deferred=N.Deferred(),i.logic=t,i.context=null,i.run=function(){var e=G.getArray(arguments);return e.unshift(i.deferred),t.apply(i.context,e),i.deferred},i.runWithContext=function(e){return i.context=e,i.run()}}};e.ajaxQueue=[],e.ajaxRequests=[],e.ajaxPool=null,e.ajaxAborted=!1},_init:function(e,t){var i,r,n=this,a=n.$element;n.options=e,n.zoomPlaceholder=G.getZoomPlaceholder(),n.canOrientImage=G.canOrientImage(a),N.each(e,function(e,t){switch(e){case"minFileCount":case"maxFileCount":case"maxTotalFileCount":case"minFileSize":case"maxFileSize":case"maxFilePreviewSize":case"resizeQuality":case"resizeIfSizeMoreThan":case"progressUploadThreshold":case"initialPreviewCount":case"zoomModalHeight":case"minImageHeight":case"maxImageHeight":case"minImageWidth":case"maxImageWidth":case"bytesToKB":n[e]=G.getNum(t);break;default:n[e]=t}}),(!n.bytesToKB||n.bytesToKB<=0)&&(n.bytesToKB=1024),void 0===n.errorCloseButton&&(n.errorCloseButton=G.closeButton("kv-error-close"+(G.isBs(5)?"  float-end":""))),0<n.maxTotalFileCount&&n.maxTotalFileCount<n.maxFileCount&&(n.maxTotalFileCount=n.maxFileCount),n.rtl&&(r=n.previewZoomButtonIcons.prev,n.previewZoomButtonIcons.prev=n.previewZoomButtonIcons.next,n.previewZoomButtonIcons.next=r),!isNaN(n.maxAjaxThreads)&&n.maxAjaxThreads<n.resumableUploadOptions.maxThreads&&(n.resumableUploadOptions.maxThreads=n.maxAjaxThreads),n._initFileManager(),"function"==typeof n.autoOrientImage&&(n.autoOrientImage=n.autoOrientImage()),"function"==typeof n.autoOrientImageInitial&&(n.autoOrientImageInitial=n.autoOrientImageInitial()),t||n._cleanup(),n.duplicateErrors=[],n.$form=a.closest("form"),n._initTemplateDefaults(),n.uploadFileAttr=G.isEmpty(a.attr("name"))?"file_data":a.attr("name"),r=n._getLayoutTemplate("progress"),n.progressTemplate=r.replace("{class}",n.progressClass),n.progressInfoTemplate=r.replace("{class}",n.progressInfoClass),n.progressPauseTemplate=r.replace("{class}",n.progressPauseClass),n.progressCompleteTemplate=r.replace("{class}",n.progressCompleteClass),n.progressErrorTemplate=r.replace("{class}",n.progressErrorClass),n.isDisabled=a.attr("disabled")||a.attr("readonly"),n.isDisabled&&a.attr("disabled",!0),n.isClickable=n.browseOnZoneClick&&n.showPreview&&(n.dropZoneEnabled||!G.isEmpty(n.defaultPreviewContent)),n.isAjaxUpload=G.hasFileUploadSupport()&&!G.isEmpty(n.uploadUrl),n.dropZoneEnabled=G.hasDragDropSupport()&&n.dropZoneEnabled,n.isAjaxUpload||(n.dropZoneEnabled=n.dropZoneEnabled&&G.canAssignFilesToInput()),n.slug="function"==typeof e.slugCallback?e.slugCallback:n._slugDefault,n.mainTemplate=n.showCaption?n._getLayoutTemplate("main1"):n._getLayoutTemplate("main2"),n.captionTemplate=n._getLayoutTemplate("caption"),n.previewGenericTemplate=n._getPreviewTemplate("generic"),!n.imageCanvas&&n.resizeImage&&(n.maxImageWidth||n.maxImageHeight)&&(n.imageCanvas=document.createElement("canvas"),n.imageCanvasContext=n.imageCanvas.getContext("2d")),G.isEmpty(a.attr("id"))&&a.attr("id",G.uniqId()),n.namespace=".fileinput_"+a.attr("id").replace(/-/g,"_"),void 0===n.$container?n.$container=n._createContainer():n._refreshContainer(),r=n.$container,n.$dropZone=r.find(".file-drop-zone"),n.$progress=r.find(".kv-upload-progress"),n.$btnUpload=r.find(".fileinput-upload"),n.$captionContainer=G.getElement(e,"elCaptionContainer",r.find(".file-caption")),n.$caption=G.getElement(e,"elCaptionText",r.find(".file-caption-name")),G.isEmpty(n.msgPlaceholder)||(i=a.attr("multiple")?n.filePlural:n.fileSingle,n.$caption.attr("placeholder",n.msgPlaceholder.replace("{files}",i))),n.$captionIcon=n.$captionContainer.find(".file-caption-icon"),n.$previewContainer=G.getElement(e,"elPreviewContainer",r.find(".file-preview")),n.$preview=G.getElement(e,"elPreviewImage",r.find(".file-preview-thumbnails")),n.$previewStatus=G.getElement(e,"elPreviewStatus",r.find(".file-preview-status")),n.$errorContainer=G.getElement(e,"elErrorContainer",n.$previewContainer.find(".kv-fileinput-error")),n._validateDisabled(),G.isEmpty(n.msgErrorClass)||G.addCss(n.$errorContainer,n.msgErrorClass),t?n._errorsExist()||n.$errorContainer.hide():(n._resetErrors(),n.$errorContainer.hide(),n.previewInitId="thumb-"+a.attr("id"),n._initPreviewCache(),n._initPreview(!0),n._initPreviewActions(),n.$parent.hasClass("file-loading")&&(n.$container.insertBefore(n.$parent),n.$parent.remove())),n._setFileDropZoneTitle(),a.attr("disabled")&&n.disable(),n._initZoom(),n.hideThumbnailContent&&G.addCss(n.$preview,"hide-content")},_initFileManager:function(){var f=this;f.uploadStartTime=G.now(),f.fileManager={stack:{},filesProcessed:[],errors:[],loadedImages:{},totalImages:0,totalFiles:null,totalSize:null,uploadedSize:0,stats:{},bpsLog:[],bps:0,initStats:function(e){var t={started:G.now()};e?f.fileManager.stats[e]=t:f.fileManager.stats=t},getUploadStats:function(e,t,i){var a=f.fileManager,r=e?a.stats[e]&&a.stats[e].started||G.now():f.uploadStartTime,n=(G.now()-r)/1e3,o=Math.ceil(n?t/n:0),s=i-t,l=a.bpsLog.length?f.bitrateUpdateDelay:0;return setTimeout(function(){var e,t,i,r=0,n=0;for(a.bpsLog.push(o),a.bpsLog.sort(function(e,t){return e-t}),i=10<(t=a.bpsLog.length)?t-10:Math.ceil(t/2),e=t;i<e;e--)n=parseFloat(a.bpsLog[e]),r++;a.bps=64*(0<r?n/r:0)},l),l={fileId:e,started:r,elapsed:n,loaded:t,total:i,bps:a.bps,bitrate:f._getSize(a.bps,!1,f.bitRateUnits),pendingBytes:s},e?a.stats[e]=l:a.stats=l,l},exists:function(e){return-1!==N.inArray(e,f.fileManager.getIdList())},count:function(){return f.fileManager.getIdList().length},total:function(){var e=f.fileManager;return e.totalFiles||(e.totalFiles=e.count()),e.totalFiles},getTotalSize:function(){var i=f.fileManager;return i.totalSize||(i.totalSize=0,N.each(f.getFileStack(),function(e,t){t=parseFloat(t.size);i.totalSize+=isNaN(t)?0:t}),i.totalSize)},add:function(e,t){(t=t||f.fileManager.getId(e))&&(f.fileManager.stack[t]={file:e,name:G.getFileName(e),relativePath:G.getFileRelativePath(e),size:e.size,nameFmt:f._getFileName(e,""),sizeFmt:f._getSize(e.size)})},remove:function(e){e=f._getThumbFileId(e);f.fileManager.removeFile(e)},removeFile:function(e){var t=f.fileManager;e&&(delete t.stack[e],delete t.loadedImages[e])},move:function(i,r){var n={},a=f.fileManager.stack;(i||r)&&i!==r&&(N.each(a,function(e,t){e!==i&&(n[e]=t),e===r&&(n[i]=a[i])}),f.fileManager.stack=n)},list:function(){var i=[];return N.each(f.getFileStack(),function(e,t){t&&t.file&&i.push(t.file)}),i},isPending:function(e){return-1===N.inArray(e,f.fileManager.filesProcessed)&&f.fileManager.exists(e)},isProcessed:function(){var t=!0,i=f.fileManager;return N.each(f.getFileStack(),function(e){i.isPending(e)&&(t=!1)}),t},clear:function(){var e=f.fileManager;f.isDuplicateError=!1,f.isPersistentError=!1,e.totalFiles=null,e.totalSize=null,e.uploadedSize=0,e.stack={},e.errors=[],e.filesProcessed=[],e.stats={},e.bpsLog=[],e.bps=0,e.clearImages()},clearImages:function(){f.fileManager.loadedImages={},f.fileManager.totalImages=0},addImage:function(e,t){f.fileManager.loadedImages[e]=t},removeImage:function(e){delete f.fileManager.loadedImages[e]},getImageIdList:function(){return G.getObjectKeys(f.fileManager.loadedImages)},getImageCount:function(){return f.fileManager.getImageIdList().length},getId:function(e){return f._getFileId(e)},getIndex:function(e){return f.fileManager.getIdList().indexOf(e)},getThumb:function(t){var i=null;return f._getThumbs().each(function(){var e=N(this);f._getThumbFileId(e)===t&&(i=e)}),i},getThumbIndex:function(e){e=f._getThumbFileId(e);return f.fileManager.getIndex(e)},getIdList:function(){return G.getObjectKeys(f.fileManager.stack)},getFile:function(e){return f.fileManager.stack[e]||null},getFileName:function(e,t){e=f.fileManager.getFile(e);return e?t?e.nameFmt||"":e.name||"":""},getFirstFile:function(){var e=f.fileManager.getIdList(),e=e&&e.length?e[0]:null;return f.fileManager.getFile(e)},setFile:function(e,t){f.fileManager.getFile(e)?f.fileManager.stack[e].file=t:f.fileManager.add(t,e)},setProcessed:function(e){f.fileManager.filesProcessed.push(e)},getProgress:function(){var e=f.fileManager.total(),t=f.fileManager.filesProcessed.length;return e?Math.ceil(t/e*100):0},setProgress:function(e,t){e=f.fileManager.getFile(e);!isNaN(t)&&e&&(e.progress=t)}}},_setUploadData:function(i,e){var r=this;N.each(e,function(e,t){e=r.uploadParamNames[e]||e;G.isArray(t)?i.append(e,t[0],t[1]):i.append(e,t)})},_initResumableUpload:function(){var h,m=this,g=m.resumableUploadOptions,v=G.logMessages,w=m.fileManager;m.enableResumableUpload&&(!1!==g.fallback&&"function"!=typeof g.fallback&&(g.fallback=function(e){e._log(v.noResumableSupport),e.enableResumableUpload=!1}),G.hasResumableUploadSupport()||!1===g.fallback?!m.uploadUrl&&m.enableResumableUpload?(m._log(v.noUploadUrl),m.enableResumableUpload=!1):(g.chunkSize=parseFloat(g.chunkSize),g.chunkSize<=0||isNaN(g.chunkSize)?(m._log(v.invalidChunkSize,{chunkSize:g.chunkSize}),m.enableResumableUpload=!1):(h=m.resumableManager={init:function(e,t,i){h.logs=[],h.stack=[],h.error="",h.id=e,h.file=t.file,h.fileName=t.name,h.fileIndex=i,h.completed=!1,h.lastProgress=0,m.showPreview&&(h.$thumb=w.getThumb(e)||null,h.$progress=h.$btnDelete=null,h.$thumb)&&h.$thumb.length&&(h.$progress=h.$thumb.find(".file-thumb-progress"),h.$btnDelete=h.$thumb.find(".kv-file-remove")),h.chunkSize=g.chunkSize*m.bytesToKB,h.chunkCount=h.getTotalChunks()},setAjaxError:function(e,t,i,r){e.responseJSON&&e.responseJSON.error&&(i=e.responseJSON.error.toString()),r||(h.error=i),g.showErrorLog&&m._log(v.ajaxError,{status:e.status,error:i,text:e.responseText||""})},reset:function(){h.stack=[],h.chunksProcessed={}},setProcessed:function(e){var t=h.id,i=h.$thumb,r=h.$progress,n=i&&i.length,a={id:n?i.attr("id"):"",index:w.getIndex(t),fileId:t},o=m.resumableUploadOptions.skipErrorsAndProceed;h.completed=!0,h.lastProgress=0,n&&i.removeClass("file-uploading"),"success"===e?(w.uploadedSize+=h.file.size,m.showPreview&&(m._setProgress(101,r),m._setThumbStatus(i,"Success"),m._initUploadSuccess(h.chunksProcessed[t].data,i)),w.removeFile(t),delete h.chunksProcessed[t],m._raise("fileuploaded",[a.id,a.index,a.fileId]),w.isProcessed()&&m._setProgress(101)):"cancel"!==e&&(m.showPreview&&(m._setThumbStatus(i,"Error"),m._setPreviewError(i,!0),m._setProgress(101,r,m.msgProgressError),m._setProgress(101,m.$progress,m.msgProgressError),m.cancelling=!o),m.$errorContainer.find('li[data-file-id="'+a.fileId+'"]').length||(n={file:h.fileName,max:g.maxRetries,error:h.error},e=m.msgResumableUploadRetriesExceeded.setTokens(n),N.extend(a,n),m._showFileError(e,a,"filemaxretries"),o&&(w.removeFile(t),delete h.chunksProcessed[t],w.isProcessed())&&m._setProgress(101))),w.isProcessed()&&h.reset()},check:function(){N.each(h.logs,function(e,t){return!!t&&void 0})},processedResumables:function(){var e,t=h.logs,i=0;if(!t||!t.length)return 0;for(e=0;e<t.length;e++)!0===t[e]&&i++;return i},getUploadedSize:function(){var e=h.processedResumables()*h.chunkSize;return e>h.file.size?h.file.size:e},getTotalChunks:function(){var e=parseFloat(h.chunkSize);return!isNaN(e)&&0<e?Math.ceil(h.file.size/e):0},getProgress:function(){var e=h.processedResumables(),t=h.chunkCount;return 0===t?0:Math.ceil(e/t*100)},checkAborted:function(e){m._isAborted()&&(clearInterval(e),m.unlock())},upload:function(){var t=w.getIdList(),i="new",r=setInterval(function(){var e;h.checkAborted(r),"new"===i&&(m.lock(),i="processing",e=t.shift(),w.initStats(e),w.stack[e])&&(h.init(e,w.stack[e],w.getIndex(e)),h.processUpload()),!w.isPending(e)&&h.completed&&(i="new"),w.isProcessed()&&((e=m.$preview.find(".file-preview-initial")).length&&(G.addCss(e,G.SORT_CSS),m._initSortable()),clearInterval(r),m._clearFileInput(),m.unlock(),setTimeout(function(){var e=m.previewCache.data;e&&(m.initialPreview=e.content,m.initialPreviewConfig=e.config,m.initialPreviewThumbTags=e.tags),m._raise("filebatchuploadcomplete",[m.initialPreview,m.initialPreviewConfig,m.initialPreviewThumbTags,m._getExtraData()])},m.processDelay))},m.processDelay)},uploadResumable:function(){for(var e=m.taskManager,t=h.chunkCount,i=e.addPool(h.id),r=0;r<t;r++)h.logs[r]=!(!h.chunksProcessed[h.id]||!h.chunksProcessed[h.id][r]),h.logs[r]||h.pushAjax(r,0);i.run(g.maxThreads).done(function(){h.setProcessed("success")}).fail(function(){h.setProcessed(i.cancelled?"cancel":"error")})},processUpload:function(){var n,e,a,o=h.id;return g.testUrl?(n=new FormData,e=w.stack[o],m._setUploadData(n,{fileId:o,fileName:e.fileName,fileSize:e.size,fileRelativePath:e.relativePath,chunkSize:h.chunkSize,chunkCount:h.chunkCount}),void m._ajaxSubmit(function(e){a=m._getOutData(n,e),m._raise("filetestbeforesend",[o,w,h,a])},function(e,t,i){a=m._getOutData(n,i,e);var i=m.uploadParamNames.chunksUploaded||"chunksUploaded",r=[o,w,h,a];e[i]&&G.isArray(e[i])?(h.chunksProcessed[o]||(h.chunksProcessed[o]={}),N.each(e[i],function(e,t){h.logs[t]=!0,h.chunksProcessed[o][t]=!0}),h.chunksProcessed[o].data=e,m._raise("filetestsuccess",r)):m._raise("filetesterror",r),h.uploadResumable()},function(){m._raise("filetestcomplete",[o,w,h,m._getOutData(n)])},function(e,t,i){a=m._getOutData(n,e),m._raise("filetestajaxerror",[o,w,h,a]),h.setAjaxError(e,t,i,!0),h.uploadResumable()},n,o,h.fileIndex,g.testUrl)):void h.uploadResumable()},pushAjax:function(e,t){var i=m.taskManager.getPool(h.id);i.addTask(i.size()+1,function(e){var t=h.stack.shift(),i=t[0];h.chunksProcessed[h.id]&&h.chunksProcessed[h.id][i]?m._log(v.chunkQueueError,{index:i}):h.sendAjax(i,t[1],e)}),h.stack.push([e,t])},sendAjax:function(n,a,o){function s(e,t){t&&(e=e.setTokens(t)),e=p.resumableRequestError.setTokens({msg:e}),m._log(e),o.reject(e)}var l,e,f,t,i=h.chunkSize,c=h.id,r=h.file,u=h.$thumb,p=G.logMessages,d=h.$btnDelete;h.chunksProcessed[c]&&h.chunksProcessed[c][n]||(a>g.maxRetries?(s(p.resumableMaxRetriesReached,{n:g.maxRetries}),h.setProcessed("error")):(e=r[r.slice?"slice":r.mozSlice?"mozSlice":r.webkitSlice?"webkitSlice":"slice"](i*n,i*(n+1)),f=new FormData,t=w.stack[c],m._setUploadData(f,{chunkCount:h.chunkCount,chunkIndex:n,chunkSize:i,chunkSizeStart:i*n,fileBlob:[e,h.fileName],fileId:c,fileName:h.fileName,fileRelativePath:t.relativePath,fileSize:r.size,retryCount:a}),h.$progress&&h.$progress.length&&h.$progress.show(),m._ajaxSubmit(function(e){l=m._getOutData(f,e),m.showPreview&&(u.hasClass("file-preview-success")||(m._setThumbStatus(u,"Loading"),G.addCss(u,"file-uploading")),d.attr("disabled",!0)),m._raise("filechunkbeforesend",[c,n,a,w,h,l])},function(e,t,i){var r;m._isAborted()?s(p.resumableAborting):(l=m._getOutData(f,i,e),i=m.uploadParamNames.chunkIndex||"chunkIndex",r=[c,n,a,w,h,l],e.error?(g.showErrorLog&&m._log(v.retryStatus,{retry:a+1,filename:h.fileName,chunk:n}),m._raise("filechunkerror",r),h.pushAjax(n,a+1),h.error=e.error,s(e.error)):(h.logs[e[i]]=!0,h.chunksProcessed[c]||(h.chunksProcessed[c]={}),h.chunksProcessed[c][e[i]]=!0,h.chunksProcessed[c].data=e,o.resolve.call(null,e),m._raise("filechunksuccess",r),h.check()))},function(){m._isAborted()||m._raise("filechunkcomplete",[c,n,a,w,h,m._getOutData(f)])},function(e,t,i){return m._isAborted()?void s(p.resumableAborting):(l=m._getOutData(f,e),h.setAjaxError(e,t,i),m._raise("filechunkajaxerror",[c,n,a,w,h,l]),h.pushAjax(n,a+1),void s(p.resumableRetryError,{n:a-1}))},f,c,h.fileIndex)))}}).reset()):g.fallback(m))},_initTemplateDefaults:function(){function e(e,t){return'<object class="kv-preview-data file-preview-'+e+'" title="{caption}" data="{data}" type="'+t+'"'+s+">\n"+G.DEFAULT_PREVIEW+"\n</object>\n"}var i=this,t="btn btn-sm btn-kv "+G.defaultButtonCss(),r='{preview}\n<div class="kv-upload-progress kv-hidden"></div><div class="clearfix"></div>\n<div class="file-caption {class}">\n  <div class="input-group {inputGroupClass}">\n      {caption}\n<span class="file-caption-icon"></span>\n'+(G.isBs(5)?"":'<div class="input-group-btn input-group-append">\n')+"      {remove}\n      {cancel}\n      {pause}\n      {upload}\n      {browse}\n"+(G.isBs(5)?"":"    </div>\n")+"  </div>",n=G.closeButton("fileinput-remove"),a=G.MODAL_ID+"Label",o='<div id="'+G.MODAL_ID+'" class="file-zoom-dialog modal fade" aria-labelledby="'+a+'" {tabIndexConfig}></div>',a='<div class="modal-dialog modal-lg{rtl}" role="document">\n  <div class="modal-content">\n    <div class="modal-header kv-zoom-header">\n      <h6 class="modal-title kv-zoom-title" id="'+a+'"><span class="kv-zoom-caption"></span> <span class="kv-zoom-size"></span></h6>\n      <div class="kv-zoom-actions">{rotate}{toggleheader}{fullscreen}{borderless}{close}</div>\n    </div>\n    <div class="floating-buttons"></div>\n    <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"></div>\n{prev} {next}\n    <div class="kv-zoom-description"></div>\n  </div>\n</div>\n',s=" {style}",l=e("html","text/html"),f=e("text","text/plain;charset=UTF-8"),c=e("pdf","application/pdf"),u='<img src="{data}" class="file-preview-image kv-preview-data" title="{title}" alt="{alt}"'+s+">\n",p='<iframe class="kv-preview-data file-preview-office" src="https://view.officeapps.live.com/op/embed.aspx?src={data}"'+s+"></iframe>",d='<iframe class="kv-preview-data file-preview-gdocs" src="https://docs.google.com/gview?url={data}&embedded=true"'+s+"></iframe>",h='<video class="kv-preview-data file-preview-video" controls'+s+'>\n<source src="{data}" type="{type}">\n'+G.DEFAULT_PREVIEW+"\n</video>\n",m='\x3c!--suppress ALL --\x3e<audio class="kv-preview-data file-preview-audio" controls'+s+'>\n<source src="{data}" type="{type}">\n'+G.DEFAULT_PREVIEW+"\n</audio>\n",g='<embed class="kv-preview-data file-preview-flash" src="{data}" type="application/x-shockwave-flash"'+s+">\n",v='<object class="kv-preview-data file-preview-object file-object {typeCss}" data="{data}" type="{type}"'+s+'>\n<param name="movie" value="{caption}" />\n'+G.OBJECT_PARAMS+" "+G.DEFAULT_PREVIEW+"\n</object>\n",w='<div class="kv-preview-data file-preview-other-frame"'+s+">\n"+G.DEFAULT_PREVIEW+"\n</div>\n",y={width:"100%",height:"100%","min-height":"480px"};i._isPdfRendered()&&(c=i.pdfRendererTemplate.replace("{renderer}",i._encodeURI(i.pdfRendererUrl))),i.defaults={layoutTemplates:{main1:r,main2:'{preview}\n<div class="kv-upload-progress kv-hidden"></div>\n<div class="clearfix"></div>\n<span class="{class}">{remove}\n{cancel}\n{upload}\n{browse}\n</span>',preview:'<div class="file-preview {class}">\n  {close}  <div class="{dropClass} clearfix">\n    <div class="file-preview-thumbnails clearfix">\n    </div>\n    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n  </div>\n</div>',close:n,fileIcon:'<i class="bi-file-earmark-arrow-up"></i>',caption:'<input readonly class="file-caption-name form-control {class}">\n',modalMain:o,modal:a,descriptionClose:'<button type="button" class="kv-desc-hide" aria-label="Close">{closeIcon}</button>',progress:'<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     </div>\n</div>{stats}',stats:'<div class="text-primary file-upload-stats"><span class="pending-time">{pendingTime}</span> <span class="upload-speed">{uploadSpeed}</span></div>',size:" <samp>({sizeText})</samp>",footer:'<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">\n        <div class="file-caption-info">{caption}</div>\n        <div class="file-size-info">{size}</div>\n    </div>\n    {progress}\n{indicator}\n{actions}\n</div>',indicator:'<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>',actions:'<div class="file-actions">\n    <div class="file-footer-buttons">\n        {rotate} {download} {upload} {delete} {zoom} {other}    </div>\n</div>\n{drag}\n<div class="clearfix"></div>',actionDelete:'<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',actionRotate:'<button type="button" class="kv-file-rotate {rotateClass}" title="{rotateTitle}">{rotateIcon}</button>',actionUpload:'<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',actionDownload:'<a class="kv-file-download {downloadClass}" title="{downloadTitle}" href="{downloadUrl}" download="{caption}" target="_blank">{downloadIcon}</a>',actionZoom:'<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',actionDrag:'<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',btnDefault:'<button type="{type}" title="{title}" class="{css}" {status} {tabIndexConfig}>{icon} {label}</button>',btnLink:'<a href="{href}" title="{title}" class="{css}" {status} {tabIndexConfig}>{icon} {label}</a>',btnBrowse:'<div class="{css}" {status} {tabIndexConfig}>{icon} {label}</div>',zoomCache:'<div class="kv-zoom-cache">{zoomContent}</div>'},previewMarkupTags:{tagBefore1:'<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-fileid="{fileid}" data-filename="{filename}" data-template="{template}" data-zoom="{zoomData}"><div class="kv-file-content">\n',tagBefore2:'<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-fileid="{fileid}" data-filename="{filename}" data-template="{template}" data-zoom="{zoomData}" title="{caption}"><div class="kv-file-content">\n',tagAfter:"</div>{footer}\n{zoomCache}</div>\n"},previewContentTemplates:{generic:"{content}\n",html:l,image:u,text:f,office:p,gdocs:d,video:h,audio:m,flash:g,object:v,pdf:c,other:w},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},office:{width:"213px",height:"160px"},gdocs:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"100%",height:"30px"},flash:{width:"213px",height:"160px"},object:{width:"213px",height:"160px"},pdf:{width:"100%",height:"160px",position:"relative"},other:{width:"213px",height:"160px"}},previewSettingsSmall:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"160px"},text:{width:"100%",height:"160px"},office:{width:"100%",height:"160px"},gdocs:{width:"100%",height:"160px"},video:{width:"100%",height:"auto"},audio:{width:"100%",height:"30px"},flash:{width:"100%",height:"auto"},object:{width:"100%",height:"auto"},pdf:{width:"100%",height:"160px"},other:{width:"100%",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:y,text:y,office:{width:"100%",height:"100%","max-width":"100%","min-height":"480px"},gdocs:{width:"100%",height:"100%","max-width":"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","max-width":"100%","min-height":"480px"},pdf:y,other:{width:"auto",height:"100%","min-height":"480px"}},mimeTypeAliases:{"video/quicktime":"video/mp4"},fileTypeSettings:{image:function(e,t){return G.compare(e,"image.*")&&!G.compare(e,/(tiff?|wmf)$/i)||G.compare(t,/\.(gif|png|jpe?g)$/i)},html:function(e,t){return G.compare(e,"text/html")||G.compare(t,/\.(htm|html)$/i)},office:function(e,t){return G.compare(e,/(word|excel|powerpoint|office)$/i)||G.compare(t,/\.(docx?|xlsx?|pptx?|pps|potx?)$/i)},gdocs:function(e,t){return G.compare(e,/(word|excel|powerpoint|office|iwork-pages|tiff?)$/i)||G.compare(t,/\.(docx?|xlsx?|pptx?|pps|potx?|rtf|ods|odt|pages|ai|dxf|ttf|tiff?|wmf|e?ps)$/i)},text:function(e,t){return G.compare(e,"text.*")||G.compare(t,/\.(xml|javascript)$/i)||G.compare(t,/\.(txt|md|nfo|ini|json|php|js|css)$/i)},video:function(e,t){return G.compare(e,"video.*")&&(G.compare(e,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||G.compare(t,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(e,t){return G.compare(e,"audio.*")&&(G.compare(t,/(ogg|mp3|mp?g|wav)$/i)||G.compare(t,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(e,t){return G.compare(e,"application/x-shockwave-flash",!0)||G.compare(t,/\.(swf)$/i)},pdf:function(e,t){return G.compare(e,"application/pdf",!0)||G.compare(t,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showDownload:!0,showZoom:!0,showDrag:!0,showRotate:!0,removeIcon:'<i class="bi-trash"></i>',removeClass:t,removeErrorClass:"btn btn-sm btn-kv btn-danger",removeTitle:"Remove file",uploadIcon:'<i class="bi-upload"></i>',uploadClass:t,uploadTitle:"Upload file",uploadRetryIcon:'<i class="bi-cloud-arrow-up-fill"></i>',uploadRetryTitle:"Retry upload",downloadIcon:'<i class="bi-download"></i>',downloadClass:t,downloadTitle:"Download file",rotateIcon:'<i class="bi-arrow-clockwise"></i>',rotateClass:t,rotateTitle:"Rotate 90 deg. clockwise",zoomIcon:'<i class="bi-zoom-in"></i>',zoomClass:t,zoomTitle:"View Details",dragIcon:'<i class="bi-arrows-move"></i>',dragClass:"text-primary",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="bi-plus-lg text-warning"></i>',indicatorSuccess:'<i class="bi-check-lg text-success"></i>',indicatorError:'<i class="bi-exclamation-lg text-danger"></i>',indicatorLoading:'<i class="bi-hourglass-bottom text-muted"></i>',indicatorPaused:'<i class="bi-pause-fill text-primary"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading &hellip;",indicatorPausedTitle:"Upload Paused"}},N.each(i.defaults,function(e,t){return"allowedPreviewTypes"===e?void(void 0===i.allowedPreviewTypes&&(i.allowedPreviewTypes=t)):void(i[e]=N.extend(!0,{},t,i[e]))}),i._initPreviewTemplates()},_initPreviewTemplates:function(){var i,r=this,n=r.previewMarkupTags,a=n.tagAfter;N.each(r.previewContentTemplates,function(e,t){G.isEmpty(r.previewTemplates[e])&&(i=n.tagBefore2,"generic"!==e&&"image"!==e||(i=n.tagBefore1),r._isPdfRendered()&&"pdf"===e&&(i=i.replace("kv-file-content","kv-file-content kv-pdf-rendered")),r.previewTemplates[e]=i+t+a)})},_initPreviewCache:function(){var h=this;h.previewCache={data:{},init:function(){var e=h.initialPreview;0<e.length&&!G.isArray(e)&&(e=e.split(h.initialPreviewDelimiter)),h.previewCache.data={content:e,config:h.initialPreviewConfig,tags:h.initialPreviewThumbTags}},count:function(e){return h.previewCache.data&&h.previewCache.data.content?(e?h.previewCache.data.content.filter(function(e){return null!==e}):h.previewCache.data.content).length:0},get:function(e,t){function i(e,t,i,r,n,a,o,s){var o=" file-preview-initial "+G.SORT_CSS+(o?" "+o:""),l=h.previewInitId+"-"+a,f=c&&c.fileId||l;return h._generatePreviewTemplate(e,t,i,r,l,f,!1,null,null,o,n,a,s,p,c&&c.zoomData||t)}var r,n,a,o,s=G.INIT_FLAG+e,l=h.previewCache.data,c=l.config[e],f=l.content[e],u=G.ifSet("previewAsData",c,h.initialPreviewAsData),p=c?{title:c.title||null,alt:c.alt||null}:{title:null,alt:null};return f&&f.length?(t=void 0===t||t,r=G.ifSet("type",c,h.initialPreviewFileType||"generic"),n=G.ifSet("filename",c,G.ifSet("caption",c)),a=G.ifSet("filetype",c,r),t=h.previewCache.footer(e,t,c&&c.size||null),o=G.ifSet("frameClass",c),u=u?i(r,f,n,a,t,s,o):i("generic",f,n,a,t,s,o,r).setTokens({content:l.content[e]}),l.tags.length&&l.tags[e]&&(u=G.replaceTags(u,l.tags[e])),G.isEmpty(c)||G.isEmpty(c.frameAttr)||((f=G.createElement(u)).find(".file-preview-initial").attr(c.frameAttr),u=f.html(),f.remove()),u):""},clean:function(e){e.content=G.cleanArray(e.content),e.config=G.cleanArray(e.config),e.tags=G.cleanArray(e.tags),h.previewCache.data=e},add:function(e,t,i,r){var n,a=h.previewCache.data;return e&&e.length?(n=e.length-1,G.isArray(e)||(e=e.split(h.initialPreviewDelimiter)),r&&a.content?(n=a.content.push(e[0])-1,a.config[n]=t,a.tags[n]=i):(a.content=e,a.config=t,a.tags=i),h.previewCache.clean(a),n):0},set:function(e,t,i,r){var n,a=h.previewCache.data;if(e&&e.length&&(e=G.isArray(e)?e:e.split(h.initialPreviewDelimiter)).filter(function(e){return null!==e}).length){if(void 0===a.content&&(a.content=[]),void 0===a.config&&(a.config=[]),void 0===a.tags&&(a.tags=[]),r){for(n=0;n<e.length;n++)e[n]&&a.content.push(e[n]);for(n=0;n<t.length;n++)t[n]&&a.config.push(t[n]);for(n=0;n<i.length;n++)i[n]&&a.tags.push(i[n])}else a.content=e,a.config=t,a.tags=i;h.previewCache.clean(a)}},unset:function(e){var t=h.previewCache.count(),i=h.reversePreviewOrder;t&&(1===t?(h.previewCache.data.content=[],h.previewCache.data.config=[],h.previewCache.data.tags=[],h.initialPreview=[],h.initialPreviewConfig=[],h.initialPreviewThumbTags=[]):(h.previewCache.data.content=G.spliceArray(h.previewCache.data.content,e,i),h.previewCache.data.config=G.spliceArray(h.previewCache.data.config,e,i),h.previewCache.data.tags=G.spliceArray(h.previewCache.data.tags,e,i),t=N.extend(!0,{},h.previewCache.data),h.previewCache.clean(t)))},out:function(){var e,t,i="",r=h.previewCache.count();if(0===r)return{content:"",caption:""};for(e=0;e<r;e++)t=h.previewCache.get(e),i=h.reversePreviewOrder?t+i:i+t;return{content:i,caption:h._getMsgSelected(r)}},footer:function(e,t,i){var r=h.previewCache.data||{};if(G.isEmpty(r.content))return"";(G.isEmpty(r.config)||G.isEmpty(r.config[e]))&&(r.config[e]={}),t=void 0===t||t;var r=r.config[e],e=G.ifSet("caption",r),n=G.ifSet("width",r,"auto"),a=G.ifSet("url",r,!1),o=G.ifSet("key",r,null),s=G.ifSet("fileId",r,null),l=h.fileActionSettings,f=h.initialPreviewShowDelete||!1,s=h.initialPreviewDownloadUrl?h.initialPreviewDownloadUrl+"?key="+o+(s?"&fileId="+s:""):"",s=r.downloadUrl||s,c=r.filename||r.caption||"",u=!!s,f=G.ifSet("showRemove",r,f),p=G.ifSet("showRotate",r,G.ifSet("showRotate",l,!0)),u=G.ifSet("showDownload",r,G.ifSet("showDownload",l,u)),d=G.ifSet("showZoom",r,G.ifSet("showZoom",l,!0)),l=G.ifSet("showDrag",r,G.ifSet("showDrag",l,!0)),u=u&&!1!==r.downloadUrl&&!!s,r=h._renderFileActions(r,!1,u,f,p,d,l,!1===a&&t,a,o,!0,s,c);return h._getLayoutTemplate("footer").setTokens({progress:h._renderThumbProgress(),actions:r,caption:e,size:h._getSize(i),width:n,indicator:""})}},h.previewCache.init()},_isPdfRendered:function(){var e=this.usePdfRenderer;return("function"==typeof e?e():!!e)&&this.pdfRendererUrl},_handler:function(e,t,i){var r=this.namespace,t=t.split(" ").join(r+" ")+r;e&&e.length&&e.off(t).on(t,i)},_encodeURI:function(e){return this.encodeUrl?encodeURI(e):e},_log:function(e,t){var i=this.$element.attr("id");this.showConsoleLogs&&(e="bootstrap-fileinput: "+(e=i?'"'+i+'": '+e:e),"object"==typeof t&&(e=e.setTokens(t)),window.console&&void 0!==window.console.log?window.console.log(e):window.alert(e))},_validate:function(){var e="file"===this.$element.attr("type");return e||this._log(G.logMessages.badInputType),e},_errorsExist:function(){var e;return!!this.$errorContainer.find("li").length||((e=G.createElement(this.$errorContainer.html())).find(".kv-error-close").remove(),e.find("ul").remove(),!!N.trim(e.text()).length)},_errorHandler:function(e,t){var i=this,e=e.target.error;e=e.code===e.NOT_FOUND_ERR?i.msgFileNotFound:e.code===e.SECURITY_ERR?i.msgFileSecured:e.code===e.NOT_READABLE_ERR?i.msgFileNotReadable:e.code===e.ABORT_ERR?i.msgFilePreviewAborted:i.msgFilePreviewError,i._showError(e.replace("{name}",t))},_addError:function(e){var t=this,i=t.$errorContainer;e&&i.length&&(G.setHtml(i,t.errorCloseButton+e),t._handler(i.find(".kv-error-close"),"click",function(){setTimeout(function(){t.showPreview&&!t.getFrames().length&&t.clear(),i.fadeOut("slow")},t.processDelay)}))},_setValidationError:function(e){this.$container.removeClass(e=(e?e+" ":"")+"has-error").addClass("has-error"),G.addCss(this.$caption,"is-invalid")},_resetErrors:function(e){var t=this,i=t.$errorContainer,r=t.resumableUploadOptions.retainErrorHistory;t.isPersistentError||t.enableResumableUpload&&r&&!t.clearInput||(t.clearInput=!1,t.isError=!1,t.$container.removeClass("has-error"),t.$caption.removeClass("is-invalid is-valid file-processing"),i.html(""),e?i.fadeOut("slow"):i.hide())},_showFolderError:function(e){var t,i=this,r=i.$errorContainer;e&&(i.isAjaxUpload||i._clearFileInput(),t=i.msgFoldersNotAllowed.replace("{n}",e),i._addError(t),i._setValidationError(),r.fadeIn(i.fadeDelay),i._raise("filefoldererror",[e,t]))},showUserError:function(e,t,i){var r,n=this;n.uploadInitiated&&(t&&t.fileId?(i||n.$errorContainer.find('[data-file-id="'+t.fileId+'"]').remove(),(r=n.fileManager.getFileName(t.fileId))&&(e="<b>"+r+":</b> "+e)):i||n.$errorContainer.html(""),n._showFileError(e,t,"fileusererror"))},_showFileError:function(e,t,i){var r=this,n=r.$errorContainer,i=i||"fileuploaderror",a=t&&t.fileId||"",a=t&&t.id?'<li data-thumb-id="'+t.id+'" data-file-id="'+a+'">'+e+"</li>":"<li>"+e+"</li>";return 0===n.find("ul").length?r._addError("<ul>"+a+"</ul>"):n.find("ul").append(a),n.fadeIn(r.fadeDelay),r._raise(i,[t,e]),r._setValidationError("file-input-new"),!0},_showError:function(e,t,i){var r=this,n=r.$errorContainer,i=i||"fileerror";return(t=t||{}).reader=r.reader,r._addError(e),n.fadeIn(r.fadeDelay),r._raise(i,[t,e]),r.isAjaxUpload||r._clearFileInput(),r._setValidationError("file-input-new"),r.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(e){var t=this,i=1<t.minFileCount?t.filePlural:t.fileSingle,i=t.msgFilesTooLess.replace("{n}",t.minFileCount).replace("{files}",i),r=t.$errorContainer,i="<li>"+i+"</li>";0===r.find("ul").length?t._addError("<ul>"+i+"</ul>"):r.find("ul").append(i),t.isError=!0,t._updateFileDetails(0),r.fadeIn(t.fadeDelay),t._raise("fileerror",[e,i]),t._clearFileInput(),t._setValidationError()},_parseError:function(e,t,i,r){var n=this,i=N.trim(i+""),a=t.responseJSON&&t.responseJSON.error?t.responseJSON.error.toString():"",t=a||t.responseText;return n.cancelling&&n.msgUploadAborted&&(i=n.msgUploadAborted),n.showAjaxErrorDetails&&t&&(a?i=N.trim(a+""):(a=(t=N.trim(t.replace(/\n\s*\n/g,"\n"))).length?"<pre>"+t+"</pre>":"",i+=i?a:t)),i=i||n.msgAjaxError.replace("{operation}",e),n.cancelling=!1,r?"<b>"+r+": </b>"+i:i},_parseFileType:function(e,t){var i,r,n=this.allowedPreviewTypes||[];if("application/text-plain"===e)return"text";for(r=0;r<n.length;r++)if(i=n[r],i=(0,this.fileTypeSettings[i])(e,t)?i:"",!G.isEmpty(i))return i;return"other"},_getPreviewIcon:function(e){var i,r=this,n=null;return e&&-1<e.indexOf(".")&&(i=e.split(".").pop(),r.previewFileIconSettings&&(n=r.previewFileIconSettings[i]||r.previewFileIconSettings[i.toLowerCase()]||null),r.previewFileExtSettings)&&N.each(r.previewFileExtSettings,function(e,t){return r.previewFileIconSettings[e]&&t(i)?void(n=r.previewFileIconSettings[e]):void 0}),n||r.previewFileIcon},_parseFilePreviewIcon:function(e,t){t=this._getPreviewIcon(t);return e=-1<e.indexOf("{previewFileIcon}")?e.setTokens({previewFileIconClass:this.previewFileIconClass,previewFileIcon:t}):e},_raise:function(e,t){var i=this,r=N.Event(e),n=(void 0!==t?i.$element.trigger(r,t):i.$element.trigger(r),r.result),t=!1===n;if(r.isDefaultPrevented()||t)return!1;if("filebatchpreupload"===r.type&&(n||t))return i.ajaxAborted=n,!1;switch(e){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"filecustomerror":case"filesuccessremove":break;default:i.ajaxAborted||(i.ajaxAborted=n)}return!0},_listenFullScreen:function(e){var t,i,r=this.$modal;r&&r.length&&(t=r&&r.find(".btn-kv-fullscreen"),i=r&&r.find(".btn-kv-borderless"),t.length)&&i.length&&(t.removeClass("active").attr("aria-pressed","false"),i.removeClass("active").attr("aria-pressed","false"),(e?t:i).addClass("active").attr("aria-pressed","true"),r.hasClass("file-zoom-fullscreen")||e?this._maximizeZoomDialog():i.removeClass("active").attr("aria-pressed","false"))},_listen:function(){var t=this,i=t.$element,e=t.$form,r=t.$container;t._handler(i,"click",function(e){t._initFileSelected(),i.hasClass("file-no-browse")&&(i.data("zoneClicked")?i.data("zoneClicked",!1):e.preventDefault())}),t._handler(i,"change",N.proxy(t._change,t)),t._handler(t.$caption,"paste",N.proxy(t.paste,t)),t.showBrowse&&(t._handler(t.$btnFile,"click",N.proxy(t._browse,t)),t._handler(t.$btnFile,"keypress",function(e){13===(e.keyCode||e.which)&&(i.trigger("click"),t._browse(e))})),t._handler(r.find(".fileinput-remove:not([disabled])"),"click",N.proxy(t.clear,t)),t._handler(r.find(".fileinput-cancel"),"click",N.proxy(t.cancel,t)),t._handler(r.find(".fileinput-pause"),"click",N.proxy(t.pause,t)),t._initDragDrop(),t._handler(e,"reset",N.proxy(t.clear,t)),t.isAjaxUpload||t._handler(e,"submit",N.proxy(t._submitForm,t)),t._handler(t.$container.find(".fileinput-upload"),"click",N.proxy(t._uploadClick,t)),t._handler(N(window),"resize",function(){t._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)}),t._handler(N(document),"webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(){t._listenFullScreen(G.checkFullScreen())}),t.$caption.on("focus",function(){t.$captionContainer.focus()}),t._autoFitContent(),t._initClickable(),t._refreshPreview()},_autoFitContent:function(){var i,e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=this,e=e<400?r.previewSettingsSmall||r.defaults.previewSettingsSmall:r.previewSettings||r.defaults.previewSettings;N.each(e,function(e,t){i=".file-preview-frame .file-preview-"+e,r.$preview.find(i+".kv-preview-data,"+i+" .kv-preview-data").css(t)})},_scanDroppedItems:function(t,i,r){r=r||"";var n,e,a,o=this,s=function(e){o._log(G.logMessages.badDroppedFiles),o._log(e)};t.isFile?t.file(function(e){r&&(e.newPath=r+e.name),i.push(e)},s):t.isDirectory&&(e=t.createReader(),(a=function(){e.readEntries(function(e){if(e&&0<e.length){for(n=0;n<e.length;n++)o._scanDroppedItems(e[n],i,r+t.name+"/");a()}return null},s)})())},_initDragDrop:function(){var e=this,t=e.$dropZone;e.dropZoneEnabled&&e.showPreview&&(e._handler(t,"dragenter dragover",N.proxy(e._zoneDragEnter,e)),e._handler(t,"dragleave",N.proxy(e._zoneDragLeave,e)),e._handler(t,"drop",N.proxy(e._zoneDrop,e)),e._handler(N(document),"dragenter dragover drop",e._zoneDragDropInit))},_zoneDragDropInit:function(e){e.stopPropagation(),e.preventDefault()},_zoneDragEnter:function(e){var t=e.originalEvent.dataTransfer,i=-1<N.inArray("Files",t.types);return this._zoneDragDropInit(e),this.isDisabled||!i?(t.effectAllowed="none",void(t.dropEffect="none")):(t.dropEffect="copy",void(this._raise("fileDragEnter",{sourceEvent:e,files:t.types.Files})&&G.addCss(this.$dropZone,"file-highlighted")))},_zoneDragLeave:function(e){this._zoneDragDropInit(e),this.isDisabled||this._raise("fileDragLeave",{sourceEvent:e})&&this.$dropZone.removeClass("file-highlighted")},_dropFiles:function(e,t){var i=this,r=i.$element;i.isAjaxUpload?i._change(e,t):(i.changeTriggered=!0,r.get(0).files=t,setTimeout(function(){i.changeTriggered=!1,r.trigger("change"+i.namespace)},i.processDelay)),i.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(e){var t,i=this,r=(i.$element,e.originalEvent.dataTransfer),n=r.files,a=r.items,r=G.getDragDropFolders(a);if(e.preventDefault(),!i.isDisabled&&!G.isEmpty(n)&&i._raise("fileDragDrop",{sourceEvent:e,files:n}))if(0<r)if(i.isAjaxUpload){for(n=[],t=0;t<a.length;t++){var o=a[t].webkitGetAsEntry();o&&i._scanDroppedItems(o,n)}setTimeout(function(){i._dropFiles(e,n)},500)}else i._showFolderError(r);else i._dropFiles(e,n)},_uploadClick:function(e){var t=this.$container.find(".fileinput-upload"),i=!t.hasClass("disabled")&&G.isEmpty(t.attr("disabled"));e&&e.isDefaultPrevented()||(this.isAjaxUpload?(e.preventDefault(),i&&this.upload()):i&&"submit"!==t.attr("type")&&(e.preventDefault(),(i=t.closest("form")).length)&&i.trigger("submit"))},_submitForm:function(){return this._isFileSelectionValid()&&!this._abort({})},_clearPreview:function(){var e=this;(e.showUploadedThumbs?e.getFrames(":not(.file-preview-success)"):e.getFrames()).each(function(){N(this).remove()}),e.getFrames().length&&e.showPreview||e._resetUpload(),e._validateDefaultPreview()},_initSortable:function(){var e,l=this,t=l.$preview,i="."+G.SORT_CSS,r=N("body"),n=N("html"),f=l.reversePreviewOrder,a=window.Sortable;a&&0!==t.find(i).length&&(e=r.length?r:n.length?n:l.$container,N.extend(!0,i={handle:".drag-handle-init",dataIdAttr:"data-fileid",animation:600,draggable:i,scroll:!(r=function(){e.removeClass("file-grabbing")}),forceFallback:!0,onChoose:n=function(){e.addClass("file-grabbing")},onStart:n,onUnchoose:r,onEnd:r,onSort:function(e){var t,i=e.oldIndex,r=e.newIndex,n=0,a=l.initialPreviewConfig.length,o=0<a&&a<=r,s=N(e.item);l.initialPreview=G.moveArray(l.initialPreview,i,r=o?a-1:r,f),l.initialPreviewConfig=G.moveArray(l.initialPreviewConfig,i,r,f),l.previewCache.init(),l.getFrames(".file-preview-initial").each(function(){N(this).attr("data-fileindex",G.INIT_FLAG+n),n++}),o&&(t=l.getFrames(":not(.file-preview-initial):first")).length&&s.slideUp(function(){s.insertBefore(t).slideDown()}),l._raise("filesorted",{previewId:s.attr("id"),oldIndex:i,newIndex:r,stack:l.initialPreviewConfig})}},l.fileActionSettings.dragSettings),l.sortable&&l.sortable.destroy(),l.sortable=a.create(t[0],i))},_setPreviewContent:function(e){G.setHtml(this.$preview,e),this._autoFitContent()},_initPreviewImageOrientations:function(){var n=this,a=0,o=n.canOrientImage;(n.autoOrientImageInitial||o)&&n.getFrames(".file-preview-initial").each(function(){var e,t,i=N(this),r=n.initialPreviewConfig[a];r&&r.exif&&r.exif.Orientation&&(t=i.attr("id"),e=i.find(">.kv-file-content img"),t=n._getZoom(t," >.kv-file-content img"),o?e.css("image-orientation",n.autoOrientImageInitial?"from-image":"none"):n.setImageOrientation(e,t,r.exif.Orientation,i)),a++})},_initPreview:function(e){var t,i=this,r=i.initialCaption||"";return i.previewCache.count(!0)?(t=i.previewCache.out(),r=e&&i.initialCaption?i.initialCaption:t.caption,i._setPreviewContent(t.content),i._setInitThumbAttr(),i._setCaption(r),i._initSortable(),G.isEmpty(t.content)||i.$container.removeClass("file-input-new"),void i._initPreviewImageOrientations()):(i._clearPreview(),void(e?i._setCaption(r):i._initCaption()))},_getZoomButton:function(e){var t=this.previewZoomButtonIcons[e],i=this.previewZoomButtonClasses[e],r=' title="'+(this.previewZoomButtonTitles[e]||"")+'" ',n=G.isBs(5)?"bs-":"",r=r+("close"===e?" data-"+n+'dismiss="modal" aria-hidden="true"':"");return"fullscreen"!==e&&"borderless"!==e&&"toggleheader"!==e||(r+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+i+" btn-kv-"+e+'"'+r+">"+t+"</button>"},_getModalContent:function(){var e=this;return e._getLayoutTemplate("modal").setTokens({rtl:e.rtl?" kv-rtl":"",zoomFrameClass:e.frameClass,prev:e._getZoomButton("prev"),next:e._getZoomButton("next"),rotate:e._getZoomButton("rotate"),toggleheader:e._getZoomButton("toggleheader"),fullscreen:e._getZoomButton("fullscreen"),borderless:e._getZoomButton("borderless"),close:e._getZoomButton("close")})},_listenModalEvent:function(r){var n=this,a=n.$modal;a.on(r+".bs.modal",function(e){var t,i;"bs.modal"===e.namespace&&(t=a.find(".btn-fullscreen"),i=a.find(".btn-borderless"),a.data("fileinputPluginId")===n.$element.attr("id")&&n._raise("filezoom"+r,{sourceEvent:e,previewId:a.data("previewId"),modal:a}),"shown"===r)&&(n._handleRotation(a,a.find(".file-zoom-detail"),a.data("angle")),i.removeClass("active").attr("aria-pressed","false"),t.removeClass("active").attr("aria-pressed","false"),a.hasClass("file-zoom-fullscreen"))&&(n._maximizeZoomDialog(),(G.checkFullScreen()?t:i).addClass("active").attr("aria-pressed","true"))})},_initZoom:function(){var i=this,e=i._getLayoutTemplate("modalMain"),t="#"+G.MODAL_ID,e=i._setTabIndex("modal",e);i.showPreview&&(i.$modal=N(t),i.$modal&&i.$modal.length||(e=G.createElement(G.cspBuffer.stash(e)).insertAfter(i.$container),i.$modal=N(t).insertBefore(e),G.cspBuffer.apply(i.$modal),e.remove()),G.initModal(i.$modal),i.$modal.html(G.cspBuffer.stash(i._getModalContent())),G.cspBuffer.apply(i.$modal),N.each(G.MODAL_EVENTS,function(e,t){i._listenModalEvent(t)}))},_initZoomButtons:function(){var e=this.$modal,t=e.data("previewId")||"",i=this.getFrames().toArray(),r=i.length,n=e.find(".btn-kv-prev"),a=e.find(".btn-kv-next");return e.find(".btn-kv-rotate"),i.length<2?(n.hide(),void a.hide()):(n.show(),a.show(),void(r&&(e=N(i[0]),i=N(i[r-1]),n.removeAttr("disabled"),a.removeAttr("disabled"),this.reversePreviewOrder&&([n,a]=[a,n]),e.length&&e.attr("id")===t&&n.attr("disabled",!0),i.length)&&i.attr("id")===t&&a.attr("disabled",!0)))},_maximizeZoomDialog:function(){var e=this.$modal,t=e.find(".modal-header:visible"),i=e.find(".modal-footer:visible"),r=e.find(".kv-zoom-body"),n=N(window).height();e.addClass("file-zoom-fullscreen"),t&&t.length&&(n-=t.outerHeight(!0)),i&&i.length&&(n-=i.outerHeight(!0)),r&&r.length&&(n-=r.outerHeight(!0)-r.height()),e.find(".kv-zoom-body").height(n)},_resizeZoomDialog:function(e){var t=this,i=t.$modal,r=i.find(".btn-kv-fullscreen"),n=i.find(".btn-kv-borderless");if(i.hasClass("file-zoom-fullscreen"))G.toggleFullScreen(!1),e?r.hasClass("active")||(i.removeClass("file-zoom-fullscreen"),t._resizeZoomDialog(!0),n.hasClass("active")&&n.removeClass("active").attr("aria-pressed","false")):r.hasClass("active")?r.removeClass("active").attr("aria-pressed","false"):(i.removeClass("file-zoom-fullscreen"),t.$modal.find(".kv-zoom-body").css("height",t.zoomModalHeight));else{if(!e)return void t._maximizeZoomDialog();G.toggleFullScreen(!0)}i.focus()},_setZoomContent:function(e,t){var i,r,n,a,o,s=this,l=e.attr("id"),f=s._getZoom(l),c=s.$modal,u=c.find(".btn-kv-fullscreen"),p=c.find(".btn-kv-borderless"),d=c.find(".btn-kv-toggleheader"),h=e.data("zoom");h&&(h=decodeURIComponent(h),o=f.html().replace(s.zoomPlaceholder,"").setTokens({zoomData:h}),f.html(o),e.data("zoom",""),f.attr("data-zoom",h)),o=f.attr("data-template")||"generic",f=(h=f.find(".kv-file-content")).length?h.html():"",h=e.data("caption")||s.msgZoomModalHeading,a=e.data("size")||"",e=e.data("description")||"",c.find(".kv-zoom-caption").attr("title",h).html(h),c.find(".kv-zoom-size").html(a),h=c.find(".kv-zoom-description").hide(),e&&(s.showDescriptionClose&&(e=s._getLayoutTemplate("descriptionClose").setTokens({closeIcon:s.previewZoomButtonIcons.close})+"</button>"+e),h.show().html(e),s.showDescriptionClose)&&s._handler(c.find(".kv-desc-hide"),"click",function(){N(this).parent().fadeOut("fast",function(){c.focus()})}),i=c.find(".kv-zoom-body"),c.removeClass("kv-single-content"),t?(n=i.addClass("file-thumb-loading").clone().insertAfter(i),G.setHtml(i,f).hide(),n.fadeOut("fast",function(){i.fadeIn("fast",function(){i.removeClass("file-thumb-loading")}),n.remove()})):G.setHtml(i,f),(a=s.previewZoomSettings[o])&&(r=i.find(".kv-preview-data"),G.addCss(r,"file-zoom-detail"),N.each(a,function(e,t){r.css(e,t),(r.attr("width")&&"width"===e||r.attr("height")&&"height"===e)&&r.removeAttr(e)})),c.data("previewId",l),s._handler(c.find(".btn-kv-prev"),"click",function(){s._zoomSlideShow("prev",l)}),s._handler(c.find(".btn-kv-next"),"click",function(){s._zoomSlideShow("next",l)}),s._handler(u,"click",function(){s._resizeZoomDialog(!0)}),s._handler(p,"click",function(){s._resizeZoomDialog(!1)}),s._handler(d,"click",function(){function e(e){var t=s.$modal.find(".kv-zoom-body"),i=s.zoomModalHeight;c.hasClass("file-zoom-fullscreen")&&(i=t.outerHeight(!0),e||(i-=r.outerHeight(!0))),t.css("height",e?i+e:i)}var t,r=c.find(".modal-header"),i=c.find(".floating-buttons"),n=r.find(".kv-zoom-actions");r.is(":visible")?(t=r.outerHeight(!0),r.slideUp("slow",function(){n.find(".btn").appendTo(i),e(t)})):(i.find(".btn").appendTo(n),r.slideDown("slow",function(){e()})),c.focus()}),s._handler(c,"keydown",function(e){var t,i,r=e.which||e.keyCode,n=s.processDelay+1,e=N(this).find(".btn-kv-prev"),a=N(this).find(".btn-kv-next"),o=N(this).data("previewId");[t,i]=s.rtl?[39,37]:[37,39],N.each({prev:[e,t],next:[a,i]},function(e,t){var i=t[0],t=t[1];r===t&&i.length&&(c.focus(),i.attr("disabled")||(i.blur(),setTimeout(function(){i.focus(),s._zoomSlideShow(e,o),setTimeout(function(){i.attr("disabled")&&c.focus()},n)},n)))})})},_showModal:function(e){var t,i,r=this,n=r.$modal;e&&e.length&&(G.initModal(n),G.setHtml(n,r._getModalContent()),r._setZoomContent(e),n.removeClass("rotatable"),n.data({backdrop:!1,fileinputPluginId:r.$element.attr("id")}),n.find(".kv-zoom-body").css("height",r.zoomModalHeight),(t=e.find(".kv-file-content > :first-child")).length&&(i=t.css("transform"))&&n.find(".file-zoom-detail").css("transform",i),e.hasClass("rotatable")&&n.addClass("rotatable"),e.data("angle")&&n.data("angle",e.data("angle")),e.data("angle"),n.modal("show"),r._initZoomButtons(),r._initRotateZoom(e,t))},_zoomPreview:function(e){if(!e.length)throw"Cannot zoom to detailed preview!";e=e.closest(G.FRAMES),this._showModal(e)},_zoomSlideShow:function(e,t){var i,r,n,a,o=this,s=o.$modal,l=s.find(".kv-zoom-actions .btn-kv-"+e),f=o.getFrames().toArray(),c=[],u=f.length;if(o.reversePreviewOrder&&(e="prev"===e?"next":"prev"),!l.attr("disabled")){for(i=0;i<u;i++)(r=N(f[i]))&&r.length&&r.find(".kv-file-zoom:visible").length&&c.push(f[i]);for(u=c.length,i=0;i<u;i++)if(N(c[i]).attr("id")===t){n="prev"===e?i-1:i+1;break}n<0||u<=n||!c[n]||((l=N(c[n])).length&&o._setZoomContent(l,e),o._initZoomButtons(),l.length&&l.hasClass("rotatable")?(a=l.data("angle")||0,s.addClass("rotatable").data("angle",a),a=l.find(".kv-file-content > :first-child"),o._initRotateZoom(l,a)):s.removeClass("rotatable").removeData("angle"),o._raise("filezoom"+e,{previewId:t,modal:o.$modal}))}},_initZoomButton:function(){var t=this;t.$preview.find(".kv-file-zoom").each(function(){var e=N(this);t._handler(e,"click",function(){t._zoomPreview(e)})})},_inputFileCount:function(){return this.$element[0].files.length},_refreshPreview:function(){var e,t=this;(t._inputFileCount()||t.isAjaxUpload)&&t.showPreview&&t.isPreviewable&&(t.isAjaxUpload&&0<t.fileManager.count()?(e=N.extend(!0,[],t.getFileList()),t.fileManager.clear(),t._clearFileInput()):e=t.$element[0].files,e)&&e.length&&t.readFiles(e)},_clearObjects:function(e){e.find("video audio").each(function(){this.pause(),N(this).remove()}),e.find("img object div").each(function(){N(this).remove()})},_clearFileInput:function(){var e,t,i,r=this.$element;this._inputFileCount()&&(e=r.closest("form"),t=N(document.createElement("form")),i=N(document.createElement("div")),r.before(i),(e.length?e:i).after(t),t.append(r).trigger("reset"),i.before(r).remove(),t.remove())},_resetUpload:function(){var e=this;e.uploadInitiated=!1,e.uploadStartTime=G.now(),e.uploadCache=[],e.$btnUpload.removeAttr("disabled"),e._setProgress(0),e._hideProgress(),e._resetErrors(!1),e._initAjax(),e.fileManager.clearImages(),e._resetCanvas(),e.overwriteInitial&&(e.initialPreview=[],e.initialPreviewConfig=[],e.initialPreviewThumbTags=[],e.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){var e=this;e.imageCanvas&&e.imageCanvasContext&&e.imageCanvasContext.clearRect(0,0,e.imageCanvas.width,e.imageCanvas.height)},_hasInitialPreview:function(){return!this.overwriteInitial&&this.previewCache.count(!0)},_resetPreview:function(){var e,t,i=this,r=i.showUploadedThumbs,n=!i.removeFromPreviewOnError,a=(r||n)&&i.isDuplicateError;i.previewCache.count(!0)?(e=i.previewCache.out(),a&&(t=G.createElement("").insertAfter(i.$container),i.getFrames().each(function(){var e=N(this);(r&&e.hasClass("file-preview-success")||n&&e.hasClass("file-preview-error"))&&t.append(e)})),i._setPreviewContent(e.content),i._setInitThumbAttr(),e=i.initialCaption||e.caption,i._setCaption(e),a&&(t.contents().appendTo(i.$preview),t.remove())):(i._clearPreview(),i._initCaption()),i.showPreview&&(i._initZoom(),i._initSortable()),i.isDuplicateError=!1},_clearDefaultPreview:function(){this.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var e=this;e.showPreview&&!G.isEmpty(e.defaultPreviewContent)&&(e._setPreviewContent('<div class="file-default-preview">'+e.defaultPreviewContent+"</div>"),e.$container.removeClass("file-input-new"),e._initClickable())},_resetPreviewThumbs:function(e){var t=this;return e?(t._clearPreview(),void t.clearFileStack()):void(t._hasInitialPreview()?(e=t.previewCache.out(),t._setPreviewContent(e.content),t._setInitThumbAttr(),t._setCaption(e.caption),t._initPreviewActions()):t._clearPreview())},_getLayoutTemplate:function(e){e=this.layoutTemplates[e];return G.isEmpty(this.customLayoutTags)?e:G.replaceTags(e,this.customLayoutTags)},_getPreviewTemplate:function(e){var t=this.previewTemplates,e=t[e]||t.other;return G.isEmpty(this.customPreviewTags)?e:G.replaceTags(e,this.customPreviewTags)},_getOutData:function(e,t,i,r){var n=this;return t=t||{},i=i||{},{formdata:e,files:r=r||n.fileManager.list(),filenames:n.filenames,filescount:n.getFilesCount(),extra:n._getExtraData(),response:i,reader:n.reader,jqXHR:t}},_getMsgSelected:function(e,t){var i=this,r=1===e?i.fileSingle:i.filePlural;return 0<e?i.msgSelected.replace("{n}",e).replace("{files}",r):t?i.msgProcessing:i.msgNoFilesSelected},_getFrame:function(e,t){var i=G.getFrameElement(this.$preview,e);return!this.showPreview||t||i.length||this._log(G.logMessages.invalidThumb,{id:e}),i},_getZoom:function(e,t){t=G.getZoomElement(this.$preview,e,t);return this.showPreview&&!t.length&&this._log(G.logMessages.invalidThumb,{id:e}),t},_getThumbs:function(e){return this.getFrames(":not(.file-preview-initial)"+(e=e||""))},_getThumbId:function(e){return this.previewInitId+"-"+e},_getExtraData:function(e,t){var i=this.uploadExtraData;return i="function"==typeof this.uploadExtraData?this.uploadExtraData(e,t):i},_initXhr:function(e,a){var o=this,s=o.fileManager,t=function(e){var t=0,i=e.total,r=e.loaded||e.position,n=s.getUploadStats(a,r,i);e.lengthComputable&&!o.enableResumableUpload&&(t=G.round(r/i*100)),a?o._setFileUploadStats(a,t,n):o._setProgress(t,null,null,o._getStats(n)),o._raise("fileajaxprogress",[n])};return e.upload&&(o.progressDelay&&(t=G.debounce(t,o.progressDelay)),e.upload.addEventListener("progress",t,!1)),e},_initAjaxSettings:function(){this._ajaxSettings=N.extend(!0,{},this.ajaxSettings),this._ajaxDeleteSettings=N.extend(!0,{},this.ajaxDeleteSettings)},_mergeAjaxCallback:function(e,t,i){var r,n=this._ajaxSettings,a=this.mergeAjaxCallbacks;"delete"===i&&(n=this._ajaxDeleteSettings,a=this.mergeAjaxDeleteCallbacks),r=n[e],n[e]=a&&"function"==typeof r?"before"===a?function(){r.apply(this,arguments),t.apply(this,arguments)}:function(){t.apply(this,arguments),r.apply(this,arguments)}:t},_ajaxSubmit:function(e,t,i,r,n,a,o,s){var l=this,f=l.taskManager;l._raise("filepreajax",[n,a,o])&&(n.append("initialPreview",JSON.stringify(l.initialPreview)),n.append("initialPreviewConfig",JSON.stringify(l.initialPreviewConfig)),n.append("initialPreviewThumbTags",JSON.stringify(l.initialPreviewThumbTags)),l._initAjaxSettings(),l._mergeAjaxCallback("beforeSend",e),l._mergeAjaxCallback("success",t),l._mergeAjaxCallback("complete",i),l._mergeAjaxCallback("error",r),"function"==typeof(s=s||l.uploadUrlThumb||l.uploadUrl)&&(s=s()),"object"==typeof(e=l._getExtraData(a,o)||{})&&N.each(e,function(e,t){n.append(e,t)}),t={xhr:function(){var e=N.ajaxSettings.xhr();return l._initXhr(e,a)},url:l._encodeURI(s),type:"POST",dataType:"json",data:n,cache:!1,processData:!1,contentType:!1},i=N.extend(!0,{},t,l._ajaxSettings),l.ajaxQueue.push(i),f.addTask(a+"-"+o,function(){var e=this.self,t=e.ajaxQueue.shift(),t=N.ajax(t);e.ajaxRequests.push(t)}).runWithContext({self:l}))},_mergeArray:function(e,t){var i=G.cleanArray(this[e]),t=G.cleanArray(t);this[e]=i.concat(t)},_initUploadSuccess:function(e,t,i){var r,n,a,o,s,l=this;l.showPreview&&"object"==typeof e&&!N.isEmptyObject(e)&&void 0!==e.initialPreview&&0<e.initialPreview.length&&(l.hasInitData=!0,n=e.initialPreview||[],a=e.initialPreviewConfig||[],o=e.initialPreviewThumbTags||[],e=void 0===e.append||e.append,(n=0<n.length&&!G.isArray(n)?n.split(l.initialPreviewDelimiter):n).length&&(l._mergeArray("initialPreview",n),l._mergeArray("initialPreviewConfig",a),l._mergeArray("initialPreviewThumbTags",o)),void 0!==t?i?(i=t.attr("id"),null!==(s=l._getUploadCacheIndex(i))&&(l.uploadCache[s]={id:i,content:n[0],config:a[0]||[],tags:o[0]||[],append:e})):(s=l.previewCache.add(n[0],a[0],o[0],e),i=l.previewCache.get(s,!1),r=G.createElement(i).hide().appendTo(t),t.fadeOut("slow",function(){var e=r.find("> .file-preview-frame");e&&e.length&&e.insertBefore(t).fadeIn("slow").css("display:inline-block"),l._initPreviewActions(),l._clearFileInput(),t.remove(),r.remove(),l._initSortable()})):(l.previewCache.set(n,a,o,e),l._initPreview(),l._initPreviewActions())),l._resetCaption()},_getUploadCacheIndex:function(e){for(var t=this.uploadCache.length,i=0;i<t;i++)if(this.uploadCache[i].id===e)return i;return null},_initSuccessThumbs:function(){var i=this;i.showPreview&&setTimeout(function(){i._getThumbs(G.FRAMES+".file-preview-success").each(function(){var t=N(this),e=t.find(".kv-file-remove");e.removeAttr("disabled"),i._handler(e,"click",function(){var e=t.attr("id"),e=i._raise("filesuccessremove",[e,t.attr("data-fileindex")]);G.cleanMemory(t),!1!==e&&(i.$caption.attr("title",""),t.fadeOut("slow",function(){i.fileManager,t.remove(),i.getFrames().length||i.reset()}))})})},i.processDelay)},_updateInitialPreview:function(){var i=this,e=i.uploadCache;i.showPreview&&(N.each(e,function(e,t){i.previewCache.add(t.content,t.config,t.tags,t.append)}),i.hasInitData)&&(i._initPreview(),i._initPreviewActions())},_getThumbFileId:function(e){return this.showPreview&&void 0!==e?e.attr("data-fileid"):null},_getThumbFile:function(e){e=this._getThumbFileId(e);return e?this.fileManager.getFile(e):null},_uploadSingle:function(n,a,o,e){var s,l,t,f,i,c,u,p,r,d,h,m=this,g=m.fileManager,v=g.count(),w=new FormData,y=m._getThumbId(a),b=0<v||!N.isEmptyObject(m.uploadExtraData),_=m.ajaxOperations.uploadThumb,S=g.getFile(a),x={id:y,index:n,fileId:a},C=m.fileManager.getFileName(a,!0),k=function(){e&&e.resolve&&e.resolve()},T=function(){e&&e.reject&&e.reject()};m.enableResumableUpload||(m.uploadInitiated=!0,m.showPreview&&(l=g.getThumb(a),u=l.find(".file-thumb-progress"),f=l.find(".kv-file-upload"),i=l.find(".kv-file-remove"),u.show()),0===v)||!b||m.showPreview&&f&&f.hasClass("disabled")||m._abort(x)||(h=function(){c?g.errors.push(a):g.removeFile(a),g.setProcessed(a),g.isProcessed()&&(m.fileBatchCompleted=!0,t())},t=function(){var i;m.fileBatchCompleted&&setTimeout(function(){var e=0===g.count(),t=g.errors.length;m._updateInitialPreview(),m.unlock(e),e&&m._clearFileInput(),i=m.$preview.find(".file-preview-initial"),m.uploadAsync&&i.length&&(G.addCss(i,G.SORT_CSS),m._initSortable()),m._raise("filebatchuploadcomplete",[g.stack,m._getExtraData()]),m.retryErrorUploads&&0!==t||g.clear(),m._setProgress(101),m.ajaxAborted=!1,m.uploadInitiated=!1},m.processDelay)},v=function(e){s=m._getOutData(w,e),g.initStats(a),m.fileBatchCompleted=!1,o||(m.ajaxAborted=!1),m.showPreview&&(l.hasClass("file-preview-success")||(m._setThumbStatus(l,"Loading"),G.addCss(l,"file-uploading")),f.attr("disabled",!0),i.attr("disabled",!0)),o||m.lock(),-1!==g.errors.indexOf(a)&&delete g.errors[a],m._raise("filepreupload",[s,y,n,m._getThumbFileId(l)]),N.extend(!0,x,s),m._abort(x)&&(e.abort(),o||(m._setThumbStatus(l,"New"),l.removeClass("file-uploading"),f.removeAttr("disabled"),i.removeAttr("disabled")),m._setProgressCancelled())},b=function(e,t,i){var r=m.showPreview&&l.attr("id")?l.attr("id"):y;s=m._getOutData(w,i,e),N.extend(!0,x,s),setTimeout(function(){G.isEmpty(e)||G.isEmpty(e.error)?(m.showPreview&&(m._setThumbStatus(l,"Success"),f.hide(),m._initUploadSuccess(e,l,o),m._setProgress(101,u)),m._raise("fileuploaded",[s,r,n,m._getThumbFileId(l)]),o?(h(),k()):m.fileManager.remove(l)):(c=!0,p=m._parseError(_,i,m.msgUploadError,m.fileManager.getFileName(a)),m._showFileError(p,x),m._setPreviewError(l,!0),m.retryErrorUploads||f.hide(),o&&(h(),k()),m._setProgress(101,m._getFrame(r).find(".file-thumb-progress"),m.msgUploadError))},m.processDelay)},r=function(){m.showPreview&&(f.removeAttr("disabled"),i.removeAttr("disabled"),l.removeClass("file-uploading")),o?t():(m.unlock(!1),m._clearFileInput()),m._initSuccessThumbs()},d=function(t,e,i){p=m._parseError(_,t,i,m.fileManager.getFileName(a)),c=!0,setTimeout(function(){var e;o&&(h(),T()),m.fileManager.setProgress(a,100),m._setPreviewError(l,!0),m.retryErrorUploads||f.hide(),N.extend(!0,x,m._getOutData(w,t)),m._setProgress(101,m.$progress,m.msgAjaxProgressError.replace("{operation}",_)),e=m.showPreview&&l?l.find(".file-thumb-progress"):"",m._setProgress(101,e,m.msgUploadError),m._showFileError(p,x)},m.processDelay)},m._setFileData(w,S.file,C,a),m._setUploadData(w,{fileId:a}),m._ajaxSubmit(v,b,r,d,w,a,n))},_setFileData:function(e,t,i,r){var n=this.preProcessUpload;n&&"function"==typeof n?e.append(this.uploadFileAttr,n(r,t)):e.append(this.uploadFileAttr,t,i)},_checkBatchPreupload:function(e,t){var r=this;return!!r._raise("filebatchpreupload",[e])||(r._abort(e),t&&t.abort(),r._getThumbs().each(function(){var e=N(this),t=e.find(".kv-file-upload"),i=e.find(".kv-file-remove");e.hasClass("file-preview-loading")&&(r._setThumbStatus(e,"New"),e.removeClass("file-uploading")),t.removeAttr("disabled"),i.removeAttr("disabled")}),r._setProgressCancelled(),!1)},_uploadBatch:function(){var s,l,e,t,i,r,f=this,n=f.fileManager,a=n.total(),o=0<a||!N.isEmptyObject(f.uploadExtraData),c=new FormData,u=f.ajaxOperations.uploadBatch;0!==a&&o&&!f._abort({})&&(l=function(){f.fileManager.clear(),f._clearFileInput()},o=function(e){f.lock(),n.initStats();var t=f._getOutData(c,e);f.ajaxAborted=!1,f.showPreview&&f._getThumbs().each(function(){var e=N(this),t=e.find(".kv-file-upload"),i=e.find(".kv-file-remove");e.hasClass("file-preview-success")||(f._setThumbStatus(e,"Loading"),G.addCss(e,"file-uploading")),t.attr("disabled",!0),i.attr("disabled",!0)}),f._checkBatchPreupload(t,e)},e=function(e,t,i){var r=f._getOutData(c,i,e),n=0,a=f._getThumbs(":not(.file-preview-success)"),o=G.isEmpty(e)||G.isEmpty(e.errorkeys)?[]:e.errorkeys;G.isEmpty(e)||G.isEmpty(e.error)?(f._raise("filebatchuploadsuccess",[r]),l(),f.showPreview?(a.each(function(){var e=N(this);f._setThumbStatus(e,"Success"),e.removeClass("file-uploading"),e.find(".kv-file-upload").hide().removeAttr("disabled")}),f._initUploadSuccess(e)):f.reset(),f._setProgress(101)):(f.showPreview&&(a.each(function(){var e=N(this);e.removeClass("file-uploading"),e.find(".kv-file-upload").removeAttr("disabled"),e.find(".kv-file-remove").removeAttr("disabled"),0===o.length||-1!==N.inArray(n,o)?(f._setPreviewError(e,!0),f.retryErrorUploads||(e.find(".kv-file-upload").hide(),f.fileManager.remove(e))):(e.find(".kv-file-upload").hide(),f._setThumbStatus(e,"Success"),f.fileManager.remove(e)),e.hasClass("file-preview-error")&&!f.retryErrorUploads||n++}),f._initUploadSuccess(e)),s=f._parseError(u,i,f.msgUploadError),f._showFileError(s,r,"filebatchuploaderror"),f._setProgress(101,f.$progress,f.msgUploadError))},t=function(){f.unlock(),f._initSuccessThumbs(),f._clearFileInput(),f._raise("filebatchuploadcomplete",[f.fileManager.stack,f._getExtraData()])},i=function(e,t,i){var r=f._getOutData(c,e);s=f._parseError(u,e,i),f._showFileError(s,r,"filebatchuploaderror"),f.uploadFileCount=a-1,f.showPreview&&(f._getThumbs().each(function(){var e=N(this);e.removeClass("file-uploading"),f._getThumbFile(e)&&f._setPreviewError(e)}),f._getThumbs().removeClass("file-uploading"),f._getThumbs(" .kv-file-upload").removeAttr("disabled"),f._getThumbs(" .kv-file-delete").removeAttr("disabled"),f._setProgress(101,f.$progress,f.msgAjaxProgressError.replace("{operation}",u)))},r=0,N.each(f.fileManager.stack,function(e,t){G.isEmpty(t.file)||f._setFileData(c,t.file,t.nameFmt||"untitled_"+r,e),r++}),f._ajaxSubmit(o,e,t,i,c))},_uploadExtraOnly:function(){var n,a=this,o={},s=new FormData,l=a.ajaxOperations.uploadExtra;a._ajaxSubmit(function(e){a.lock();var t=a._getOutData(s,e);a._setProgress(50),o.data=t,o.xhr=e,a._checkBatchPreupload(t,e)},function(e,t,i){var r=a._getOutData(s,i,e);G.isEmpty(e)||G.isEmpty(e.error)?(a._raise("filebatchuploadsuccess",[r]),a._clearFileInput(),a._initUploadSuccess(e),a._setProgress(101)):(n=a._parseError(l,i,a.msgUploadError),a._showFileError(n,r,"filebatchuploaderror"))},function(){a.unlock(),a._clearFileInput(),a._raise("filebatchuploadcomplete",[a.fileManager.stack,a._getExtraData()])},function(e,t,i){var r=a._getOutData(s,e);n=a._parseError(l,e,i),o.data=r,a._showFileError(n,r,"filebatchuploaderror"),a._setProgress(101,a.$progress,a.msgAjaxProgressError.replace("{operation}",l))},s)},_deleteFileIndex:function(e){var t=this,i=e.attr("data-fileindex"),e=t.reversePreviewOrder;i.substring(0,5)===G.INIT_FLAG&&(i=parseInt(i.replace(G.INIT_FLAG,"")),t.initialPreview=G.spliceArray(t.initialPreview,i,e),t.initialPreviewConfig=G.spliceArray(t.initialPreviewConfig,i,e),t.initialPreviewThumbTags=G.spliceArray(t.initialPreviewThumbTags,i,e),t.getFrames().each(function(){var e=N(this),t=e.attr("data-fileindex");t.substring(0,5)===G.INIT_FLAG&&(t=parseInt(t.replace(G.INIT_FLAG,"")),i<t)&&e.attr("data-fileindex",G.INIT_FLAG+--t)}))},_resetCaption:function(){var n=this;setTimeout(function(){var e="",t=n.previewCache.count(!0),i=n.fileManager.count(),r=n.showPreview&&n.getFrames(":not(.file-preview-success):not(.file-preview-error)").length;0!==i||0!==t||r?(e=1<(r=t+i)?n._getMsgSelected(r):0===i?(e="",(e=(t=n.initialPreviewConfig[0])?t.caption||t.filename||"":e)||n._getMsgSelected(r)):(i=n.fileManager.getFirstFile())?i.nameFmt:"_",n._setCaption(e)):n.reset()},n.processDelay)},_handleRotation:function(e,t,i){var r,n,a,o="",s=1,l=t[0],f=t.parent(),c=N("body"),u=!!c.length;return u&&c.addClass("kv-overflow-hidden"),!t.length||e.hasClass("hide-rotate")?void(u&&c.removeClass("kv-overflow-hidden")):((a=t.css("transform"))&&t.css("transform","none"),a&&t.css("transform",a),a="rotate("+(i=i||0)+"deg)",r="rotate("+(n=i%360)+"deg)",o="",90!=n&&270!=n||(i=l.naturalWidth||t.outerWidth()||0,s=(l=l.naturalHeight||t.outerHeight()||0)<i&&0!=i?(l/i).toFixed(2):1,1!==(s=f.length&&(l=f.height(),f=f.width(),s*(i=Math.min(i,f))<l)?l<i&&0!=i?(l/i).toFixed(2):1:s)&&(o=" scale("+s+")")),t.addClass("rotate-animate").css("transform",a+o),void setTimeout(function(){t.removeClass("rotate-animate").css("transform",r+o),u&&c.removeClass("kv-overflow-hidden"),e.data("angle",n)},this.fadeDelay))},_initRotateButton:function(){var r=this;r.getFrames(".rotatable .kv-file-rotate").each(function(){var e=N(this),t=e.closest(G.FRAMES),i=t.find(".kv-file-content > :first-child");r._handler(e,"click",function(){var e=(t.data("angle")||0)+90;r._handleRotation(t,i,e)})})},_initRotateZoom:function(e,t){var i=this,r=i.$modal,n=r.find(".btn-kv-rotate"),a=e.data("angle");r.data("angle",a),n.length&&(n.off("click"),r.hasClass("rotatable"))&&n.on("click",function(){a=(r.data("angle")||0)+90,r.data("angle",a),i._handleRotation(r,r.find(".file-zoom-detail"),a),i._handleRotation(e,t,a),e.hasClass("hide-rotate")&&e.data("angle",a)})},_initFileActions:function(){var a=this;a.showPreview&&(a._initZoomButton(),a._initRotateButton(),a.getFrames(" .kv-file-remove").each(function(){var e,t=N(this),i=t.closest(G.FRAMES),r=i.attr("id"),n=i.attr("data-fileindex");a.fileManager,a._handler(t,"click",function(){return!(!1===a._raise("filepreremove",[r,n])||!a._validateMinCount())&&(e=i.hasClass("file-preview-error"),G.cleanMemory(i),void i.fadeOut("slow",function(){a.fileManager.remove(i),a._clearObjects(i),i.remove(),r&&e&&a.$errorContainer.find('li[data-thumb-id="'+r+'"]').fadeOut("fast",function(){N(this).remove(),a._errorsExist()||a._resetErrors()}),a._clearFileInput(),a._resetCaption(),a._raise("fileremoved",[r,n])}))})}),a.getFrames(" .kv-file-upload").each(function(){var i=N(this);a._handler(i,"click",function(){var e=i.closest(G.FRAMES),t=a._getThumbFileId(e);a._hideProgress(),e.hasClass("file-preview-error")&&!a.retryErrorUploads||a._uploadSingle(a.fileManager.getIndex(t),t,!1)})}))},_initPreviewActions:function(){function h(){var e=m.isAjaxUpload?m.previewCache.count(!0):m._inputFileCount();m.getFrames().length||e?m._resetCaption():(m._setCaption(""),m.reset(),m.initialCaption="")}var m=this,e=m.$preview,g=m.deleteExtraData||{},t=G.FRAMES+" .kv-file-remove",i=m.fileActionSettings,v=i.removeClass,w=i.removeErrorClass;m._initZoomButton(),m._initRotateButton(),e.find(t).each(function(){var n,e,t,i,a,o,s,r,l,f,c=N(this),u=c.data("url")||m.deleteUrl,p=c.data("key"),d=m.ajaxOperations.deleteThumb;G.isEmpty(u)||void 0===p||("function"==typeof u&&(u=u()),o=c.closest(G.FRAMES),r=m.previewCache.data,s=o.attr("data-fileindex"),s=parseInt(s.replace(G.INIT_FLAG,"")),r=G.isEmpty(r.config)&&G.isEmpty(r.config[s])?null:r.config[s],l=G.isEmpty(r)||G.isEmpty(r.extra)?g:r.extra,f=r&&(r.filename||r.caption)||"","function"==typeof l&&(l=l()),a={id:c.attr("id"),key:p,extra:l},r=function(e){m.ajaxAborted=!1,m._raise("filepredelete",[p,e,l]),m._abort()?e.abort():(c.removeClass(w),G.addCss(o,"file-uploading"),G.addCss(c,"disabled "+v))},e=function(e,t,i){var r;return G.isEmpty(e)||G.isEmpty(e.error)?(o.removeClass("file-uploading").addClass("file-deleted"),void o.fadeOut("slow",function(){s=parseInt(o.attr("data-fileindex").replace(G.INIT_FLAG,"")),m.previewCache.unset(s),m._deleteFileIndex(o),r=m.previewCache.count(!0),r=0<r?m._getMsgSelected(r):"",m._setCaption(r),m._raise("filedeleted",[p,i,l]),m._clearObjects(o),o.remove(),h()})):(a.jqXHR=i,a.response=e,n=m._parseError(d,i,m.msgDeleteError,f),m._showFileError(n,a,"filedeleteerror"),o.removeClass("file-uploading"),c.removeClass("disabled "+v).addClass(w),void h())},t=function(e,t,i){i=m._parseError(d,e,i,f);a.jqXHR=e,a.response={},m._showFileError(i,a,"filedeleteerror"),o.removeClass("file-uploading"),c.removeClass("disabled "+v).addClass(w),h()},m._initAjaxSettings(),m._mergeAjaxCallback("beforeSend",r,"delete"),m._mergeAjaxCallback("success",e,"delete"),m._mergeAjaxCallback("error",t,"delete"),i=N.extend(!0,{},{url:m._encodeURI(u),type:"POST",dataType:"json",data:N.extend(!0,{},{key:p},l)},m._ajaxDeleteSettings),m._handler(c,"click",function(){return!!m._validateMinCount()&&(m.ajaxAborted=!1,m._raise("filebeforedelete",[p,l]),void(m.ajaxAborted instanceof Promise?m.ajaxAborted.then(function(e){e||N.ajax(i)}):m.ajaxAborted||N.ajax(i)))}))})},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.removeClass("icon-visible")},_showFileIcon:function(){G.addCss(this.$captionContainer,"icon-visible")},_getSize:function(e,t,i){var r,n=parseFloat(e),a=0,o=this.bytesToKB,s=this.fileSizeGetter,l=n;if(!N.isNumeric(e)||!N.isNumeric(n))return"";if("function"==typeof s)r=s(n);else{if(i=i||this.sizeUnits,0<n){for(;o<=l;)l/=o,++a;i[a]||(l=n,a=0)}r=(e=(e=l.toFixed(2))==l?l:e)+" "+i[a]}return t?r:this._getLayoutTemplate("size").replace("{sizeText}",r)},_getFileType:function(e){return this.mimeTypeAliases[e]||e},_generatePreviewTemplate:function(o,e,s,l,f,c,t,i,r,u,n,p,d,h,a){var m,g=this,v=g.slug(s),w="",y="",b=r||s,r=b.split(".").pop().toLowerCase(),_=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,S=v,x=v,C="type-default",k=n||g._renderFileFooter(o,v,i,"auto",t),n=-1!==N.inArray(r,g.alwaysPreviewFileExtensions),i=g.preferIconicPreview&&!n,t=g.preferIconicZoomPreview&&!n,n=i?"other":o,_=_<400?g.previewSettingsSmall[n]||g.defaults.previewSettingsSmall[n]:g.previewSettings[n]||g.defaults.previewSettings[n];return _&&N.each(_,function(e,t){y+=e+":"+t+";"}),n=function(e,t,i,r,n){var a=i?"zoom-"+f:f,e=g._getPreviewTemplate(e),r=(u||"")+" "+r;return g.frameClass&&(r=g.frameClass+" "+r),i&&(r=r.replace(" "+G.SORT_CSS,"")),e=g._parseFilePreviewIcon(e,s),"object"!==o||l||N.each(g.defaults.fileTypeSettings,function(e,t){"object"!==e&&"other"!==e&&t(s,l)&&(C="type-"+e)}),G.isEmpty(h)||(void 0!==h.title&&null!==h.title&&(S=h.title),void 0!==h.alt&&null!==h.alt&&(x=S=h.alt)),a={previewId:a,caption:v,title:S,alt:x,frameClass:r,type:g._getFileType(l),fileindex:p,fileid:c||"",filename:b,typeCss:C,footer:k,data:i&&n?g.zoomPlaceholder+"{zoomData}":t,template:d||o,style:y?'style="'+y+'"':"",zoomData:n?encodeURIComponent(n):""},i&&(a.zoomCache="",a.zoomData="{zoomData}"),e.setTokens(a)},p=p||f.slice(f.lastIndexOf("-")+1),_=g.fileActionSettings.showRotate&&-1!==N.inArray(r,g.rotatableFileExtensions),g.fileActionSettings.showZoom&&(m="kv-zoom-thumb",_&&(m+=" rotatable"+(t?" hide-rotate":"")),w=n(t?"other":o,e,!0,m,a)),w="\n"+g._getLayoutTemplate("zoomCache").replace("{zoomContent}",w),"function"==typeof g.sanitizeZoomCache&&(w=g.sanitizeZoomCache(w)),m="kv-preview-thumb",_&&(m+=" rotatable"+(i||g.hideThumbnailContent||!!g.previewFileIconSettings[r]?" hide-rotate":"")),n(i?"other":o,e,!1,m,a).setTokens({zoomCache:w})},_addToPreview:function(e,t){return t=G.cspBuffer.stash(t),t=this.reversePreviewOrder?e.prepend(t):e.append(t),G.cspBuffer.apply(e),t},_previewDefault:function(e,t){var i,r,n,a,o,s,l,f=this,c=f.$preview;f.showPreview&&(i=G.getFileName(e),r=e?e.type:"",n=e.size||0,a=f._getFileName(e,""),o=!0===t&&!f.isAjaxUpload,s=G.createObjectURL(e),e=f.fileManager.getId(e),l=f._getThumbId(e),f._clearDefaultPreview(),s=f._generatePreviewTemplate("other",s,i,r,l,e,o,n),f._addToPreview(c,s),f._setThumbAttr(l,a,n),!0===t)&&f.isAjaxUpload&&f._setThumbStatus(f._getFrame(l),"Error")},_previewFile:function(e,t,i,r,n){var a,o,s,l,f,c,u,p;this.showPreview&&(a=this,p=G.getFileName(t),o=n.type,s=n.name,u=a._parseFileType(o,p),l=a.$preview,f=t.size||0,i="image"===u?i.target.result:r,r=a.fileManager.getId(t),c=a._getThumbId(r),u=a._generatePreviewTemplate(u,i,p,o,c,r,!1,f,n.filename),a._clearDefaultPreview(),a._addToPreview(l,u),p=a._getFrame(c),a._validateImageOrientation(p.find("img"),t,c,r,s,o,f,i),a._setThumbAttr(c,s,f),a._initSortable())},_setThumbAttr:function(e,t,i,r){e=this._getFrame(e);e.length&&(i=i&&0<i?this._getSize(i):"",e.data({caption:t,size:i,description:r||""}))},_setInitThumbAttr:function(){var e,t,i,r,n=this.previewCache.data,a=this.previewCache.count(!0);if(0!==a)for(var o=0;o<a;o++)i=n.config[o],r=this.previewInitId+"-"+G.INIT_FLAG+o,e=G.ifSet("caption",i,G.ifSet("filename",i)),t=G.ifSet("size",i),i=G.ifSet("description",i),this._setThumbAttr(r,e,t,i)},_slugDefault:function(e){return G.isEmpty(e,!0)?"":String(e).replace(/[\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_updateFileDetails:function(e){var t=this,i=t.$element,i=G.isIE(9)&&G.findFileName(i.val())||i[0].files[0]&&i[0].files[0].name,i=!i&&0<t.fileManager.count()?t.fileManager.getFirstFile().nameFmt:i?t.slug(i):"_",r=t.isAjaxUpload?t.fileManager.count():e,n=t.previewCache.count(!0)+r,r=1===r?i:t._getMsgSelected(n,!t.isAjaxUpload&&!t.isError);t.isError?(t.$previewContainer.removeClass("file-thumb-loading"),t._initCapStatus(),t.$previewStatus.html(""),t.$captionContainer.removeClass("icon-visible")):t._showFileIcon(),t._setCaption(r,t.isError),t.$container.removeClass("file-input-new file-input-ajax-new"),t._raise("fileselect",[e,i]),t.previewCache.count(!0)&&t._initPreviewActions()},_setThumbStatus:function(e,t){var i,r,n,a,o;this.showPreview&&(r=(i="indicator"+t)+"Title",n="file-preview-"+t.toLowerCase(),a=e.find(".file-upload-indicator"),o=this.fileActionSettings,e.removeClass("file-preview-success file-preview-error file-preview-paused file-preview-loading"),"Success"===t&&e.find(".file-drag-handle").remove(),G.setHtml(a,o[i]),a.attr("title",o[r]),e.addClass(n),"Error"!==t||this.retryErrorUploads||e.find(".kv-file-upload").attr("disabled",!0))},_setProgressCancelled:function(){this._setProgress(101,this.$progress,this.msgCancelled)},_setProgress:function(e,t,i,r){var n,a,o,s=this;(t=t||s.$progress).length&&(n=Math.min(e,100),a=s.progressUploadThreshold,o=e<=100?s.progressTemplate:s.progressCompleteTemplate,o=n<100?s.progressTemplate:i?s.paused?s.progressPauseTemplate:s.progressErrorTemplate:o,100<=e&&(r=""),G.isEmpty(o)||(a=(a=a&&a<n&&e<=100?o.setTokens({percent:a,status:s.msgUploadThreshold}):o.setTokens({percent:n,status:100<e?s.msgUploadEnd:n+"%"})).setTokens({stats:r=r||""}),G.setHtml(t,a),i&&G.setHtml(t.find('[role="progressbar"]'),i)))},_hasFiles:function(){var e=this.$element[0];return!!(e&&e.files&&e.files.length)},_setFileDropZoneTitle:function(){var e,t=this,i=t.$container.find(".file-drop-zone"),r=t.dropZoneTitle;t.isClickable&&(e=G.isEmpty(t.$element.attr("multiple"))?t.fileSingle:t.filePlural,r+=t.dropZoneClickTitle.replace("{files}",e)),i.find("."+t.dropZoneTitleClass).remove(),!t.showPreview||0===i.length||0<t.fileManager.count()||!t.dropZoneEnabled||0<t.previewCache.count()||!t.isAjaxUpload&&t._hasFiles()||(0===i.find(G.FRAMES).length&&G.isEmpty(t.defaultPreviewContent)&&i.prepend('<div class="'+t.dropZoneTitleClass+'">'+r+"</div>"),t.$container.removeClass("file-input-new"),G.addCss(t.$container,"file-input-ajax-new"))},_getStats:function(e){var t,i;return this.showUploadStats&&e&&e.bitrate?(i=this._getLayoutTemplate("stats"),t=e.elapsed&&e.bps?this.msgPendingTime.setTokens({time:G.getElapsed(Math.ceil(e.pendingBytes/e.bps))}):this.msgCalculatingTime,i.setTokens({uploadSpeed:e.bitrate,pendingTime:t})):""},_setResumableProgress:function(e,t,i){var r=this.resumableManager,r=i?r:this,i=i?i.find(".file-thumb-progress"):null;0===r.lastProgress&&(r.lastProgress=e),e<r.lastProgress&&(e=r.lastProgress),this._setProgress(e,i,null,this._getStats(t)),r.lastProgress=e},_toggleResumableProgress:function(e,t){var i=this.$progress;i&&i.length&&G.setHtml(i,e.setTokens({percent:101,status:t,stats:""}))},_setFileUploadStats:function(e,t,i){var r,n,a,o,s,l,f,c,u,p=this,d=p.$progress;(p.showPreview||d&&d.length)&&(r=p.fileManager,c=p.resumableManager,n=r.getThumb(e),a=0,o=r.getTotalSize(),s=N.extend(!0,{},i),p.enableResumableUpload?(l=i.loaded,f=c.getUploadedSize(),c=c.file.size,u=r.uploadedSize+(l+=f),t=G.round(100*l/c),i.pendingBytes=c-f,p._setResumableProgress(t,i,n),l=Math.floor(100*u/o),s.pendingBytes=o-u,p._setResumableProgress(l,s)):(r.setProgress(e,t),d=n&&n.length?n.find(".file-thumb-progress"):null,p._setProgress(t,d,null,p._getStats(i)),N.each(r.stats,function(e,t){a+=t.loaded}),s.pendingBytes=o-a,l=G.round(a/o*100),p._setProgress(l,null,null,p._getStats(s))))},_validateMinCount:function(){var e=this,t=e.isAjaxUpload?e.fileManager.count():e._inputFileCount();return!(e.validateInitialCount&&0<e.minFileCount&&e._getFileCount(t-1)<e.minFileCount&&(e._noFilesError({}),1))},_getFileCount:function(e,t){return(t=void 0===t?this.validateInitialCount&&!this.overwriteInitial:t)&&(e+=this.previewCache.count(!0)),e},_getFileId:function(e){return G.getFileId(e,this.generateFileId)},_getFileName:function(e,t){e=G.getFileName(e);return e?this.slug(e):t},_getFileNames:function(t){return this.filenames.filter(function(e){return t?void 0!==e:null!=e})},_setPreviewError:function(e,t){var i=this,r=i.removeFromPreviewOnError&&!i.retryErrorUploads;t&&!r||i.fileManager.remove(e),i.showPreview&&(r?e.remove():(i._setThumbStatus(e,"Error"),i._refreshUploadButton(e)))},_refreshUploadButton:function(e){var e=e.find(".kv-file-upload"),t=this.fileActionSettings,i=t.uploadIcon,r=t.uploadTitle;e.length&&(this.retryErrorUploads&&(i=t.uploadRetryIcon,r=t.uploadRetryTitle),e.attr("title",r),G.setHtml(e,i))},_isValidSize:function(e,t,i,r,n,a){var o=this,s=o[("Small"===e?"min":"max")+"Image"+t];return!(!G.isEmpty(s)&&i.length)||(i=i[0],i="Width"===t?i.naturalWidth||i.width:i.naturalHeight||i.height,"Small"===e?s<=i:i<=s)||(t=o["msgImage"+t+e]||'Image "{name}" has a size validation error (limit "{size}").',o._showFileError(t.setTokens({name:n,size:s,dimension:i}),a),o._setPreviewError(r),o.fileManager.remove(r),o._clearFileInput(),!1)},_getExifObj:function(e){var t,i=G.logMessages.exifWarning;if("data:image/jpeg;base64,"===e.slice(0,23)||"data:image/jpg;base64,"===e.slice(0,22)){try{t=window.piexif?window.piexif.load(e):null}catch(e){t=null,i=e&&e.message||""}return!t&&this.showExifErrorLog&&this._log(G.logMessages.badExifParser,{details:i}),t}},setImageOrientation:function(o,s,l,f){var c,u,p=this,e=!o||!o.length,t=!s||!s.length,d=!1,h=e&&f&&"image"===f.attr("data-template");e&&t||(e="load.fileinputimageorient",h?(o=s,s=null,o.css(p.previewSettings.image),u=N(document.createElement("div")).appendTo(f.find(".kv-file-content")),c=N(document.createElement("span")).insertBefore(o),o.css("visibility","hidden").removeClass("file-zoom-detail").appendTo(u)):d=!o.is(":visible"),o.off(e).on(e,function(){d&&(p.$preview.removeClass("hide-content"),f.find(".kv-file-content").css("visibility","hidden"));var e,t=o[0],i=s&&s.length?s[0]:null,r=t.offsetHeight,n=t.offsetWidth,a=G.getRotation(l);d&&(f.find(".kv-file-content").css("visibility","visible"),p.$preview.addClass("hide-content")),o.data("orientation",l),i&&s.data("orientation",l),l<5?(G.setTransform(t,a),G.setTransform(i,a)):(e=Math.atan(n/r),r=(n=Math.sqrt(Math.pow(r,2)+Math.pow(n,2)))?r/Math.cos(Math.PI/2+e)/n:1,e=" scale("+Math.abs(r)+")",G.setTransform(t,a+e),G.setTransform(i,a+e),h&&(o.css("visibility","visible").insertAfter(c).addClass("file-zoom-detail"),c.remove(),u.remove()))}))},_validateImageOrientation:function(e,t,i,r,n,a,o,s){var l,f=this,c=f.autoOrientImage,u=f._getExifObj(s);f.canOrientImage?e.css("image-orientation",c?"from-image":"none"):(c=G.getZoomSelector(i," img"),(l=u?u["0th"][piexif.ImageIFD.Orientation]:null)&&(f.setImageOrientation(e,N(c),l,f._getFrame(i)),f._raise("fileimageoriented",{$img:e,file:t}))),f._validateImage(i,r,n,a,o,s,u)},_validateImage:function(i,r,n,a,o,s,l){var f,e,c=this,t=c.$preview,u=c._getFrame(i),p=u.attr("data-fileindex"),d=u.find("img");n=n||"Untitled",d.one("load",function(){d.data("validated")||(d.data("validated",!0),e=u.width(),t.width()<e&&d.css("width","100%"),f={ind:p,id:i,fileId:r},setTimeout(function(){var e=c._isValidSize("Small","Width",d,u,n,f),t=c._isValidSize("Small","Height",d,u,n,f);c.resizeImage||(e=e&&c._isValidSize("Large","Width",d,u,n,f),t=t&&c._isValidSize("Large","Height",d,u,n,f)),c._raise("fileimageloaded",[i]),u.data("exif",l),e&&t&&(c.fileManager.addImage(r,{ind:p,img:d,thumb:u,pid:i,typ:a,siz:o,validated:!1,imgData:s,exifObj:l}),c._validateAllImages())},c.processDelay))}).one("error",function(){c._raise("fileimageloaderror",[i])})},_validateAllImages:function(){var i,r=this,n={val:0},a=r.fileManager.getImageCount(),o=r.resizeIfSizeMoreThan;a===r.fileManager.totalImages&&(r._raise("fileimagesloaded"),r.resizeImage)&&N.each(r.fileManager.loadedImages,function(e,t){t.validated||((i=t.siz)&&i>o*r.bytesToKB&&r._getResizedImage(e,t,n,a),t.validated=!0)})},_getResizedImage:function(e,t,i,r){var n,a,o,s=this,l=N(t.img)[0],f=l.naturalWidth,c=l.naturalHeight,u=s.maxImageWidth||f,p=s.maxImageHeight||c,d=!(!f||!c),h=s.imageCanvas,m=s.imageCanvasContext,g=t.typ,v=t.pid,w=t.ind,y=t.thumb,t=t.exifObj,b=function(e,t,i){s.isAjaxUpload?s._showFileError(e,t,i):s._showError(e,t,i),s._setPreviewError(y)},_=s.fileManager.getFile(e),S={id:v,index:w,fileId:e},v=[e,v,w];if(_&&d&&!(f<=u&&c<=p)||(d&&_&&s._raise("fileimageresized",v),i.val++,i.val===r&&s._raise("fileimagesresized"),d)){g=g||s.resizeDefaultImageType,w=u<f,_=p<c,d="width"===s.resizePreference?w?u/f:_?p/c:1:_?p/c:w?u/f:1,s._resetCanvas(),c*=d,h.width=f*=d,h.height=c;try{m.drawImage(l,0,0,f,c),a=h.toDataURL(g,s.resizeQuality),t&&(o=window.piexif.dump(t),a=window.piexif.insert(o,a)),n=G.dataURI2Blob(a),s.fileManager.setFile(e,n),s._raise("fileimageresized",v),i.val++,i.val===r&&s._raise("fileimagesresized",[void 0,void 0]),n instanceof Blob||b(s.msgImageResizeError,S,"fileimageresizeerror")}catch(e){i.val++,i.val===r&&s._raise("fileimagesresized",[void 0,void 0]),b(s.msgImageResizeException.replace("{errors}",e.message),S,"fileimageresizeexception")}}else b(s.msgImageResizeError,S,"fileimageresizeerror")},_showProgress:function(){this.$progress&&this.$progress.length&&this.$progress.show()},_hideProgress:function(){this.$progress&&this.$progress.length&&this.$progress.hide()},_initBrowse:function(e){var t=this.$element;this.showBrowse?this.$btnFile=e.find(".btn-file").append(t):(t.appendTo(e).attr("tabindex",-1),G.addCss(t,"file-no-browse"))},_initClickable:function(){var t,e,i=this;i.isClickable&&(t=i.$dropZone,i.isAjaxUpload||(e=i.$preview.find(".file-default-preview")).length&&(t=e),G.addCss(t,"clickable"),t.attr("tabindex",-1),i._handler(t,"click",function(e){e=N(e.target);i.$errorContainer.is(":visible")||e.parents(".file-preview-thumbnails").length&&!e.parents(".file-default-preview").length||(i.$element.data("zoneClicked",!0).trigger("click"),t.blur())}))},_initCaption:function(){var e=this.initialCaption||"";return this.overwriteInitial||G.isEmpty(e)?(this.$caption.val(""),!1):(this._setCaption(e),!0)},_setCaption:function(e,t){var i,r,n,a=this;if(a.$caption.length){if(a.$captionContainer.removeClass("icon-visible"),t)i=N("<div>"+a.msgValidationError+"</div>").text(),n=(t=a.fileManager.count())?(n=a.fileManager.getFirstFile(),1===t&&n?n.nameFmt:a._getMsgSelected(t)):a._getMsgSelected(a.msgNo),n=G.isEmpty(e)?n:e,r='<span class="'+a.msgValidationErrorClass+'">'+a.msgValidationErrorIcon+"</span>";else{if(G.isEmpty(e))return void a.$caption.attr("title","");n=i=N("<div>"+e+"</div>").text(),r=a._getLayoutTemplate("fileIcon")}a.$captionContainer.addClass("icon-visible"),a.$caption.attr("title",i).val(n),G.setHtml(a.$captionIcon,r)}},_createContainer:function(){var e=this,t={class:"file-input file-input-new"+(e.rtl?" kv-rtl":"")},i=G.createElement(G.cspBuffer.stash(e._renderMain()));return G.cspBuffer.apply(i),i.insertBefore(e.$element).attr(t),e._initBrowse(i),e.theme&&i.addClass("theme-"+e.theme),i},_refreshContainer:function(){var e=this,t=e.$container;e.$element.insertAfter(t),G.setHtml(t,e._renderMain()),e._initBrowse(t),e._validateDisabled()},_validateDisabled:function(){this.$caption.attr({readonly:this.isDisabled})},_setTabIndex:function(e,t){e=this.tabIndexConfig[e];return t.setTokens({tabIndexConfig:null==e?"":'tabindex="'+e+'"'})},_renderMain:function(){var e=this,t=e.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",i=e.showClose?e._getLayoutTemplate("close"):"",t=e.showPreview?e._getLayoutTemplate("preview").setTokens({class:e.previewClass,dropClass:t}):"",r=e.isDisabled?e.captionClass+" file-caption-disabled":e.captionClass,r=e.captionTemplate.setTokens({class:r+" kv-fileinput-caption"}),r=e._setTabIndex("caption",r);return e.mainTemplate.setTokens({class:e.mainClass+(!e.showBrowse&&e.showCaption?" no-browse":""),inputGroupClass:e.inputGroupClass,preview:t,close:i,caption:r,upload:e._renderButton("upload"),remove:e._renderButton("remove"),cancel:e._renderButton("cancel"),pause:e._renderButton("pause"),browse:e._renderButton("browse")})},_renderButton:function(e){var t=this,i=t._getLayoutTemplate("btnDefault"),r=t[e+"Class"],n=t[e+"Title"],a=t[e+"Icon"],o=t[e+"Label"],s=t.isDisabled?" disabled":"",l="button";switch(e){case"remove":if(t.showRemove)break;return"";case"cancel":if(!t.showCancel)return"";r+=" kv-hidden";break;case"pause":if(!t.showPause)return"";r+=" kv-hidden";break;case"upload":if(!t.showUpload)return"";t.isAjaxUpload&&!t.isDisabled?i=t._getLayoutTemplate("btnLink").replace("{href}",t.uploadUrl):l="submit";break;case"browse":if(!t.showBrowse)return"";i=t._getLayoutTemplate("btnBrowse");break;default:return""}return i=t._setTabIndex(e,i),r+="browse"===e?" btn-file":" fileinput-"+e+" fileinput-"+e+"-button",G.isEmpty(o)||(o=' <span class="'+t.buttonLabelClass+'">'+o+"</span>"),i.setTokens({type:l,css:r,title:n,status:s,icon:a,label:o})},_renderThumbProgress:function(){return'<div class="file-thumb-progress kv-hidden">'+this.progressInfoTemplate.setTokens({percent:101,status:this.msgUploadBegin,stats:""})+"</div>"},_renderFileFooter:function(e,t,i,r,n){var a=this,o=a.fileActionSettings,s=o.showRemove,l=o.showDrag,f=o.showUpload,c=o.showRotate,u=o.showZoom,p=a._getLayoutTemplate("footer"),d=a._getLayoutTemplate("indicator"),h=n?o.indicatorError:o.indicatorNew,n=n?o.indicatorErrorTitle:o.indicatorNewTitle,o=d.setTokens({indicator:h,indicatorTitle:n}),d={type:e,caption:t,size:i=a._getSize(i),width:r,progress:"",indicator:o};return a.isAjaxUpload?(d.progress=a._renderThumbProgress(),d.actions=a._renderFileActions(d,f,!1,s,c,u,l,!1,!1,!1)):d.actions=a._renderFileActions(d,!1,!1,!1,!1,u,l,!1,!1,!1),h=p.setTokens(d),G.replaceTags(h,a.previewThumbTags)},_renderFileActions:function(e,t,i,r,n,a,o,s,l,f,c,u,p){var d,h,m,g,v,w,y,b,_,S=this;return!e.type&&c&&(e.type="image"),S.enableResumableUpload?t=!1:"function"==typeof t&&(t=t(e)),"function"==typeof i&&(i=i(e)),"function"==typeof r&&(r=r(e)),"function"==typeof a&&(a=a(e)),"function"==typeof o&&(o=o(e)),"function"==typeof n&&(n=n(e)),t||i||r||n||a||o?(e=!1===l?"":' data-url="'+l+'"',l=!1===f?"":' data-key="'+f+'"',w=v=g=m=h=d="",y=S._getLayoutTemplate("actions"),b=S.fileActionSettings,_=S.otherActionButtons.setTokens({dataKey:l,key:f}),s=s?b.removeClass+" disabled":b.removeClass,r&&(g=S._getLayoutTemplate("actionDelete").setTokens({removeClass:s,removeIcon:b.removeIcon,removeTitle:b.removeTitle,dataUrl:e,dataKey:l,key:f})),n&&(m=S._getLayoutTemplate("actionRotate").setTokens({rotateClass:b.rotateClass,rotateIcon:b.rotateIcon,rotateTitle:b.rotateTitle})),t&&(v=S._getLayoutTemplate("actionUpload").setTokens({uploadClass:b.uploadClass,uploadIcon:b.uploadIcon,uploadTitle:b.uploadTitle})),i&&(w=(w=S._getLayoutTemplate("actionDownload").setTokens({downloadClass:b.downloadClass,downloadIcon:b.downloadIcon,downloadTitle:b.downloadTitle,downloadUrl:u||S.initialPreviewDownloadUrl})).setTokens({filename:p,key:f})),a&&(d=S._getLayoutTemplate("actionZoom").setTokens({zoomClass:b.zoomClass,zoomIcon:b.zoomIcon,zoomTitle:b.zoomTitle})),o&&c&&(r="drag-handle-init "+b.dragClass,h=S._getLayoutTemplate("actionDrag").setTokens({dragClass:r,dragTitle:b.dragTitle,dragIcon:b.dragIcon})),y.setTokens({delete:g,upload:v,download:w,rotate:m,zoom:d,drag:h,other:_})):""},_browse:function(e){var t=this;e&&e.isDefaultPrevented()||!t._raise("filebrowse")||(t.isError&&!t.isAjaxUpload&&t.clear(),t.focusCaptionOnBrowse&&t.$captionContainer.focus())},_change:function(e){var a=this;if(N(document.body).off("focusin.fileinput focusout.fileinput"),a.changeTriggered)a._toggleLoading("hide");else{a._toggleLoading("show");var t,i,r,n=a.$element,o=a.isAjaxUpload,s=1<arguments.length?arguments[1]:n[0].files,l=a.fileManager.count(),n=G.isEmpty(n.attr("multiple")),f=!o&&n?1:a.maxFileCount,c=a.maxTotalFileCount,u=0<c&&f<c,n=n&&0<l,p=function(e,t,i,r){var n=N.extend(!0,{},a._getOutData(null,{},{},s),{id:i,index:r}),i={id:i,index:r,file:t,files:s};return a.isPersistentError=!0,a._toggleLoading("hide"),o?a._showFileError(e,n):a._showError(e,i)},d=function(e,t,i){i=(i=i?a.msgTotalFilesTooMany:a.msgFilesTooMany).replace("{m}",t).replace("{n}",e);a.isError=p(i,null,null,null),a.$captionContainer.removeClass("icon-visible"),a._setCaption("",!0),a.$container.removeClass("file-input-new file-input-ajax-new")};if(a.reader=null,a._resetUpload(),a._hideFileIcon(),a.dropZoneEnabled&&a.$container.find(".file-drop-zone ."+a.dropZoneTitleClass).remove(),e=s=o?s:e.target&&void 0===e.target.files?e.target.value?[{name:e.target.value.replace(/^.+\\/,"")}]:[]:e.target.files||{},G.isEmpty(e)||0===e.length)o||a.clear(),a._raise("fileselectnone");else{if(a._resetErrors(),r=e.length,i=o?a.fileManager.count()+r:r,t=a._getFileCount(i,!u&&void 0),0<f&&f<t){if(!a.autoReplace||f<r)return void d(a.autoReplace&&f<r?r:t,f);f<t&&a._resetPreviewThumbs(o)}else{if(u&&(t=a._getFileCount(i,!0),0<c)&&c<t){if(!a.autoReplace||f<r)return void d(a.autoReplace&&c<r?r:t,c,!0);f<t&&a._resetPreviewThumbs(o)}!o||n?(a._resetPreviewThumbs(!1),n&&a.clearFileStack()):!o||0!==l||a.previewCache.count(!0)&&!a.overwriteInitial||a._resetPreviewThumbs(!0)}a.autoReplace&&a._getThumbs().each(function(){var e=N(this);(e.hasClass("file-preview-success")||e.hasClass("file-preview-error"))&&e.remove()}),a.readFiles(e),a._toggleLoading("hide")}}},_abort:function(e){var t=this;return t.ajaxAborted&&"object"==typeof t.ajaxAborted&&void 0!==t.ajaxAborted.message?((e=N.extend(!0,{},t._getOutData(null),e)).abortData=t.ajaxAborted.data||{},e.abortMessage=t.ajaxAborted.message,t._setProgress(101,t.$progress,t.msgCancelled),t._showFileError(t.ajaxAborted.message,e,"filecustomerror"),t.cancel(),t.unlock(),!0):!!t.ajaxAborted},_resetFileStack:function(){var r=this,n=0;r._getThumbs().each(function(){var e=N(this),t=e.attr("data-fileindex"),i=e.attr("id");"-1"!==t&&-1!==t&&(r._getThumbFile(e)?e.attr({"data-fileindex":"-1"}):(e.attr({"data-fileindex":n}),n++),r._getZoom(i).attr({"data-fileindex":e.attr("data-fileindex")}))})},_isFileSelectionValid:function(e){var t=this;return e=e||0,t.required&&!t.getFilesCount()?(t.$errorContainer.html(""),t._showFileError(t.msgFileRequired),!1):!(0<t.minFileCount&&t._getFileCount(e)<t.minFileCount&&(t._noFilesError({}),1))},_canPreview:function(e){var t,i,r,n,a,o,s,l,f,c,u,p=this;return!(!(e&&p.showPreview&&p.$preview&&p.$preview.length)||(t=e.name||"",i=e.type||"",e=(e.size||0)/p.bytesToKB,r=p._parseFileType(i,t),f=p.allowedPreviewTypes,c=p.allowedPreviewMimeTypes,u=p.allowedPreviewExtensions||[],n=p.disabledPreviewTypes,a=p.disabledPreviewMimeTypes,o=p.disabledPreviewExtensions||[],p=p.maxFilePreviewSize&&parseFloat(p.maxFilePreviewSize)||0,s=new RegExp("\\.("+u.join("|")+")$","i"),l=new RegExp("\\.("+o.join("|")+")$","i"),f=!f||-1!==f.indexOf(r),c=!c||-1!==c.indexOf(i),u=!u.length||G.compare(t,s),n&&-1!==n.indexOf(r))||a&&-1!==a.indexOf(i)||o.length&&G.compare(t,l)||p&&!isNaN(p)&&p<e)&&(f||c||u)},addToStack:function(e,t){this.stackIsUpdating=!0,this.fileManager.add(e,t),this._refreshPreview(),this.stackIsUpdating=!1},clearFileStack:function(){var e=this;return e.fileManager.clear(),e._initResumableUpload(),e.enableResumableUpload?(null===e.showPause&&(e.showPause=!0),null===e.showCancel&&(e.showCancel=!1)):(e.showPause=!1,null===e.showCancel&&(e.showCancel=!0)),e.$element},getFileStack:function(){return this.fileManager.stack},getFileList:function(){return this.fileManager.list()},getFilesSize:function(){return this.fileManager.getTotalSize()},getFilesCount:function(e){var t=this,i=t.isAjaxUpload?t.fileManager.count():t._inputFileCount();return e&&(i+=t.previewCache.count(!0)),t._getFileCount(i)},_initCapStatus:function(e){var t=this.$caption;t.removeClass("is-valid file-processing"),e&&("processing"===e?t.addClass("file-processing"):t.addClass("is-valid"))},_toggleLoading:function(e){var t=this;t.$previewStatus.html("hide"===e?"":t.msgProcessing),t.$container.removeClass("file-thumb-loading"),t._initCapStatus("hide"===e?"":"processing"),"hide"!==e&&(t.dropZoneEnabled&&t.$container.find(".file-drop-zone ."+t.dropZoneTitleClass).remove(),t.$container.addClass("file-thumb-loading"))},_initFileSelected:function(){var e=this,t=e.$element,i=N(document.body),r="focusin.fileinput focusout.fileinput";i.length?i.off(r).on("focusout.fileinput",function(){e._toggleLoading("show")}).on("focusin.fileinput",function(){setTimeout(function(){t.val()||e._setFileDropZoneTitle(),i.off(r),e._toggleLoading("hide")},2500)}):e._toggleLoading("hide")},readFiles:function(T){this.reader=new FileReader;var E,P=this,I=P.reader,A=P.$previewContainer,F=P.$previewStatus,B=P.msgLoading,R=P.msgProgress,D=P.previewInitId,U=T.length,L=P.fileTypeSettings,M=P.allowedFileTypes,z=M?M.length:0,j=P.allowedFileExtensions,O=G.isEmpty(j)?"":j.join(", "),$=function(e,t,i,r,n){var a=N.extend(!0,{},P._getOutData(null,{},{},T),{id:i,index:r,fileId:n}),n={id:i,index:r,fileId:n,file:t,files:T};P._previewDefault(t,!0),t=P._getFrame(i,!0),P._toggleLoading("hide"),P.isAjaxUpload?setTimeout(function(){E(r+1)},P.processDelay):(P.unlock(),U=0),(P.removeFromPreviewOnError&&t.length?t:(P._initFileActions(),t.find(".kv-file-upload"))).remove(),P.isPersistentError=!0,P.isError=P.isAjaxUpload?P._showFileError(e,a):P._showError(e,n),P._updateFileDetails(U)};P.fileManager.clearImages(),N.each(T,function(e,t){var i=P.fileTypeSettings.image;i&&i(t.type)&&P.fileManager.totalImages++}),(E=function(f){var e=P.$errorContainer,i=P.fileManager;if(U<=f)P.unlock(),P.duplicateErrors.length&&(g="<li>"+P.duplicateErrors.join("</li><li>")+"</li>",0===e.find("ul").length?G.setHtml(e,P.errorCloseButton+"<ul>"+g+"</ul>"):e.find("ul").append(g),e.fadeIn(P.fadeDelay),P._handler(e.find(".kv-error-close"),"click",function(){e.fadeOut(P.fadeDelay)}),P.duplicateErrors=[]),P.isAjaxUpload?(P._raise("filebatchselected",[i.stack]),0!==i.count()||P.isError||P.reset()):P._raise("filebatchselected",[T]),A.removeClass("file-thumb-loading"),P._initCapStatus("valid"),F.html("");else{P.lock(!0);var r,n,c,u,t,p,d,a,o,s,l,h,m=T[f],g=m&&m.size||0,v=P._getSize(g,!0),w=L.image,g=g/P.bytesToKB,y="",b=0,_="",S=!1,x=0,C=function(e){e=e||m,r=a=P._getFileId(m),n=D+"-"+r,d=G.createObjectURL(e),p=P._getFileName(m,"")},k=function(){var e=!!i.loadedImages[r],t=R.setTokens({index:f+1,files:U,percent:50,name:p});setTimeout(function(){F.html(t),P._updateFileDetails(U),0<P.getFilesCount(!0)&&P.getFrames(":visible")&&P.$dropZone.find("."+P.dropZoneTitleClass).remove(),E(f+1)},P.processDelay),P._raise("fileloaded",[m,n,r,f,I])&&P.isAjaxUpload?e||i.add(m):e&&i.removeFile(r)};if(m){if(C(),0<z)for(u=0;u<z;u++)t=M[u],t=P.msgFileTypes[t]||t,_+=0===u?t:", "+t;if(!1===p)E(f+1);else if(0===p.length)h=P.msgInvalidFileName.replace("{name}",G.htmlEncode(G.getFileName(m),"[unknown]")),$(h,m,n,f,a);else if(G.isEmpty(j)||(y=new RegExp("\\.("+j.join("|")+")$","i")),P.isAjaxUpload&&i.exists(a)||P._getFrame(n,!0).length)l={id:n,index:f,fileId:a,file:m,files:T},h=P.msgDuplicateFile.setTokens({name:p,size:v}),P.isAjaxUpload?(P.stackIsUpdating||(P.duplicateErrors.push(h),P.isDuplicateError=!0,P._raise("fileduplicateerror",[m,a,p,v,n,f])),E(f+1)):(P._showError(h,l),P.unlock(),U=0,P._clearFileInput(),P.reset()),P._updateFileDetails(U);else if(0<P.maxFileSize&&g>P.maxFileSize)h=P.msgSizeTooLarge.setTokens({name:p,size:v,maxSize:P._getSize(P.maxFileSize*P.bytesToKB,!0)}),$(h,m,n,f,a);else if(null!==P.minFileSize&&g<=G.getNum(P.minFileSize))h=P.msgSizeTooSmall.setTokens({name:p,size:v,minSize:P._getSize(P.minFileSize*P.bytesToKB,!0)}),$(h,m,n,f,a);else{if(!G.isEmpty(M)&&G.isArray(M)){for(u=0;u<M.length;u+=1)s=M[u],b+=(s=L[s])&&"function"==typeof s&&s(m.type,G.getFileName(m))?1:0;if(0===b)return h=P.msgInvalidFileType.setTokens({name:p,types:_}),void $(h,m,n,f,a)}0!==b||G.isEmpty(j)||!G.isArray(j)||G.isEmpty(y)||(l=G.compare(p,y),0!==(b+=G.isEmpty(l)?0:l.length))?P._canPreview(m)?(w(m.type,p),F.html(B.replace("{index}",f+1).replace("{files}",U)),A.addClass("file-thumb-loading"),P._initCapStatus("processing"),I.onerror=function(e){P._errorHandler(e,p)},I.onload=function(r){function t(e,t){if(G.isEmpty(e)&&(a=G.arrayBuffer2String(I.result),e=G.isSvg(a)?"image/svg+xml":G.getMimeType(n,a,m.type)),l={name:p,type:e||""},t&&"undefined"!=typeof File)try{var i=l.filename=p+"."+t;c=new File([m],i,{type:l.type}),C(c)}catch(e){}if(!w(e,""))return P.isAjaxUpload&&!P._raise("filebeforeload",[m,f,I])?(S=!0,P._resetCaption(),I.abort(),F.html(""),A.removeClass("file-thumb-loading"),P._initCapStatus("valid"),P.enable()):(P._previewFile(f,m,r,d,l),P._initFileActions(),k());(t=new FileReader).onerror=function(e){P._errorHandler(e,p)},t.onload=function(e){return P.isAjaxUpload&&!P._raise("filebeforeload",[m,f,I])?(S=!0,P._resetCaption(),I.abort(),F.html(""),A.removeClass("file-thumb-loading"),P._initCapStatus("valid"),void P.enable()):(P._previewFile(f,m,e,d,l),P._initFileActions(),void k())},t.readAsDataURL(m)}var n,e,i,a,o=[],s=m.type,l={name:p,type:s};if(N.each(L,function(e,t){"object"!==e&&"other"!==e&&"function"==typeof t&&t(s,p)&&x++}),void 0!==FileTypeParser)e=new Uint8Array(r.target.result),(new FileTypeParser).parse(e).then(function(e){t(e&&e.mime||s,e&&e.ext||"")});else{if(0===x){for(e=new Uint8Array(r.target.result),u=0;u<e.length;u++)i=e[u].toString(16),o.push(i);n=o.join("").toLowerCase().substring(0,8),s=G.getMimeType(n,"","")}t(s)}},I.onprogress=function(e){e.lengthComputable&&(e=e.loaded/e.total*100,e=Math.ceil(e),h=R.setTokens({index:f+1,files:U,percent:e,name:p}),setTimeout(function(){S||F.html(h)},P.processDelay))},I.readAsArrayBuffer(m)):(o=P._raise("filebeforeload",[m,f,I]),P.isAjaxUpload&&o&&i.add(m),P.showPreview&&o&&(A.addClass("file-thumb-loading"),P._initCapStatus("processing"),P._previewDefault(m),P._initFileActions()),setTimeout(function(){o&&P._updateFileDetails(U),E(f+1),P._raise("fileloaded",[m,n,r,f])},10)):(h=P.msgInvalidFileExtension.setTokens({name:p,extensions:O}),$(h,m,n,f,a))}}}})(0),P._updateFileDetails(U)},lock:function(e){var t=this,i=t.$container;return t._resetErrors(),t.disable(),!e&&t.showCancel&&i.find(".fileinput-cancel").show(),!e&&t.showPause&&i.find(".fileinput-pause").show(),t._initCapStatus("processing"),t._raise("filelock",[t.fileManager.stack,t._getExtraData()]),t.$element},unlock:function(e){var t=this,i=t.$container;return void 0===e&&(e=!0),t.enable(),i.removeClass("is-locked"),t.showCancel&&i.find(".fileinput-cancel").hide(),t.showPause&&i.find(".fileinput-pause").hide(),e&&t._resetFileStack(),t._initCapStatus(),t._raise("fileunlock",[t.fileManager.stack,t._getExtraData()]),t.$element},resume:function(){var e=this,t=e.fileManager,i=!1,r=e.resumableManager;return t.bpsLog=[],t.bps=0,e.enableResumableUpload&&(e.paused?e._toggleResumableProgress(e.progressPauseTemplate,e.msgUploadResume):i=!0,e.paused=!1,i&&e._toggleResumableProgress(e.progressInfoTemplate,e.msgUploadBegin),setTimeout(function(){r.upload()},e.processDelay)),e.$element},paste:function(e){var t=e.originalEvent,t=t.clipboardData&&t.clipboardData.files||null;return t&&this._dropFiles(e,t),this.$element},pause:function(){var e,r=this,t=r.resumableManager,i=r.ajaxRequests,n=i.length,a=t.getProgress(),o=r.fileActionSettings,s=r.taskManager.getPool(t.id);if(r.enableResumableUpload){if(s&&s.cancel(),r._raise("fileuploadpaused",[r.fileManager,t]),0<n)for(e=0;e<n;e+=1)r.paused=!0,i[e].abort();r.showPreview&&r._getThumbs().each(function(){var e=N(this),t=r._getLayoutTemplate("stats"),i=e.find(".file-upload-indicator");e.removeClass("file-uploading"),i.attr("title")===o.indicatorLoadingTitle&&(r._setThumbStatus(e,"Paused"),i=t.setTokens({pendingTime:r.msgPaused,uploadSpeed:""}),r.paused=!0,r._setProgress(a,e.find(".file-thumb-progress"),a+"%",i)),r._getThumbFile(e)||e.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")}),r._setProgress(101,r.$progress,r.msgPaused)}return r.$element},cancel:function(){var e,i=this,t=i.ajaxRequests,r=i.resumableManager,n=i.taskManager,n=r?n.getPool(r.id):void 0,a=t.length;if(i.enableResumableUpload&&n?(n.cancel().done(function(){i._setProgressCancelled()}),r.reset(),i._raise("fileuploadcancelled",[i.fileManager,r])):(i.ajaxPool&&i.ajaxPool.cancel(),i._raise("fileuploadcancelled",[i.fileManager])),i._initAjax(),0<a)for(e=0;e<a;e+=1)i.cancelling=!0,t[e].abort();return i._getThumbs().each(function(){var e=N(this),t=e.find(".file-thumb-progress");e.removeClass("file-uploading"),i._setProgress(0,t),t.hide(),i._getThumbFile(e)||(e.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),e.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),i.unlock()}),setTimeout(function(){i._setProgressCancelled()},i.processDelay),i.$element},clear:function(){var e,t=this;if(t._raise("fileclear"))return t.clearInput=!0,t.$btnUpload.removeAttr("disabled"),t._getThumbs().find("video,audio,img").each(function(){G.cleanMemory(N(this))}),t._clearFileInput(),t._resetUpload(),t.clearFileStack(),t.isDuplicateError=!1,t.isPersistentError=!1,t._resetErrors(!0),t._hasInitialPreview()?(t._showFileIcon(),t._resetPreview(),t._initPreviewActions(),t.$container.removeClass("file-input-new")):(t._getThumbs().each(function(){t._clearObjects(N(this))}),t.isAjaxUpload&&(t.previewCache.data={}),t.$preview.html(""),e=!t.overwriteInitial&&0<t.initialCaption.length?t.initialCaption:"",t.$caption.attr("title","").val(e),G.addCss(t.$container,"file-input-new"),t._validateDefaultPreview()),0!==t.$container.find(G.FRAMES).length||t._initCaption()||t.$captionContainer.removeClass("icon-visible"),t._hideFileIcon(),t.focusCaptionOnClear&&t.$captionContainer.focus(),t._setFileDropZoneTitle(),t._raise("filecleared"),t.$element},reset:function(){var e=this;if(e._raise("filereset"))return e.lastProgress=0,e._resetPreview(),e.$container.find(".fileinput-filename").text(""),G.addCss(e.$container,"file-input-new"),e.getFrames().length&&e.$container.removeClass("file-input-new"),e.clearFileStack(),e._setFileDropZoneTitle(),e.$element},disable:function(){var e=this,t=e.$container;return e.isDisabled=!0,e._raise("filedisabled"),e.$element.attr("disabled","disabled"),t.addClass("is-locked"),G.addCss(t.find(".btn-file"),"disabled"),t.find(".kv-fileinput-caption").addClass("file-caption-disabled"),t.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),e._initDragDrop(),e.$element},enable:function(){var e=this,t=e.$container;return e.isDisabled=!1,e._raise("fileenabled"),e.$element.removeAttr("disabled"),t.removeClass("is-locked"),t.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),t.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),t.find(".btn-file").removeClass("disabled"),e._initDragDrop(),e.$element},upload:function(){var i,e,r=this,t=r.fileManager,n=t.count(),a=r.taskManager,o=!N.isEmptyObject(r._getExtraData());if(t.bpsLog=[],t.bps=0,r.isAjaxUpload&&!r.isDisabled&&r._isFileSelectionValid(n))if(r.lastProgress=0,r._resetUpload(),0!==n||o)if(r.cancelling=!1,r.uploadInitiated=!0,r._showProgress(),r.lock(),0===n&&o)r._setProgress(2),r._uploadExtraOnly();else{if(r.enableResumableUpload)return r.resume();if(r.uploadAsync||r.enableResumableUpload){if(n=r._getOutData(null),!r._checkBatchPreupload(n))return;r.fileBatchCompleted=!1,r.uploadCache=[],N.each(r.getFileStack(),function(e){e=r._getThumbId(e);r.uploadCache.push({id:e,content:null,config:null,tags:null,append:!0})}),r.$preview.find(".file-preview-initial").removeClass(G.SORT_CSS),r._initSortable()}if(r._setProgress(2),r.hasInitData=!1,!r.uploadAsync)return r._uploadBatch(),r.$element;i=0,e=r.ajaxPool=a.addPool(G.uniqId()),N.each(r.getFileStack(),function(t){e.addTask(t+i,function(e){r._uploadSingle(i,t,!0,e)}),i++}),e.run(r.maxAjaxThreads).done(function(){r._log("Async upload batch completed successfully."),r._raise("filebatchuploadsuccess",[t.stack,r._getExtraData()])}).fail(function(){r._log("Async upload batch completed with errors."),r._raise("filebatchuploaderror",[t.stack,r._getExtraData()])})}else r._showFileError(r.msgUploadEmpty)},destroy:function(){var e=this,t=e.$form,i=e.$container,r=e.$element,n=e.namespace;return N(document).off(n),N(window).off(n),t&&t.length&&t.off(n),e.isAjaxUpload&&e._clearFileInput(),e._cleanup(),e._initPreviewCache(),r.insertBefore(i).off(n).removeData(),i.off().remove(),r},refresh:function(e){var t=this,i=t.$element;return e="object"!=typeof e||G.isEmpty(e)?t.options:N.extend(!0,{},t.options,e),t._init(e,!0),t._listen(),i},zoom:function(e){e=this._getFrame(e);this._showModal(e)},getExif:function(e){e=this._getFrame(e);return e&&e.data("exif")||null},getFrames:function(e){e=this.$preview.find(G.FRAMES+(e=e||""));return e=this.reversePreviewOrder?N(e.get().reverse()):e},getPreview:function(){return{content:this.initialPreview,config:this.initialPreviewConfig,tags:this.initialPreviewThumbTags}}},N.fn.fileinput=function(s){if(G.hasFileAPISupport()||G.isIE(9)){var l=Array.apply(null,arguments),f=[];switch(l.shift(),this.each(function(){var e=N(this),t=e.data("fileinput"),i="object"==typeof s&&s,r=i.theme||e.data("theme"),n={},a={},o=i.language||e.data("language")||N.fn.fileinput.defaults.language||"en";t||(r&&(a=N.fn.fileinputThemes[r]||{}),"en"===o||G.isEmpty(N.fn.fileinputLocales[o])||(n=N.fn.fileinputLocales[o]||{}),r=N.extend(!0,{},N.fn.fileinput.defaults,a,N.fn.fileinputLocales.en,n,i,e.data()),t=new c(this,r),e.data("fileinput",t)),"string"==typeof s&&f.push(t[s].apply(t,l))}),f.length){case 0:return this;case 1:return f[0];default:return f}}};var G,c,e="btn btn-sm btn-kv "+G.defaultButtonCss(),t="btn "+G.defaultButtonCss();N.fn.fileinput.defaults={language:"en",bytesToKB:1024,showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showUploadStats:!0,showCancel:null,showPause:null,showClose:!0,showUploadedThumbs:!0,showConsoleLogs:!1,browseOnZoneClick:!1,autoReplace:!1,showDescriptionClose:!0,autoOrientImage:function(){var e=window.navigator.userAgent,t=!!e.match(/WebKit/i);return!(!!e.match(/iP(od|ad|hone)/i)&&t&&!e.match(/CriOS/i))},autoOrientImageInitial:!0,showExifErrorLog:!1,required:!1,rtl:!1,hideThumbnailContent:!1,encodeUrl:!0,focusCaptionOnBrowse:!0,focusCaptionOnClear:!0,generateFileId:null,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"",inputGroupClass:"",mainTemplate:null,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,initialPreviewDownloadUrl:"",removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,sanitizeZoomCache:function(e){e=G.createElement(e);return e.find("input,textarea,select,datalist,form,.file-thumbnail-footer").remove(),e.html()},previewZoomButtonIcons:{prev:'<i class="bi-chevron-left"></i>',next:'<i class="bi-chevron-right"></i>',rotate:'<i class="bi-arrow-clockwise"></i>',toggleheader:'<i class="bi-arrows-expand"></i>',fullscreen:'<i class="bi-arrows-fullscreen"></i>',borderless:'<i class="bi-arrows-angle-expand"></i>',close:'<i class="bi-x-lg"></i>'},previewZoomButtonClasses:{prev:"btn btn-default btn-outline-secondary btn-navigate",next:"btn btn-default btn-outline-secondary btn-navigate",rotate:e,toggleheader:e,fullscreen:e,borderless:e,close:e},previewTemplates:{},previewContentTemplates:{},preferIconicPreview:!1,preferIconicZoomPreview:!1,alwaysPreviewFileExtensions:[],rotatableFileExtensions:["jpg","jpeg","png","gif"],allowedFileTypes:null,allowedFileExtensions:null,allowedPreviewTypes:void 0,allowedPreviewMimeTypes:null,allowedPreviewExtensions:null,disabledPreviewTypes:void 0,disabledPreviewExtensions:["msi","exe","com","zip","rar","app","vb","scr"],disabledPreviewMimeTypes:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="bi-file-earmark-fill"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="bi-folder2-open"></i> ',browseClass:"btn btn-primary",removeIcon:'<i class="bi-trash"></i>',removeClass:t,cancelIcon:'<i class="bi-slash-circle"></i>',cancelClass:t,pauseIcon:'<i class="bi-pause-fill"></i>',pauseClass:t,uploadIcon:'<i class="bi-upload"></i>',uploadClass:t,uploadUrl:null,uploadUrlThumb:null,uploadAsync:!0,uploadParamNames:{chunkCount:"chunkCount",chunkIndex:"chunkIndex",chunkSize:"chunkSize",chunkSizeStart:"chunkSizeStart",chunksUploaded:"chunksUploaded",fileBlob:"fileBlob",fileId:"fileId",fileName:"fileName",fileRelativePath:"fileRelativePath",fileSize:"fileSize",retryCount:"retryCount"},maxAjaxThreads:5,fadeDelay:800,processDelay:100,bitrateUpdateDelay:500,queueDelay:10,progressDelay:0,enableResumableUpload:!1,resumableUploadOptions:{fallback:null,testUrl:null,chunkSize:2048,maxThreads:4,maxRetries:3,showErrorLog:!0,retainErrorHistory:!1,skipErrorsAndProceed:!1},uploadExtraData:{},zoomModalHeight:485,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",resizeIfSizeMoreThan:0,minFileSize:-1,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,maxTotalFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="bi-exclamation-circle-fill"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-striped active progress-bar-animated",progressClass:"progress-bar bg-success progress-bar-success progress-bar-striped active progress-bar-animated",progressInfoClass:"progress-bar bg-info progress-bar-info progress-bar-striped active progress-bar-animated",progressCompleteClass:"progress-bar bg-success progress-bar-success",progressPauseClass:"progress-bar bg-primary progress-bar-primary progress-bar-striped active progress-bar-animated",progressErrorClass:"progress-bar bg-danger progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:void 0,slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",preProcessUpload:null,ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0,mergeAjaxCallbacks:!1,mergeAjaxDeleteCallbacks:!1,retryErrorUploads:!0,reversePreviewOrder:!1,usePdfRenderer:function(){var e=!!window.MSInputMethodContext&&!!document.documentMode;return!!navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/i)||e},pdfRendererUrl:"",pdfRendererTemplate:'<iframe class="kv-preview-data file-preview-pdf" src="{renderer}?file={data}" {style}></iframe>',tabIndexConfig:{browse:500,remove:500,upload:500,cancel:null,pause:null,modal:-1}},N.fn.fileinputLocales.en={sizeUnits:["B","KB","MB","GB","TB","PB","EB","ZB","YB"],bitRateUnits:["B/s","KB/s","MB/s","GB/s","TB/s","PB/s","EB/s","ZB/s","YB/s"],fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear all unprocessed files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",pauseLabel:"Pause",pauseTitle:"Pause ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgPaused:"Paused",msgPlaceholder:"Select {files} ...",msgZoomModalHeading:"Detailed Preview",msgFileRequired:"You must select a file to upload.",msgSizeTooSmall:'File "{name}" (<b>{size}</b>) is too small and must be larger than <b>{minSize}</b>.',msgSizeTooLarge:'File "{name}" (<b>{size}</b>) exceeds maximum allowed upload size of <b>{maxSize}</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgTotalFilesTooMany:"You can upload a maximum of <b>{m}</b> files (<b>{n}</b> files detected).",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing &hellip;",msgUploadBegin:"Initializing &hellip;",msgUploadEnd:"Done",msgUploadResume:"Resuming upload &hellip;",msgUploadEmpty:"No valid data available for upload.",msgUploadError:"Upload Error",msgDeleteError:"Delete Error",msgProgressError:"Error",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgProcessing:"Processing ...",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least <b>{size} px</b> (detected <b>{dimension} px</b>).',msgImageHeightSmall:'Height of image file "{name}" must be at least <b>{size} px</b> (detected <b>{dimension} px</b>).',msgImageWidthLarge:'Width of image file "{name}" cannot exceed <b>{size} px</b> (detected <b>{dimension} px</b>).',msgImageHeightLarge:'Height of image file "{name}" cannot exceed <b>{size} px</b> (detected <b>{dimension} px</b>).',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",msgDuplicateFile:'File "{name}" of same size "{size}" has already been selected earlier. Skipping duplicate selection.',msgResumableUploadRetriesExceeded:"Upload aborted beyond <b>{max}</b> retries for file <b>{file}</b>! Error Details: <pre>{error}</pre>",msgPendingTime:"{time} remaining",msgCalculatingTime:"calculating time remaining",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",rotate:"Rotate 90 deg. clockwise",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}},N.fn.fileinput.Constructor=c,N(document).ready(function(){var e=N("input.file[type=file]");e.length&&e.fileinput()})});