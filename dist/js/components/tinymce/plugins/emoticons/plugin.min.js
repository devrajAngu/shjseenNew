!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=e=>t=>e===t,c=e(null),n=e(void 0),o=()=>{},a=()=>!1;class u{constructor(t,e){this.tag=t,this.value=e}static some(t){return new u(!0,t)}static none(){return u.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?u.some(t(this.value)):u.none()}bind(t){return this.tag?t(this.value):u.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:u.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!=t?t:"Called getOrDie on None")}static from(t){return null==t?u.none():u.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}u.singletonNone=new u(!1);const g=t=>{let e=t;return{get:()=>e,set:t=>{e=t}}},m=Object.keys,r=Object.hasOwnProperty,d=(o,r)=>{var n=m(o);for(let t=0,e=n.length;t<e;t++){var s=n[t];r(o[s],s)}},h=(t,e)=>r.call(t,e),v=()=>{const e=(t=>{const e=g(u.none()),o=()=>e.get().each(t);return{clear:()=>{o(),e.set(u.none())},isSet:()=>e.get().isSome(),get:()=>e.get(),set:t=>{o(),e.set(u.some(t))}}})(o);return{...e,on:t=>e.get().each(t)}},s=(t,e,o=0,r)=>{t=t.indexOf(e,o);return-1!==t&&(!!n(r)||t+e.length<=r)};var p=tinymce.util.Tools.resolve("tinymce.Resource");const i=e=>t=>t.options.get(e),y=i("emoticons_database"),f=i("emoticons_database_url"),b=i("emoticons_database_id"),l=i("emoticons_append"),w=i("emoticons_images_url"),C="All",_={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},j=t=>{var t=l(t),o=t=>({keywords:[],category:"user",...t});{const r={};return d(t,(t,e)=>{e={k:e,v:o(t)};r[e.k]=e.v}),r}},k=(t,n)=>s(t.title.toLowerCase(),n)||(o=>{for(let t=0,e=o.length;t<e;t++)if(r=o[t],s(r.toLowerCase(),n))return!0;var r;return!1})(t.keywords),A=(e,o,t)=>{var r=[],n=o.toLowerCase(),s=t.fold(()=>a,e=>t=>e<=t);for(let t=0;t<e.length&&(0!==o.length&&!k(e[t],n)||(r.push({value:e[t].char,text:e[t].title,icon:e[t].char}),!s(r.length)));t++);return r},O="pattern",x=(o,a)=>{const t={pattern:"",results:A(a.listAll(),"",u.some(300))},i=g(C),r=(()=>{let e=null;const o=()=>{c(e)||(clearTimeout(e),e=null)};return{cancel:o,throttle:(...t)=>{o(),e=setTimeout(()=>{e=null,(t=>{{var e=t;const o=e.getData(),r=i.get(),n=a.listCategory(r),s=A(n,o[O],r===C?u.some(300):u.none());e.setData({results:s});return}}).apply(null,t)},200)}}})(),e={label:"Search",type:"input",name:O},n={type:"collection",name:"results"},s=()=>({title:"Emojis",size:"normal",body:{type:"tabpanel",tabs:((e,o)=>{const r=e.length,n=new Array(r);for(let t=0;t<r;t++){const r=e[t];n[t]=o(r,t)}return n})(a.listCategories(),t=>({title:t,name:t,items:[e,n]}))},initialData:t,onTabChange:(t,e)=>{i.set(e.newTabName),r.throttle(t)},onChange:r.throttle,onAction:(t,e)=>{"results"===e.name&&(e=e.value,o.insertContent(e),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}),l=o.windowManager.open(s());l.focus(O),a.hasLoaded()||(l.block("Loading emojis..."),a.waitForLoad().then(()=>{l.redial(s()),r.throttle(l),l.focus(O),l.unblock()}).catch(t=>{l.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),l.focus(O),l.unblock()}))},E=o=>t=>{const e=()=>{t.setEnabled(o.selection.isEditable())};return o.on("NodeChange",e),e(),()=>{o.off("NodeChange",e)}};t.add("emoticons",(t,e)=>{e=e,(o=(i=t).options.register)("emoticons_database",{processor:"string",default:"emojis"}),o("emoticons_database_url",{processor:"string",default:`${e}/js/${y(i)}${i.suffix}.js`}),o("emoticons_database_id",{processor:"string",default:"tinymce.plugins.emoticons"}),o("emoticons_append",{processor:"object",default:{}}),o("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"});var o,r,n,s,a,i,l,c,e=((o,n,t)=>{const s=v(),a=v(),i=w(o),r=(o.on("init",()=>{p.load(t,n).then(t=>{var e=j(o);{t=(e=>{if(0===e.length)throw new Error("Can't merge zero objects");var o={};for(let t=0;t<e.length;t++){var r=e[t];for(const e in r)h(r,e)&&(o[e]=(e,r[e]))}return o})([t,e]);const r={},n=[];d(t,(t,e)=>{var t={title:e,keywords:t.keywords,char:4<=(o=(e=t).char).length&&"<img"===o.substr(0,4)?e.char.replace(/src="([^"]+)"/,(t,e)=>`src="${i}${e}"`):e.char,category:(o=_,e=t.category,h(o,e)?o[e]:e)},o=void 0!==r[t.category]?r[t.category]:[];r[t.category]=o.concat([t]),n.push(t)}),s.set(r),a.set(n)}},t=>{console.log("Failed to load emojis: "+t),s.set({}),a.set([])})}),()=>a.get().getOr([])),l=()=>s.isSet()&&a.isSet();return{listCategories:()=>[C].concat(m(s.get().getOr({}))),hasLoaded:l,waitForLoad:()=>l()?Promise.resolve(!0):new Promise((t,e)=>{let o=15;const r=setInterval(()=>{l()?(clearInterval(r),t(!0)):--o<0&&(console.log("Could not load emojis from url: "+n),clearInterval(r),e(!1))},100)}),listAll:r,listCategory:e=>e===C?r():s.get().bind(t=>u.from(t[e])).getOr([])}})(t,f(t),b(t));c=e,(l=t).addCommand("mceEmoticons",()=>x(l,c)),i=()=>a.execCommand("mceEmoticons"),(a=t).ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:i,onSetup:E(a)}),a.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:i,onSetup:E(a)}),s=e,(n=t).ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(e,o)=>s.waitForLoad().then(()=>{var t=s.listAll();return A(t,e,u.some(o))}),onAction:(t,e,o)=>{n.selection.setRng(e),n.insertContent(o),t.hide()}}),(r=t).on("PreInit",()=>{r.parser.addAttributeFilter("data-emoticon",t=>{var o,r=t;for(let t=0,e=r.length;t<e;t++)(o=r[t]).attr("data-mce-resize","false"),o.attr("data-mce-placeholder","1")})})})}();