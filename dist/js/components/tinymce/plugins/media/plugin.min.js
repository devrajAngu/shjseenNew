!function(){"use strict";var R=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=a=>e=>{return r=typeof(e=e),(null===e?"null":"object"==r&&Array.isArray(e)?"array":"object"==r&&(e=e,(t=String).prototype.isPrototypeOf(e)||(null==(e=e.constructor)?void 0:e.name)===t.name)?"string":r)===a;var t,r},o=e("string"),l=e("object"),E=e("array"),m=e=>!(null==e);class n{constructor(e,t){this.tag=e,this.value=t}static some(e){return new n(!0,e)}static none(){return n.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?n.some(e(this.value)):n.none()}bind(e){return this.tag?e(this.value):n.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:n.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return m(e)?n.some(e):n.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}n.singletonNone=new n(!1);const U=Array.prototype.push,h=(r,a)=>{for(let e=0,t=r.length;e<t;e++)a(r[e],e)},P=Object.keys,L=Object.hasOwnProperty,c=(e,t)=>u(e,t)?n.from(e[t]):n.none(),u=(e,t)=>L.call(e,t),t=t=>e=>e.options.get(t),I=t("audio_template_callback"),B=t("video_template_callback"),G=t("iframe_template_callback"),W=t("media_live_embeds"),q=t("media_filter_html"),H=t("media_url_resolver"),J=t("media_alt_source"),K=t("media_poster"),d=t("media_dimensions");var p=tinymce.util.Tools.resolve("tinymce.util.Tools"),r=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),i=tinymce.util.Tools.resolve("tinymce.html.DomParser");const Q=r.DOM,a=e=>e.replace(/px$/,""),V=e=>{var t=e.attr("style"),t=t?Q.parseStyle(t):{};return{type:"ephox-embed-iri",source:e.attr("data-ephox-embed-iri"),altsource:"",poster:"",width:c(t,"max-width").map(a).getOr(""),height:c(t,"max-height").map(a).getOr("")}},g=(t,r)=>{let a={};for(let e=i({validate:!1,forced_root_block:!1},r).parse(t);e;e=e.walk())if(1===e.type){const t=e.name;if(e.attr("data-ephox-embed-iri")){a=V(e);break}a.source||"param"!==t||(a.source=e.attr("movie")),"iframe"!==t&&"object"!==t&&"embed"!==t&&"video"!==t&&"audio"!==t||(a.type||(a.type=t),a=p.extend(e.attributes.map,a)),"source"===t&&(a.source?a.altsource||(a.altsource=e.attr("src")):a.source=e.attr("src")),"img"!==t||a.poster||(a.poster=e.attr("src"))}return a.source=a.source||a.src||"",a.altsource=a.altsource||"",a.poster=a.poster||"",a},b=e=>{e=null!=(e=e.toLowerCase().split(".").pop())?e:"";return c({mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"},e).getOr("")};var v=tinymce.util.Tools.resolve("tinymce.html.Node"),w=tinymce.util.Tools.resolve("tinymce.html.Serializer");const f=(e,t={})=>i({forced_root_block:!1,validate:!1,allow_conditional_comments:!0,...t},e),s=r.DOM,y=e=>/^[0-9.]+$/.test(e)?e+"px":e,X=(e,t)=>{var r=t.attr("style"),r=r?s.parseStyle(r):{};m(e.width)&&(r["max-width"]=y(e.width)),m(e.height)&&(r["max-height"]=y(e.height)),t.attr("style",s.serializeStyle(r))},x=["source","altsource"],_=(e,r,a,o)=>{let i=0,s=0;var l=f(o),l=(l.addNodeFilter("source",e=>i=e.length),l.parse(e));for(let t=l;t;t=t.walk())if(1===t.type){const o=t.name;if(t.attr("data-ephox-embed-iri")){X(r,t);break}switch(o){case"video":case"object":case"embed":case"img":case"iframe":void 0!==r.height&&void 0!==r.width&&(t.attr("width",r.width),t.attr("height",r.height))}if(a)switch(o){case"video":t.attr("poster",r.poster),t.attr("src",null);for(let e=i;e<2;e++)if(r[x[e]]){const o=new v("source",1);o.attr("src",r[x[e]]),o.attr("type",r[x[e]+"mime"]||null),t.append(o)}break;case"iframe":t.attr("src",r.source);break;case"object":const a=0<t.getAll("img").length;if(r.poster&&!a){t.attr("src",r.poster);const a=new v("img",1);a.attr("src",r.poster),a.attr("width",r.width),a.attr("height",r.height),t.append(a)}break;case"source":if(s<2&&(t.attr("src",r[x[s]]),t.attr("type",r[x[s]+"mime"]||null),!r[x[s]])){t.remove();continue}s++;break;case"img":r.poster||t.remove()}}return w({},o).serialize(l)},Y=[{regex:/youtu\.be\/([\w\-_\?&=.]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)\?h=(\w+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?h=$2&title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)\?h=(\w+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?h=$3&title=0&amp;byline=0",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],k=t=>{var e=Y.filter(e=>e.regex.test(t));return 0<e.length?p.extend({},e[0],{url:((e,t)=>{const r=!((o=t.match(/^(https?:\/\/|www\.)(.+)$/i))&&1<o.length)||"www."===o[1]?"https://":o[1],a=e.regex.exec(t);var o;let i=r+e.url;if(m(a))for(let e=0;e<a.length;e++)i=i.replace("$"+e,()=>a[e]||"");return i.replace(/\?$/,"")})(e[0],t)}):null},j=(r,e)=>{var t,a;const o=p.extend({},e);if(!o.source&&(p.extend(o,g(null!=(t=o.embed)?t:"",r.schema)),!o.source))return"";o.altsource||(o.altsource=""),o.poster||(o.poster=""),o.source=r.convertURL(o.source,"source"),o.altsource=r.convertURL(o.altsource,"source"),o.sourcemime=b(o.source),o.altsourcemime=b(o.altsource),o.poster=r.convertURL(o.poster,"poster");const i=k(o.source);if(i&&(o.source=i.url,o.type=i.type,o.allowfullscreen=i.allowFullscreen,o.width=o.width||String(i.w),o.height=o.height||String(i.h)),o.embed)return _(o.embed,o,!0,r.schema);{const e=I(r),t=B(r),i=G(r);if(o.width=o.width||"300",o.height=o.height||"150",p.each(o,(e,t)=>{o[t]=r.dom.encode(""+e)}),"iframe"===o.type){var s=o,l=i;if(l)return l(s);{const l=s.allowfullscreen?' allowFullscreen="1"':"";return'<iframe src="'+s.source+'" width="'+s.width+'" height="'+s.height+'"'+l+"></iframe>"}}if("application/x-shockwave-flash"!==o.sourcemime)return-1!==o.sourcemime.indexOf("audio")?(l=o,(s=e)?s(l):'<audio controls="controls" src="'+l.source+'">'+(l.altsource?'\n<source src="'+l.altsource+'"'+(l.altsourcemime?' type="'+l.altsourcemime+'"':"")+" />\n":"")+"</audio>"):(a=o,(n=t)?n(a):'<video width="'+a.width+'" height="'+a.height+'"'+(a.poster?' poster="'+a.poster+'"':"")+' controls="controls">\n<source src="'+a.source+'"'+(a.sourcemime?' type="'+a.sourcemime+'"':"")+" />\n"+(a.altsource?'<source src="'+a.altsource+'"'+(a.altsourcemime?' type="'+a.altsourcemime+'"':"")+" />\n":"")+"</video>");{var n=o;let e='<object data="'+n.source+'" width="'+n.width+'" height="'+n.height+'" type="application/x-shockwave-flash">';return n.poster&&(e+='<img src="'+n.poster+'" width="'+n.width+'" height="'+n.height+'" />'),e+="</object>"}}},O=e=>e.hasAttribute("data-mce-object")||e.hasAttribute("data-ephox-embed-iri"),A={},S=t=>e=>j(t,e),$=(e,t)=>{var a,o,i,r=H(e);return r?(a=t,o=S(e),i=r,new Promise((t,e)=>{var r=e=>(e.html&&(A[a.source]=e),t({url:a.source,html:e.html||o(a)}));A[a.source]?r(A[a.source]):i({url:a.source},r,e)})):(r=t,t=S(e),Promise.resolve({html:t(r),url:r.source}))},Z=(e,r)=>{const a={};return c(e,"dimensions").each(e=>{h(["width","height"],t=>{c(r,t).orThunk(()=>c(e,t)).each(e=>a[t]=e)})}),a},C=(e,t)=>{var o,i,s,r=t&&"dimensions"!==t?(a=t,r=e,c(r,a).bind(e=>c(e,"meta")).getOr({})):{},a=(o=e,i=r,s=t,e=>{const t=()=>c(o,e),r=()=>c(i,e),a=e=>c(e,"value").bind(e=>0<e.length?n.some(e):n.none());return{[e]:(e===s?t().bind(e=>l(e)?a(e).orThunk(r):r().orThunk(()=>n.from(e))):r().orThunk(()=>t().bind(e=>l(e)?a(e):n.from(e)))).getOr("")}});return{...a("source"),...a("altsource"),...a("poster"),...a("embed"),...Z(e,r)}},T=e=>{const a={...e,source:{value:c(e,"source").getOr("")},altsource:{value:c(e,"altsource").getOr("")},poster:{value:c(e,"poster").getOr("")}};return h(["width","height"],r=>{c(e,r).each(e=>{var t=a.dimensions||{};t[r]=e,a.dimensions=t})}),a},z=t=>e=>{e=e&&e.msg?"Media embed handler error: "+e.msg:"Media embed handler threw unknown error.";t.notificationManager.open({type:"error",text:e})},D=(r,a)=>e=>{if(o(e.url)&&0<e.url.trim().length){const o=e.html,t={...g(o,a.schema),source:e.url,embed:o};r.setData(T(t))}},F=(e,t)=>{var r=e.dom.select("*[data-mce-object]"),t=(e.insertContent(t),e),a=r,o=t.dom.select("*[data-mce-object]");for(let t=0;t<a.length;t++)for(let e=o.length-1;0<=e;e--)a[t]===o[e]&&o.splice(e,1);t.selection.select(o[0]),e.nodeChanged()},M=(e,t)=>m(t)&&"ephox-embed-iri"===t&&m(k(e)),N=(e,t)=>(e.width!==t.width||e.height!==t.height)&&M(t.source,e.type),ee=l=>{const e=(e=>{const t=e.selection.getNode(),r=O(t)?e.serializer.serialize(t,{selection:!0}):"",a=g(r,e.schema),o=M(a.source,a.type)?{width:(e=e.dom.getRect(t)).w.toString().replace(/px$/,""),height:e.h.toString().replace(/px$/,"")}:{};return{embed:r,...a,...o}})(l),n=(()=>{let t=e;return{get:()=>t,set:e=>{t=e}}})(),t=T(e),r=d(l)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:[],a={title:"General",name:"general",items:(r=>{var a=[];for(let e=0,t=r.length;e<t;++e){if(!E(r[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+r);U.apply(a,r[e])}return a})([[{name:"source",type:"urlinput",filetype:"media",label:"Source"}],r])},o=[];J(l)&&o.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"}),K(l)&&o.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"});var i=[a,{title:"Embed",items:[{type:"textarea",name:"embed",label:"Paste your embed code below:"}]}];0<o.length&&i.push({title:"Advanced",name:"advanced",items:o});const s={type:"tabpanel",tabs:i},c=l.windowManager.open({title:"Insert/Edit Media",size:"normal",body:s,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:e=>{var t,r,a,o=C(e.getData());t=n.get(),r=l,(o=o).embed=N(t,o)&&d(r)?j(r,{...o,embed:""}):_(null!=(a=o.embed)?a:"",o,!1,r.schema),o.embed&&(t.source===o.source||(a=o.source,u(A,a)))?F(r,o.embed):$(r,o).then(e=>{F(r,e.html)}).catch(z(r)),e.close()},onChange:(e,t)=>{switch(t.name){case"source":var r=n.get(),a=e;a=C(a.getData(),"source"),r.source!==a.source&&(D(c,l)({url:a.source,html:""}),$(l,a).then(D(c,l)).catch(z(l)));break;case"embed":r=e,a=C(r.getData()),a=g(null!=(a=a.embed)?a:"",l.schema),r.setData(T(a));break;case"dimensions":case"altsource":case"poster":var o=e,i=t.name,s=n.get();i=C(o.getData(),i),s=N(s,i)&&d(l)?{...i,embed:""}:i,i=j(l,s),o.setData(T({...s,embed:i}))}n.set(C(e.getData()))},initialData:t})};var te=tinymce.util.Tools.resolve("tinymce.Env");const re=(e,t,r,a=null)=>{e=e.attr(r);return m(e)?e:u(t,r)?null:a},ae=(e,t,r)=>{var a="img"===t.name||"video"===e.name,o=a?"300":null,i="audio"===e.name?"30":"150",a=a?i:null;t.attr({width:re(e,r,"width",o),height:re(e,r,"height",a)})},oe=(t,r,a)=>{var o,i=null!=(n=r.attributes)?n:[];let s=i.length;for(;s--;){const r=i[s].name;let e=i[s].value;"width"===r||"height"===r||"style"===r||9<=(o=r).length&&"data-mce-"===o.substr(0,9)||("data"!==r&&"src"!==r||(e=t.convertURL(e,r)),a.attr("data-mce-p-"+r,e))}const e=w({inner:!0},t.schema),l=new v("div",1);h(r.children(),e=>l.append(e));var n=e.serialize(l);n&&(a.attr("data-mce-html",escape(n)),a.empty())},ie=e=>{let t=e;for(;t=t.parent;)if(t.attr("data-ephox-embed-iri")||(e=>{e=e.attr("class");return o(e)&&/\btiny-pageembed\b/.test(e)})(t))return!0;return!1},se=r=>e=>{const t=()=>{e.setEnabled(r.selection.isEditable())};return r.on("NodeChange",t),t(),()=>{r.off("NodeChange",t)}};R.add("media",e=>{return(i=e.options.register)("audio_template_callback",{processor:"function"}),i("video_template_callback",{processor:"function"}),i("iframe_template_callback",{processor:"function"}),i("media_live_embeds",{processor:"boolean",default:!0}),i("media_filter_html",{processor:"boolean",default:!0}),i("media_url_resolver",{processor:"function"}),i("media_alt_source",{processor:"boolean",default:!0}),i("media_poster",{processor:"boolean",default:!0}),i("media_dimensions",{processor:"boolean",default:!0}),(r=e).addCommand("mceMedia",()=>{ee(r)}),i=()=>o.execCommand("mceMedia"),(o=e).ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:i,onSetup:e=>{var t=o.selection;e.setActive(O(t.getNode()));const r=t.selectorChangedWithUnbind("img[data-mce-object],span[data-mce-object],div[data-ephox-embed-iri]",e.setActive).unbind,a=se(o)(e);return()=>{r(),a()}}}),o.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:i,onSetup:se(o)}),e.on("ResolveName",e=>{let t;1===e.target.nodeType&&(t=e.target.getAttribute("data-mce-object"))&&(e.name=t)}),(d=e).on("PreInit",()=>{const{schema:a,serializer:e,parser:t}=d,r=a.getBoolAttrs();h("webkitallowfullscreen mozallowfullscreen".split(" "),e=>{r[e]={}});var l,o={embed:["wmode"]},i=P(o);for(let e=0,t=i.length;e<t;e++){var s=i[e];((e,t)=>{const r=a.getElementRule(t);r&&h(e,e=>{r.attributes[e]={},r.attributesOrder.push(e)})})(o[s],s)}t.addNodeFilter("iframe,video,audio,object,embed",(l=d,e=>{let t,r=e.length;for(;r--;)!(t=e[r]).parent||t.parent.attr("data-mce-object")||((e=>{e=e.name;return"iframe"===e||"video"===e||"audio"===e})(t)&&W(l)?ie(t)||t.replace(((e,t)=>{var r=t.name,a=new v("span",1);a.attr({contentEditable:"false",style:t.attr("style"),"data-mce-object":r,class:"mce-preview-object mce-object-"+r}),oe(e,t,a);const o=e.dom.parseStyle(null!=(c=t.attr("style"))?c:""),i=new v(r,1);if(ae(t,i,o),i.attr({src:t.attr("src"),style:t.attr("style"),class:t.attr("class")}),"iframe"===r)i.attr({allowfullscreen:t.attr("allowfullscreen"),frameborder:"0"});else{h(["controls","crossorigin","currentTime","loop","muted","poster","preload"],e=>{i.attr(e,t.attr(e))});const c=a.attr("data-mce-html");if(m(c)){var s=i;var l=unescape(c);for(var n=f(e.schema).parse(l,{context:r});n.firstChild;)s.append(n.firstChild)}}var c=new v("span",1);return c.attr("class","mce-shim"),a.append(i),a.append(c),a})(l,t)):ie(t)||t.replace((a=l,s=i=void 0,i=(o=t).name,s=new v("img",1),oe(a,o,s),ae(o,s,{}),s.attr({style:o.attr("style"),src:te.transparentSrc,"data-mce-object":i,class:"mce-object mce-object-"+i}),s)));var a,o,i,s})),e.addAttributeFilter("data-mce-object",(t,r)=>{var a,o,i,s;let e=t.length;for(;e--;){var l=t[e];if(l.parent){const m=l.attr(r),u=new v(m,1);if("audio"!==m){const d=l.attr("class");d&&-1!==d.indexOf("mce-preview-object")&&l.firstChild?u.attr({width:l.firstChild.attr("width"),height:l.firstChild.attr("height")}):u.attr({width:l.attr("width"),height:l.attr("height")})}u.attr({style:l.attr("style")});var n=null!=(c=l.attributes)?c:[];let e=n.length;for(;e--;){const d=n[e].name;0===d.indexOf("data-mce-p-")&&u.attr(d.substr(11),n[e].value)}var c=l.attr("data-mce-html");if(c){a=d,o=m,c=unescape(c),i=(s=i=void 0,a.options.get)("xss_sanitization"),s=q(a);const t=f(a.schema,{sanitize:i,validate:s}).parse(c,{context:o});h(t.children(),e=>u.append(e))}l.replace(u)}}})}),d.on("SetContent",()=>{const t=d.dom;h(t.select("span.mce-preview-object"),e=>{0===t.select("span.mce-shim",e).length&&t.add(e,"span",{class:"mce-shim"})})}),(a=e).on("click keyup touchend",()=>{var e=a.selection.getNode();e&&a.dom.hasClass(e,"mce-preview-object")&&a.dom.getAttrib(e,"data-mce-selected")&&e.setAttribute("data-mce-selected","2")}),a.on("ObjectResized",e=>{var t,r=e.target;r.getAttribute("data-mce-object")&&(t=r.getAttribute("data-mce-html"))&&(t=unescape(t),r.setAttribute("data-mce-html",escape(_(t,{width:String(e.width),height:String(e.height)},!1,a.schema))))}),t=e,{showDialog:()=>{ee(t)}};var t,a,d,o,r,i})}();