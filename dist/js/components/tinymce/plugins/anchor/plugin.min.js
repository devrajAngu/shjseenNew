!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),l=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),d=tinymce.util.Tools.resolve("tinymce.util.Tools");const r="a:not([href])",i=e=>!e,s=e=>e.getAttribute("id")||e.getAttribute("name")||"",c=e=>"a"===e.nodeName.toLowerCase()&&!e.getAttribute("href")&&""!==s(e),m=e=>e.dom.getParent(e.selection.getStart(),r),u=(e,t)=>{var a,n,o,r,i=m(e);i?(o=e,r=t,(i=i).removeAttribute("name"),i.id=r,o.addVisual(),o.undoManager.add()):(n=t,(a=e).undoManager.transact(()=>{if(a.options.get("allow_html_in_named_anchor")||a.selection.collapse(!0),a.selection.isCollapsed())a.insertContent(a.dom.createHTML("a",{id:n}));else{{var e=a;const o=e.dom;l(o).walk(e.selection.getRng(),e=>{d.each(e,e=>{var t;c(t=e)&&!t.firstChild&&o.remove(e,!1)})})}a.formatter.remove("namedAnchor",void 0,void 0,!0),a.formatter.apply("namedAnchor",{value:n}),a.addVisual()}})),e.focus()},h=r=>t=>{for(let e=0;e<t.length;e++){var o=t[e];n=void 0,n=a=o,!i(n.attr("href"))||i(n.attr("id")||n.attr("name"))||a.firstChild||o.attr("contenteditable",r)}var a,n},g=o=>e=>{const t=()=>{e.setEnabled(o.selection.isEditable())};return o.on("NodeChange",t),t(),()=>{o.off("NodeChange",t)}};e.add("anchor",e=>{var a,t,o,n;(0,e.options.register)("allow_html_in_named_anchor",{processor:"boolean",default:!1}),(n=e).on("PreInit",()=>{n.parser.addNodeFilter("a",h("false")),n.serializer.addNodeFilter("a",h(null))}),(o=e).addCommand("mceAnchor",()=>{var a,e;e=(e=>{e=m(e);return e?s(e):""})(a=o),a.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:e},onSubmit:e=>{var t,o;t=a,o=e.getData().id,(/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(o)?(u(t,o),0):(t.windowManager.alert("ID should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),1))||e.close()}})}),t=()=>a.execCommand("mceAnchor"),(a=e).ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:t,onSetup:e=>{const t=a.selection.selectorChangedWithUnbind("a:not([href])",e.setActive).unbind,o=g(a)(e);return()=>{t(),o()}}}),a.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:t,onSetup:g(a)}),e.on("PreInit",()=>{e.formatter.register("namedAnchor",{inline:"a",selector:r,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:(e,t,o)=>c(e)})})})}();