!function(){"use strict";const h=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}};var P=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=r=>e=>{return n=typeof(e=e),(null===e?"null":"object"==n&&Array.isArray(e)?"array":"object"==n&&(e=e,(t=String).prototype.isPrototypeOf(e)||(null==(e=e.constructor)?void 0:e.name)===t.name)?"string":n)===r;var t,n},t=t=>e=>typeof e===t,W=e("string"),$=e("array"),V=t("boolean"),j=t("number"),z=()=>{},n=e=>()=>e,l=n(!0),U=n("[~№|!-*+-\\/:;?@\\[-`{}¡«·»¿;·՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾࡞।॥॰෴๏๚๛༄-༒༺-༽྅࿐-࿔࿙࿚၊-၏჻፡-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᨞᨟᪠-᪦᪨-᪭᭚-᭠᯼-᯿᰻-᰿᱾᱿᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⵰⸀-⸮⸰⸱、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･]");class g{constructor(e,t){this.tag=e,this.value=t}static some(e){return new g(!0,e)}static none(){return g.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?g.some(e(this.value)):g.none()}bind(e){return this.tag?e(this.value):g.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:g.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return null==e?g.none():g.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}g.singletonNone=new g(!1);const f=U;var p=tinymce.util.Tools.resolve("tinymce.Env"),x=tinymce.util.Tools.resolve("tinymce.util.Tools");const _=Array.prototype.slice,q=Array.prototype.push,m=(t,n)=>{const r=t.length,a=new Array(r);for(let e=0;e<r;e++){const r=t[e];a[e]=n(r,e)}return a},v=(n,r)=>{for(let e=0,t=n.length;e<t;e++)r(n[e],e)},r=(t,n)=>{for(let e=t.length-1;0<=e;e--)n(t[e],e)},y=(e,t)=>{var n=m(e,t),r=[];for(let e=0,t=n.length;e<t;++e){if(!$(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);q.apply(r,n[e])}return r},G=Object.hasOwnProperty,a=(e,t)=>G.call(e,t);"undefined"==typeof window&&Function("return this;")();const d=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},o=(e,t)=>({element:e,offset:t}),i=(e,t)=>{var n,r,a;r=t,a=n=e,g.from(a.dom.parentNode).map(d).each(e=>{e.dom.insertBefore(r.dom,n.dom)}),t.dom.appendChild(e.dom)},K=(n=>{const t=e=>n(e)?g.from(e.dom.nodeValue):g.none();return{get:e=>{if(n(e))return t(e).getOr("");throw new Error("Can only get text value of a text node")},getOption:t,set:(e,t)=>{if(!n(e))throw new Error("Can only set raw text value of a text node");e.dom.nodeValue=t}}})(e=>3===e.dom.nodeType),b=e=>K.get(e);var u=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker");const c=(e,t)=>e.isBlock(t)||a(e.schema.getVoidElements(),t.nodeName),w=(e,t)=>"false"===e.getContentEditable(t),C=(e,t)=>!e.isBlock(t)&&a(e.schema.getWhitespaceElements(),t.nodeName),s=(e,t)=>{return e=d(e),t=t,n=e,0<(n=m(n.dom.childNodes,d)).length&&t<n.length?o(n[t],0):o(e,t);var n},E=(e,t,n,r,a,o=!0)=>{let s=o?t(!1):n;for(;s;){const n=w(e,s);if(n||C(e,s)){if(n?r.cef(s):r.boundary(s))break;s=t(!0)}else{if(c(e,s)){if(r.boundary(s))break}else 3===s.nodeType&&r.text(s);if(s===a)break;s=t(!1)}}},O=(e,t,n,r,a)=>{var o,s;s=e,o=n,c(s,o)||w(s,o)||C(s,o)||(o=o,"true"===(s=s).getContentEditable(o)&&o.parentNode&&"false"===s.getContentEditableParent(o.parentNode))||(o=null!=(s=e.getParent(r,e.isBlock))?s:e.getRoot(),r=new u(n,o),s=(a?r.next:r.prev).bind(r),E(e,s,n,{boundary:l,cef:l,text:e=>{a?t.fOffset+=e.length:t.sOffset+=e.length,t.elements.push(d(e))}}))},N=(e,t,n,r,a,o=!0)=>{const s=new u(n,t),l=[];let i={sOffset:0,fOffset:0,elements:[]};O(e,i,n,t,!1);const c=()=>(0<i.elements.length&&(l.push(i),i={sOffset:0,fOffset:0,elements:[]}),!1);return E(e,s.next.bind(s),n,{boundary:c,cef:e=>(c(),a&&l.push(...a.cef(e)),!1),text:e=>{i.elements.push(d(e)),a&&a.text(e,i)}},r,o),r&&O(e,i,r,t,!0),c(),l},H=(t,e)=>{const n=s(e.startContainer,e.startOffset),r=n.element.dom,a=s(e.endContainer,e.endOffset),o=a.element.dom;return N(t,e.commonAncestorContainer,r,o,{text:(e,t)=>{e===o?t.fOffset+=e.length-a.offset:e===r&&(t.sOffset+=n.offset)},cef:e=>{e=y((e=d(e),1!==(e=void 0===e?document:e.dom).nodeType&&9!==e.nodeType&&11!==e.nodeType||0===e.childElementCount?[]:m(e.querySelectorAll("*[contenteditable=true]"),d)),e=>{e=e.dom;return N(t,e,e)});return(e=_.call(e,0)).sort((e,t)=>{return e=e.elements[0].dom,t=t.elements[0].dom,n=Node.DOCUMENT_POSITION_PRECEDING,0!=(e.compareDocumentPosition(t)&n)?1:-1;var n}),e}},!1)},T=(e,t)=>t.collapsed?[]:H(e,t),k=(e,t)=>{var n=e.createRng();return n.selectNode(t),T(e,n)},J=(u,e)=>y(e,e=>{var t=e.elements,n=m(t,b).join(""),s=((e,t,n=0,r)=>{for(var a,o=t.regex,s=(o.lastIndex=n,[]);a=o.exec(e);){const e=a[t.matchIndex],n=a.index+a[0].indexOf(e),l=n+e.length;if(r<l)break;s.push({start:n,finish:l}),o.lastIndex=l}return s})(n,u,e.sOffset,n.length-e.fOffset);n=t,r=(e,n)=>{const t=b(n),r=e.last,a=r+t.length,o=y(s,(e,t)=>e.start<a&&e.finish>r?[{element:n,start:Math.max(r,e.start)-r,finish:Math.min(a,e.finish)-r,matchId:t}]:[]);return{results:e.results.concat(o),last:a}},a={results:[],last:0},v(n,(e,t)=>{a=r(a,e)});var r,a,o=a.results,l=e=>e.matchId;if(0===o.length)return[];{let n=l(o[0]);var i=[];let r=[];for(let e=0,t=o.length;e<t;e++){var c=o[e],d=l(c);d!==n&&(i.push(r),r=[]),n=d,r.push(c)}return 0!==r.length&&i.push(r),i}}),L=(e,s)=>{r(e,(e,o)=>{r(e,e=>{var t=d(s.cloneNode(!1)),n=t.dom,r="data-mce-index",a=o;if(!(W(a)||V(a)||j(a)))throw console.error("Invalid call to Attribute.set. Key ",r,":: Value ",a,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(r,a+"");n=e.element.dom;if(n.length===e.finish&&0===e.start)i(e.element,t);else{n.length!==e.finish&&n.splitText(e.finish);const s=n.splitText(e.start);i(d(s),t)}})})},A=e=>e.getAttribute("data-mce-index"),Q=(e,t,n,r)=>{var a,o,s,l,i,c=e.dom.create("span",{"data-mce-bogus":1}),d=(c.className="mce-match-marker",e.getBody());return M(e,t,!1),(r?(t=e.dom,r=n,i=e.selection,l=c,o=i.getBookmark(),s=0<(s=t.select("td[data-mce-selected],th[data-mce-selected]")).length?(a=t,s=s,y(s,e=>k(a,e))):T(t,i.getRng()),t=J(r,s),L(t,l),i.moveToBookmark(o),t):(r=e.dom,s=n,l=d,i=c,r=k(r,l),l=J(s,r),L(l,i),l)).length},X=e=>{var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),null!=(t=e.parentNode)&&t.removeChild(e)},S=(e,t)=>{var n=[],r=x.toArray(e.getBody().getElementsByTagName("span"));if(r.length)for(let e=0;e<r.length;e++){var a=A(r[e]);null!==a&&a.length&&a===t.toString()&&n.push(r[e])}return n},B=(e,t,n)=>{t=t.get();let r=t.index;var a=e.dom,n=(n?r+1===t.count?r=0:r++:r-1==-1?r=t.count-1:r--,a.removeClass(S(e,t.index),"mce-match-marker-selected"),S(e,r));return n.length?(a.addClass(S(e,r),"mce-match-marker-selected"),e.selection.scrollIntoView(n[0]),r):-1},Y=(e,t)=>{var n=t.parentNode;e.remove(t),n&&e.isEmpty(n)&&e.remove(n)},Z=(e,t,n,r,a,o)=>{const s=e.selection,l=(u=a,m="("+n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n\\uFEFF]")+")",u?`(?:^|\\s|${f()})`+m+`(?=$|\\s|${f()})`:m),i=s.isForward(),c={regex:new RegExp(l,r?"g":"gi"),matchIndex:1},d=Q(e,t,c,o);var u,m;if(p.browser.isSafari()&&s.setRng(s.getRng(),i),d){const s=B(e,t,!0);t.set({index:s,count:d,text:n,matchCase:r,wholeWord:a,inSelection:o})}return d},F=(e,t)=>{e=B(e,t,!0);t.set({...t.get(),index:e})},I=(e,t)=>{e=B(e,t,!1);t.set({...t.get(),index:e})},ee=e=>{e=A(e);return null!==e&&0<e.length},R=(n,e,r,a,o)=>{var s=e.get(),l=s.index;let i,c=l;a=!1!==a;const d=n.getBody(),u=x.grep(x.toArray(d.getElementsByTagName("span")),ee);for(let t=0;t<u.length;t++){const d=A(u[t]);let e=i=parseInt(d,10);if(o||e===s.index){for(r.length?(u[t].innerText=r,X(u[t])):Y(n.dom,u[t]);u[++t];){if((e=parseInt(A(u[t]),10))!==i){t--;break}Y(n.dom,u[t])}a&&c--}else l<i&&u[t].setAttribute("data-mce-index",String(i-1))}return e.set({...s,count:o?0:s.count-1,index:c}),(a?F:I)(n,e),!o&&0<e.get().count},M=(e,t,n)=>{let r,a;var o=t.get(),s=x.toArray(e.getBody().getElementsByTagName("span"));for(let e=0;e<s.length;e++){const t=A(s[e]);null!==t&&t.length&&(t===o.index.toString()&&(r=r||s[e].firstChild,a=s[e].firstChild),X(s[e]))}if(t.set({...o,index:-1,count:0,text:""}),r&&a){const t=e.dom.createRng();return t.setStart(r,0),t.setEnd(a,a.data.length),!1!==n&&e.selection.setRng(t),t}},te=(o,s)=>{var e=(()=>{const t=(e=>{const t=h(g.none()),n=()=>t.get().each(e);return{clear:()=>{n(),t.set(g.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{n(),t.set(g.some(e))}}})(z);return{...t,on:e=>t.get().each(e)}})();o.undoManager.add();const t=x.trim(o.selection.getContent({format:"text"})),l=e=>{e.setEnabled("next",1<s.get().count),e.setEnabled("prev",1<s.get().count)},r=(t,n)=>{v(["replace","replaceall","prev","next"],e=>t.setEnabled(e,!n))},i=(e,t)=>{t.redial(m(e,t.getData()))},c=(e,t)=>{p.browser.isSafari()&&p.deviceType.isTouch()&&("find"===t||"replace"===t||"replaceall"===t)&&e.focus(t)},d=e=>{M(o,s,!1),r(e,!0),l(e)},u=e=>{const t=e.getData(),n=s.get();if(t.findtext.length){if(n.text===t.findtext&&n.matchCase===t.matchcase&&n.wholeWord===t.wholewords)F(o,s);else{const n=Z(o,s,t.findtext,t.matchcase,t.wholewords,t.inselection);n<=0&&i(!0,e),r(e,0===n)}l(e)}else d(e)},n=s.get(),a={findtext:t,replacetext:"",wholewords:n.wholeWord,matchcase:n.matchCase,inselection:n.inSelection},m=(n,e)=>{return{title:"Find and Replace",size:"normal",body:{type:"panel",items:(t=[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",enabled:!1,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",enabled:!1,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}],n&&t.push({type:"alertbanner",level:"error",text:"Could not find the specified string.",icon:"warning"}),t)},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"},{type:"togglemenuitem",name:"inselection",text:"Find in selection"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",enabled:!1},{type:"custom",name:"replaceall",text:"Replace all",enabled:!1}],initialData:e,onChange:(e,t)=>{n&&i(!1,e),"findtext"===t.name&&0<s.get().count&&d(e)},onAction:(e,t)=>{var n,r,a=e.getData();switch(t.name){case"find":u(e);break;case"replace":(R(o,s,a.replacetext)?l:d)(e);break;case"replaceall":R(o,s,a.replacetext,!0,!0),d(e);break;case"prev":I(o,s),l(e);break;case"next":F(o,s),l(e);break;case"matchcase":case"wholewords":case"inselection":i(!1,e),n=e.getData(),r=s.get(),s.set({...r,matchCase:n.matchcase,wholeWord:n.wholewords,inSelection:n.inselection}),d(e)}c(e,t.name)},onSubmit:e=>{u(e),c(e,"find")},onClose:()=>{o.focus(),M(o,s),o.undoManager.add()}};var t};e.set(o.windowManager.open(m(!1,a),{inline:"toolbar"}))},D=(e,t)=>()=>{te(e,t)};P.add("searchreplace",e=>{var a,o,t,n,r,s,l=h({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1,inSelection:!1});return s=l,(r=e).addCommand("SearchReplace",()=>{te(r,s)}),n=l,(t=e).ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:D(t,n),icon:"search"}),t.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:D(t,n),icon:"search"}),t.shortcuts.add("Meta+F","",D(t,n)),a=e,o=l,{done:e=>M(a,o,e),find:(e,t,n,r=!1)=>Z(a,o,e,t,n,r),next:()=>F(a,o),prev:()=>I(a,o),replace:(e,t,n)=>R(a,o,e,t,n)}})}();