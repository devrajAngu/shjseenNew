!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");const r=e=>void 0===e;var n=tinymce.util.Tools.resolve("tinymce.util.Delay"),a=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),i=tinymce.util.Tools.resolve("tinymce.util.Tools");const t=t=>e=>e.options.get(t),u=t("autosave_ask_before_unload"),l=t("autosave_restore_when_empty"),m=t("autosave_interval"),o=t("autosave_retention"),s=e=>{var t=document.location;return e.options.get("autosave_prefix").replace(/{path}/g,t.pathname).replace(/{query}/g,t.search).replace(/{hash}/g,t.hash).replace(/{id}/g,e.id)},v=(e,t)=>{if(r(t))return e.dom.isEmpty(e.getBody());{const r=i.trim(t);if(""===r)return!0;{const t=(new DOMParser).parseFromString(r,"text/html");return e.dom.isEmpty(t)}}},c=e=>{var t=parseInt(null!=(t=a.getItem(s(e)+"time"))?t:"0",10)||0;return!((new Date).getTime()-t>o(e)&&(d(e,!1),1))},d=(e,t)=>{var r=s(e);a.removeItem(r+"draft"),a.removeItem(r+"time"),!1!==t&&e.dispatch("RemoveDraft")},f=e=>{var t=s(e);!v(e)&&e.isDirty()&&(a.setItem(t+"draft",e.getContent({format:"raw",no_events:!0})),a.setItem(t+"time",(new Date).getTime().toString()),e.dispatch("StoreDraft"))},p=e=>{var t=s(e);c(e)&&(e.setContent(null!=(t=a.getItem(t+"draft"))?t:"",{format:"raw"}),e.dispatch("RestoreDraft"))};var g=tinymce.util.Tools.resolve("tinymce.EditorManager");const y=r=>e=>{e.setEnabled(c(r));const t=()=>e.setEnabled(c(r));return r.on("StoreDraft RestoreDraft RemoveDraft",t),()=>r.off("StoreDraft RestoreDraft RemoveDraft",t)};e.add("autosave",e=>{return o=e.options.register,s=e=>{var t,r,a="string"==(r=typeof(a=a=e),null===a?"null":"object"==r&&Array.isArray(a)?"array":"object"==r&&(a=a,(t=String).prototype.isPrototypeOf(a)||(null==(a=a.constructor)?void 0:a.name)===t.name)?"string":r);return a?{value:((r=/^(\d+)([ms]?)$/.exec(t=e))&&r[2]?{s:1e3,m:6e4}[r[2]]:1)*parseInt(t,10),valid:a}:{valid:!1,message:"Must be a string."}},o("autosave_ask_before_unload",{processor:"boolean",default:!0}),o("autosave_prefix",{processor:"string",default:"tinymce-autosave-{path}{query}{hash}-{id}-"}),o("autosave_restore_when_empty",{processor:"boolean",default:!1}),o("autosave_interval",{processor:s,default:"30s"}),o("autosave_retention",{processor:s,default:"20m"}),e.editorManager.on("BeforeUnload",e=>{let t;i.each(g.get(),e=>{e.plugins.autosave&&e.plugins.autosave.storeDraft(),!t&&e.isDirty()&&u(e)&&(t=e.translate("You have unsaved changes are you sure you want to navigate away?"))}),t&&(e.preventDefault(),e.returnValue=t)}),a=r=e,o=m(a),n.setEditorInterval(a,()=>{f(a)},o),o=()=>{var e;(e=r).undoManager.transact(()=>{p(e),d(e)}),e.focus()},r.ui.registry.addButton("restoredraft",{tooltip:"Restore last draft",icon:"restore-draft",onAction:o,onSetup:y(r)}),r.ui.registry.addMenuItem("restoredraft",{text:"Restore last draft",icon:"restore-draft",onAction:o,onSetup:y(r)}),e.on("init",()=>{l(e)&&e.dom.isEmpty(e.getBody())&&p(e)}),t=e,{hasDraft:()=>c(t),storeDraft:()=>f(t),restoreDraft:()=>p(t),removeDraft:e=>d(t,e),isEmpty:e=>v(t,e)};var t,r,a,o,s})}();