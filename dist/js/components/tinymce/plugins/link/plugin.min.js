!function(){"use strict";var B=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=r=>e=>{return n=typeof(e=e),(null===e?"null":"object"==n&&Array.isArray(e)?"array":"object"==n&&(e=e,(t=String).prototype.isPrototypeOf(e)||(null==(e=e.constructor)?void 0:e.name)===t.name)?"string":n)===r;var t,n},t=t=>e=>typeof e===t,c=e("string"),g=e("object"),o=e("array"),I=e=>null===e,m=t("boolean"),n=e=>!(null==e),d=t("function"),h=(n,r)=>{if(o(n)){for(let e=0,t=n.length;e<t;++e)if(!r(n[e]))return!1;return!0}return!1},f=()=>{},j=(e,t)=>e===t;class p{constructor(e,t){this.tag=e,this.value=t}static some(e){return new p(!0,e)}static none(){return p.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?p.some(e(this.value)):p.none()}bind(e){return this.tag?e(this.value):p.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:p.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return n(e)?p.some(e):p.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}p.singletonNone=new p(!1);const K=Array.prototype.indexOf,U=Array.prototype.push,v=n=>{var r=[];for(let e=0,t=n.length;e<t;++e){if(!o(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);U.apply(r,n[e])}return r},k=(t,n)=>{for(let e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return p.none()},y=(e,t,n=j)=>e.exists(e=>n(e,t)),x=(e,t)=>e?p.some(t):p.none(),r=t=>e=>e.options.get(t),b=r("link_assume_external_targets"),q=r("link_context_toolbar"),F=r("link_list"),_=r("link_default_target"),V=r("link_default_protocol"),u=r("link_target_list"),w=r("link_rel_list"),$=r("link_class_list"),z=r("link_title"),G=r("allow_unsafe_link_target"),H=r("link_quicklink");var a=tinymce.util.Tools.resolve("tinymce.util.Tools");const l=e=>c(e.value)?e.value:"",J=(e,n)=>{const r=[];return a.each(e,e=>{t=e;var t=c(t.text)?t.text:c(t.title)?t.title:"";if(void 0!==e.menu){const c=J(e.menu,n);r.push({text:t,items:c})}else{const c=n(e);r.push({text:t,value:c})}}),r},W=(t=l)=>e=>p.from(e).map(e=>J(e,t)),i=e=>W(l)(e),Q=W,C=(t,n)=>e=>({name:t,type:"listbox",label:n,items:e}),X=l,Y=Object.keys,Z=Object.hasOwnProperty,O=(e,t)=>Z.call(e,t);var ee=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),te=tinymce.util.Tools.resolve("tinymce.util.URI");const ne=e=>n(e)&&"a"===e.nodeName.toLowerCase(),re=e=>ne(e)&&!!N(e),oe=(t,n)=>{if(t.collapsed)return[];{var t=t.cloneContents(),r=t.firstChild,o=new ee(r,t),l=[];let e=r;for(;n(e)&&l.push(e),e=o.next(););return l}},le=e=>/^\w+:/i.test(e),N=e=>{var t;return null!=(t=null!=(t=e.getAttribute("data-mce-href"))?t:e.getAttribute("href"))?t:""},ae=(e,t)=>{const n=["noopener"],r=e?e.split(/\s+/):[],o=e=>e.filter(e=>-1===a.inArray(n,e)),l=t?(e=r,0<(e=o(r)).length?e.concat(n):n):o(r);return 0<l.length?a.trim(l.sort().join(" ")):""},A=(e,t)=>(t=t||s(e.selection.getRng())[0]||e.selection.getNode(),E(t)?p.from(e.dom.select("a[href]",t)[0]):p.from(e.dom.getParent(t,"a[href]"))),S=(e,t)=>A(e,t).isSome(),ie=(e,t)=>t.fold(()=>e.getContent({format:"text"}),e=>e.innerText||e.textContent||"").replace(/\uFEFF/g,""),s=e=>oe(e,re),se=e=>a.grep(e,re),ue=e=>0<se(e).length,ce=e=>{const t=e.schema.getTextInlineElements();return!(A(e).exists(e=>e.hasAttribute("data-mce-block"))||!(e=e.selection.getRng()).collapsed&&0!==oe(e,e=>1===e.nodeType&&!ne(e)&&!O(t,e.nodeName.toLowerCase())).length)},E=e=>n(e)&&"FIGURE"===e.nodeName&&/\bimage\b/i.test(e.className),ge=(l,e,a)=>{const i=l.selection.getNode(),t=A(l,i),s=(e=>{var t,n={...(e=>{return t=["title","rel","class","target"],n=(t,n)=>(e[n].each(e=>{t[n]=e.length>0?e:null}),t),r={href:e.href},((n,r)=>{for(let e=0,t=n.length;e<t;e++)r(n[e],e)})(t,(e,t)=>{r=n(r,e)}),r;var t,n,r})(a)};if(0===w(e).length&&!G(e)){const e=ae(n.rel,"_blank"===n.target);n.rel=e||null}return p.from(n.target).isNone()&&!1===u(e)&&(n.target=_(e)),n.href=(t=n.href,"http"!==(e=b(e))&&"https"!==e||le(t)?t:e+"://"+t),n})(l);l.undoManager.transact(()=>{a.href===e.href&&e.attach(),t.fold(()=>{{var t=l,e=i,n=a.text,r=s;const o=t.dom;E(e)?he(o,e,r):n.fold(()=>{t.execCommand("mceInsertLink",!1,r)},e=>{t.insertContent(o.createHTML("a",r,o.encode(e)))})}},e=>{var t,n,r;l.focus(),t=l,n=e,e=a.text,r=s,e.each(e=>{O(n,"innerText")?n.innerText=e:n.textContent=e}),t.dom.setAttribs(n,r),t.selection.select(n)})})},me=e=>{var n,r,{class:e,href:t,rel:o,target:l,text:a,title:i}=e,s={},e={class:e.getOrNull(),href:t,rel:o.getOrNull(),target:l.getOrNull(),text:a.getOrNull(),title:i.getOrNull()},u=(n=s,f),c=e,g=Y(c);for(let e=0,t=g.length;e<t;e++){var m=g[e];((e=>!1===I(e))(r=c[m],m=m)?(e,t)=>{n[t]=e}:u)(r,m)}return s},de=(e,t,n)=>{n=n,r={allow_html_data_urls:(r=e.options.get)("allow_html_data_urls"),allow_script_urls:r("allow_script_urls"),allow_svg_data_urls:r("allow_svg_data_urls")},o=n.href;var r,o,n={...n,href:te.isDomSafe(o,"a",r)?o:""};e.hasPlugin("rtc",!0)?e.execCommand("createlink",!1,me(n)):ge(e,t,n)},T=e=>{var s;e.hasPlugin("rtc",!0)?e.execCommand("unlink"):(s=e).undoManager.transact(()=>{var e,t,n,r,o=s.selection.getNode();{var l,a,i;E(o)?(a=(l=s).dom.select("img",o)[0])&&(i=l.dom.getParents(a,"a[href]",o)[0])&&(null!=(o=i.parentNode)&&o.insertBefore(a,i),l.dom.remove(i)):(l=(o=s).dom,e=o.selection,t=e.getBookmark(),n=e.getRng().cloneRange(),r=l.getParent(n.startContainer,"a[href]",o.getBody()),l=l.getParent(n.endContainer,"a[href]",o.getBody()),r&&n.setStartBefore(r),l&&n.setEndAfter(l),e.setRng(n),o.execCommand("unlink"),e.moveToBookmark(t))}s.focus()})},he=(e,t,n)=>{var r=e.select("img",t)[0];if(r){const t=e.create("a",n);null!=(e=r.parentNode)&&e.insertBefore(t,r),t.appendChild(r)}},fe=(n,e)=>k(e,e=>{return t=e,O(t=t,"items")&&void 0!==t.items&&null!==t.items?fe(n,e.items):x(e.value===n,e);var t}),pe=(e,u)=>{const c={text:e.text,title:e.title};return{onChange:(e,t)=>{var n,t=t.name;{if("url"===t)return o=e(),n=o.url,r=x(c.text.length<=0,p.from(null==(r=n.meta)?void 0:r.text).getOr(n.value)),n=o.url,o=x(c.title.length<=0,p.from(null==(n=n.meta)?void 0:n.title).getOr("")),r.isSome()||o.isSome()?p.some({...r.map(e=>({text:e})).getOr({}),...o.map(e=>({title:e})).getOr({})}):p.none();if(n=t,-1<K.call(["anchor","link"],n)){var r=e(),o,l=("link"===(o=t)?u.link:"anchor"===o?u.anchor:p.none()).getOr([]);{var a=c.text;const i=r[o],s=0<a.length;return void 0!==i?fe(i,l).map(e=>({url:{value:e.value,meta:{text:s?a:e.text,attach:f}},text:s?a:e.text})):p.none()}}return("text"===t||"title"===t)&&(c[t]=e()[t]),p.none()}}}};var ve=tinymce.util.Tools.resolve("tinymce.util.Delay");const ke=e=>{const t=e.href;return 0<t.indexOf("@")&&-1===t.indexOf("/")&&-1===t.indexOf("mailto:")?p.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:e=>({...e,href:"mailto:"+t})}):p.none()},ye=e=>{e=e.dom.select("a:not([href])"),e=v((t=>{const n=t.length,r=new Array(n);for(let e=0;e<n;e++){const n=t[e];r[e]=(e=>{const t=e.name||e.id;return t?[{text:t,value:"#"+t}]:[]})(n,e)}return r})(e));return 0<e.length?p.some([{text:"None",value:""}].concat(e)):p.none()},xe=e=>{e=$(e);return 0<e.length?i(e):p.none()},be=e=>{try{return p.some(JSON.parse(e))}catch(e){return p.none()}},_e=(e,t)=>{var n=w(e);if(0<n.length){const r=y(t,"_blank"),o=e=>ae(X(e),r);return(!1===G(e)?Q(o):i)(n)}return p.none()},we=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],Ce=e=>{e=u(e);return o(e)?i(e).orThunk(()=>p.some(we)):!1===e?p.none():p.some(we)},R=(e,t,n)=>{e=e.getAttrib(t,n);return null!==e&&0<e.length?p.some(e):p.none()},Oe=m=>{var e,n,r,t;e=m,t=A(e),r=t,(t=>{const n=e=>t.convertURL(e.value||e.url||"","href"),e=F(t);return new Promise(t=>{c(e)?fetch(e).then(e=>e.ok?e.text().then(be):Promise.reject()).then(t,()=>t(p.none())):d(e)?e(e=>t(p.some(e))):t(p.from(e))}).then(e=>e.bind(Q(n)).map(e=>0<e.length?[{text:"None",value:""}].concat(e):e))})(n=e).then(e=>{var t=((e,t)=>{const n=e.dom,r=ce(e)?p.some(ie(e.selection,t)):p.none(),o=t.bind(e=>p.from(n.getAttrib(e,"href"))),l=t.bind(e=>p.from(n.getAttrib(e,"target"))),a=t.bind(e=>R(n,e,"rel")),i=t.bind(e=>R(n,e,"class"));return{url:o,text:r,title:t.bind(e=>R(n,e,"title")),target:l,rel:a,linkClass:i}})(n,r);return{anchor:t,catalogs:{targets:Ce(n),rels:_e(n,t.target),classes:xe(n),anchor:ye(n),link:e},optNode:r,flags:{titleEnabled:z(n)}}}).then(e=>{u=m,c=e;var u,c,t,n,r=e=>{const n=e.getData();if(n.url.value){const t=t=>p.from(n[t]).filter(e=>!y(c.anchor[t],e)),i={href:n.url.value,text:t("text"),target:t("target"),rel:t("rel"),class:t("linkClass"),title:t("title")},s={href:n.url.value,attach:void 0!==n.url.meta&&n.url.meta.attach?n.url.meta.attach:f};var l,a,r,o;l=u,a=i,k([ke,(r=b(l),o=V(l),e=>{const t=e.href;return 1===r&&!le(t)||0===r&&/^\s*www(\.|\d\.)/i.test(t)?p.some({message:`The URL you entered seems to be an external link. Do you want to add the required ${o}:// prefix?`,preprocess:e=>({...e,href:o+"://"+t})}):p.none()})],e=>e(a)).fold(()=>Promise.resolve(a),o=>new Promise(t=>{{var n=l,e=o.message;const r=n.selection.getRng();ve.setEditorTimeout(n,()=>{n.windowManager.confirm(e,e=>{n.selection.setRng(r),t(e?o.preprocess(a):a)})})}})).then(e=>{de(u,s,e)})}else T(u);e.close()};{var o=m;const l=e.anchor.text.map(()=>({name:"text",type:"input",label:"Text to display"})).toArray(),a=e.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],i=(t=e,o=p.from(_(o)),t=t.anchor,{url:{value:n=t.url.getOr(""),meta:{original:{value:n}}},text:t.text.getOr(""),title:t.title.getOr(""),anchor:n,link:n,rel:t.rel.getOr(""),target:t.target.or(o).getOr(""),linkClass:t.linkClass.getOr("")}),s=e.catalogs,g=pe(i,s);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:v([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],l,a,(t=>{const n=[],r=e=>{n.push(e)};for(let e=0;e<t.length;e++)t[e].each(r);return n})([s.anchor.map(C("anchor","Anchors")),s.rels.map(C("rel","Rel")),s.targets.map(C("target","Open link in...")),s.link.map(C("link","Link list")),s.classes.map(C("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:i,onChange:(t,{name:e})=>{g.onChange(t.getData,{name:e}).each(e=>{t.setData(e)})},onSubmit:r}}}).then(e=>{m.windowManager.open(e)})};var Ne=tinymce.util.Tools.resolve("tinymce.util.VK");const Ae=(e,t)=>e.dom.getParent(t,"a[href]"),Se=e=>Ae(e,e.selection.getStart()),P=(e,t)=>{if(t){var n=N(t);if(/^#/.test(n)){const t=e.dom.select(n);t.length&&e.selection.scrollIntoView(t[0],!0)}else n=t.href,(e=document.createElement("a")).target="_blank",e.href=n,e.rel="noreferrer noopener",(n=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e=e,n=n,document.body.appendChild(e),e.dispatchEvent(n),document.body.removeChild(e)}},Ee=e=>()=>{e.execCommand("mceLink",!1,{dialog:!0})},L=e=>()=>{P(e,Se(e))},M=(e,t)=>(e.on("NodeChange",t),()=>e.off("NodeChange",t)),D=n=>e=>{var t=()=>{e.setActive(!n.mode.isReadOnly()&&S(n,n.selection.getNode())),e.setEnabled(n.selection.isEditable())};return t(),M(n,t)},Te=n=>t=>{var e=()=>{return t.setEnabled(1===((e=n).selection.isCollapsed()?se(e.dom.getParents(e.selection.getStart())):s(e.selection.getRng())).length);var e};return e(),M(n,e)},Re=r=>t=>{const e=r.dom.getParents(r.selection.getStart()),n=e=>{t.setEnabled((e=e,(ue(e)||(e=r.selection.getRng(),0<s(e).length))&&r.selection.isEditable()))};return n(e),M(r,e=>n(e.parents))};B.add("link",e=>{var t,n,r,o,l,a,i,s,u;(u=e.options.register)("link_assume_external_targets",{processor:e=>{var t=c(e)||m(e);return t?!0===e?{value:1,valid:t}:"http"===e||"https"===e?{value:e,valid:t}:{value:0,valid:t}:{valid:!1,message:"Must be a string or a boolean."}},default:!1}),u("link_context_toolbar",{processor:"boolean",default:!1}),u("link_list",{processor:e=>c(e)||d(e)||h(e,g)}),u("link_default_target",{processor:"string"}),u("link_default_protocol",{processor:"string",default:"https"}),u("link_target_list",{processor:e=>m(e)||h(e,g),default:!0}),u("link_rel_list",{processor:"object[]",default:[]}),u("link_class_list",{processor:"object[]",default:[]}),u("link_title",{processor:"boolean",default:!0}),u("allow_unsafe_link_target",{processor:"boolean",default:!1}),u("link_quicklink",{processor:"boolean",default:!1}),(s=e).ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:Ee(s),onSetup:D(s)}),s.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:L(s),onSetup:Te(s)}),s.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:()=>T(s),onSetup:Re(s)}),(a=e).ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:L(a),onSetup:Te(a)}),a.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onSetup:(i=a,e=>{var t=()=>{e.setEnabled(i.selection.isEditable())};return t(),M(i,t)}),onAction:Ee(a)}),a.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:()=>T(a),onSetup:Re(a)}),(l=e).ui.registry.addContextMenu("link",{update:e=>l.dom.isEditable(e)?ue(l.dom.getParents(e,"a"))?"link unlink openlink":"link":""}),u=e=>{var t=o.selection.getNode();return e.setEnabled(S(o,t)),f},(o=e).ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:D(o)},label:"Link",predicate:e=>q(o)&&S(o,e),initValue:()=>A(o).fold(()=>"",N),commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:e=>{var t=o.selection.getNode();return e.setActive(S(o,t)),D(o)(e)},onAction:e=>{var t=e.getValue(),n=(e=>{const t=A(o),n=ce(o);if(t.isNone()&&n){const n=ie(o.selection,t);return x(0===n.length,e)}return p.none()})(t);de(o,{href:t,attach:f},{href:t,text:n,title:p.none(),rel:p.none(),target:p.none(),class:p.none()}),o.selection.collapse(!1),e.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:u,onAction:e=>{T(o),e.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:u,onAction:e=>{L(o)(),e.hide()}}]}),(r=e).on("click",e=>{var t=Ae(r,e.target);t&&Ne.metaKeyPressed(e)&&(e.preventDefault(),P(r,t))}),r.on("keydown",e=>{var t;e.isDefaultPrevented()||13!==e.keyCode||!0!==e.altKey||!1!==e.shiftKey||!1!==e.ctrlKey||!1!==e.metaKey||(t=Se(r))&&(e.preventDefault(),P(r,t))}),(n=e).addCommand("mceLink",(e,t)=>{!0!==(null==t?void 0:t.dialog)&&H(n)?n.dispatch("contexttoolbar-show",{toolbarKey:"quicklink"}):Oe(n)}),(t=e).addShortcut("Meta+K","",()=>{t.execCommand("mceLink")})})}();