!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");const t=r=>e=>{return a=typeof(e=e),(null===e?"null":"object"==a&&Array.isArray(e)?"array":"object"==a&&(e=e,(t=String).prototype.isPrototypeOf(e)||(null==(e=e.constructor)?void 0:e.name)===t.name)?"string":a)===r;var t,a},u=t("string"),m=t("object"),p=t("array"),d=e=>"function"==typeof e,s=()=>!1;var h=tinymce.util.Tools.resolve("tinymce.util.Tools");const a=t=>e=>e.options.get(t),o=a("template_cdate_classes"),g=a("template_mdate_classes"),i=a("template_selected_content_classes"),v=a("template_preview_replace_values"),c=a("template_replace_values"),y=a("templates"),f=a("template_cdate_format"),b=a("template_mdate_format"),_=a("content_style"),M=a("content_css_cors"),T=a("body_class"),S=(t,a)=>{if((t=""+t).length<a)for(let e=0;e<a-t.length;e++)t="0"+t;return t},x=(e,t,a=new Date)=>{var r="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),n="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),l="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),s="January February March April May June July August September October November December".split(" ");return(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+a.getFullYear())).replace("%y",""+a.getYear())).replace("%m",S(a.getMonth()+1,2))).replace("%d",S(a.getDate(),2))).replace("%H",""+S(a.getHours(),2))).replace("%M",""+S(a.getMinutes(),2))).replace("%S",""+S(a.getSeconds(),2))).replace("%I",""+((a.getHours()+11)%12+1))).replace("%p",a.getHours()<12?"AM":"PM")).replace("%B",""+e.translate(s[a.getMonth()]))).replace("%b",""+e.translate(l[a.getMonth()]))).replace("%A",""+e.translate(n[a.getDay()]))).replace("%a",""+e.translate(r[a.getDay()]))).replace("%%","%")};class C{constructor(e,t){this.tag=e,this.value=t}static some(e){return new C(!0,e)}static none(){return C.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?C.some(e(this.value)):C.none()}bind(e){return this.tag?e(this.value):C.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:C.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return null==e?C.none():C.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}C.singletonNone=new C(!1);const l=Object.hasOwnProperty;var r=tinymce.util.Tools.resolve("tinymce.html.Serializer");const w={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;","'":"&#039;"},O=e=>e.replace(/["'<>&]/g,e=>{return r=w,t=r,a=n=e,(l.call(t,a)?C.from(r[n]):C.none()).getOr(e);var t,a,r,n}),A=(a,r,e)=>{var n,l=e.split(/\s+/);for(let e=0,t=l.length;e<t;e++)if(n=l[e],a.hasClass(r,n))return!0;return!1},D=(e,t)=>r({validate:!0},e.schema).serialize(e.parser.parse(t,{insert:!0})),N=(a,e)=>(h.each(e,(e,t)=>{d(e)&&(e=e(t)),a=a.replace(new RegExp("\\{\\$"+t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\}","g"),e)}),a),I=(e,t)=>{const r=e.dom,n=c(e);h.each(r.select("*",t),a=>{h.each(n,(e,t)=>{r.hasClass(a,t)&&d(e)&&e(a)})})},E=(t,e,a)=>{const r=t.dom,n=t.selection.getContent();a=N(a,c(t));let l=r.create("div",{},D(t,a));a=r.select(".mceTmpl",l);a&&0<a.length&&(l=r.create("div")).appendChild(a[0].cloneNode(!0)),h.each(r.select("*",l),e=>{A(r,e,o(t))&&(e.innerHTML=x(t,f(t))),A(r,e,g(t))&&(e.innerHTML=x(t,b(t))),A(r,e,i(t))&&(e.innerHTML=n)}),I(t,l),t.execCommand("mceInsertContent",!1,l.innerHTML),t.addVisual()};var k=tinymce.util.Tools.resolve("tinymce.Env");const P=(i,e)=>{const c=(e,a)=>{var r=e,n=s;for(let e=0,t=r.length;e<t;e++){var l=r[e];if(e,l.text===a)return C.some(l);if(n(l,e))break}return C.none()},u=e=>{i.windowManager.alert("Could not load the specified template.",()=>e.focus("template"))},m=e=>e.value.url.fold(()=>Promise.resolve(e.value.content.getOr("")),e=>fetch(e).then(e=>e.ok?e.text():Promise.reject()));(()=>{if(e&&0!==e.length)return C.from(h.map(e,(e,t)=>{var a=e=>void 0!==e.url;return{selected:0===t,text:e.title,value:{url:a(e)?C.from(e.url):C.none(),content:a(e)?C.none():C.from(e.content),description:e.description}}}));{const e=i.translate("No templates defined.");return i.notificationManager.open({text:e,type:"info"}),C.none()}})().each(l=>{const n=(e=>{{var t=e;const a=t.length,r=new Array(a);for(let e=0;e<a;e++){const a=t[e];r[e]={text:a.text,value:a.text}}return r}})(l),s=(e,t)=>{return{title:"Insert Template",size:"large",body:{type:"panel",items:e},initialData:t,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:t=>{var e=t.getData();c(a,e.template).each(e=>{m(e).then(e=>{i.execCommand("mceInsertTemplate",!1,e),t.close()}).catch(()=>{t.setEnabled("save",!1),u(t)})})},onChange:(r=a=l,n=o,(a,e)=>{if("template"===e.name){const e=a.getData().template;c(r,e).each(t=>{a.block("Loading..."),m(t).then(e=>{n(a,t,e)}).catch(()=>{n(a,t,""),a.setEnabled("save",!1),u(a)})})}})};var r,n,a},o=(e,t,a)=>{var a=((a,e)=>{let r=D(a,e);if(-1===e.indexOf("<html>")){let t="";const o=null!=(e=_(a))?e:"",i=M(a)?' crossorigin="anonymous"':"";h.each(a.contentCSS,e=>{t+='<link type="text/css" rel="stylesheet" href="'+a.documentBaseURI.toAbsolute(e)+'"'+i+">"}),o&&(t+='<style type="text/css">'+o+"</style>");var e=T(a),n=a.dom.encode,l='<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A" && !('+(k.os.isMacOS()||k.os.isiOS()?"e.metaKey":"e.ctrlKey && !e.altKey")+")) {e.preventDefault();}}}, false);<\/script> ",s=a.getBody().dir,s=s?' dir="'+n(s)+'"':"";r='<!DOCTYPE html><html><head><base href="'+n(a.documentBaseURI.getURI())+'">'+t+l+'</head><body class="'+n(e)+'"'+s+">"+r+"</body></html>"}return N(r,v(a))})(i,a),r=[{type:"listbox",name:"template",label:"Templates",items:n},{type:"htmlpanel",html:`<p aria-live="polite">${O(t.value.description)}</p>`},{label:"Preview",type:"iframe",name:"preview",sandboxed:!1,transparent:!1}],t={template:t.text,preview:a};e.unblock(),e.redial(s(r,t)),e.focus("template")},t=i.windowManager.open(s([],{template:"",preview:""}));t.block("Loading..."),m(l[0]).then(e=>{o(t,l[0],e)}).catch(()=>{o(t,l[0],""),t.setEnabled("save",!1),u(t)})})},H=a=>e=>{const t=()=>{e.setEnabled(a.selection.isEditable())};return a.on("NodeChange",t),t(),()=>{a.off("NodeChange",t)}};e.add("template",e=>{var r,t,a,n,l,s,o,i,c;(c=(i=e).options.register)("template_cdate_classes",{processor:"string",default:"cdate"}),c("template_mdate_classes",{processor:"string",default:"mdate"}),c("template_selected_content_classes",{processor:"string",default:"selcontent"}),c("template_preview_replace_values",{processor:"object"}),c("template_replace_values",{processor:"object"}),c("templates",{processor:e=>u(e)||((a,r)=>{if(p(a)){for(let e=0,t=a.length;e<t;++e)if(!r(a[e]))return!1;return!0}return!1})(e,m)||d(e),default:[]}),c("template_cdate_format",{processor:"string",default:i.translate("%Y-%m-%d")}),c("template_mdate_format",{processor:"string",default:i.translate("%Y-%m-%d")}),c=()=>o.execCommand("mceTemplate"),(o=e).ui.registry.addButton("template",{icon:"template",tooltip:"Insert template",onSetup:H(o),onAction:c}),o.ui.registry.addMenuItem("template",{icon:"template",text:"Insert template...",onSetup:H(o),onAction:c}),(i=e).addCommand("mceInsertTemplate",(l=E,s=[i],(...e)=>{e=s.concat(e);return l.apply(null,e)})),i.addCommand("mceTemplate",(n=t=i,a=e=>{P(n,e)},()=>{var e=y(t);d(e)?e(a):u(e)?fetch(e).then(e=>{e.ok&&e.json().then(a)}):a(e)})),(r=e).on("PreProcess",e=>{const t=r.dom,a=b(r);h.each(t.select("div",e.node),e=>{t.hasClass(e,"mceTmpl")&&(h.each(t.select("*",e),e=>{A(t,e,g(r))&&(e.innerHTML=x(r,a))}),I(r,e))})})})}();